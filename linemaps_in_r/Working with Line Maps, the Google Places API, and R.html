<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- saved from url=(0085)http://flowingdata.com/2013/09/12/working-with-line-maps-the-google-places-api-and-r/ -->
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US"><head profile="http://gmpg.org/xfn/11"><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<title> Working with Line Maps, the Google Places API, and R</title>
<meta name="generator" content="WordPress 3.8">  
<link rel="stylesheet" href="./Working with Line Maps, the Google Places API, and R_files/style.css" type="text/css" media="screen">
<link rel="alternate" type="application/rss+xml" title="RSS 2.0" href="http://flowingdata.com/feed">
<link rel="pingback" href="http://flowingdata.com/xmlrpc.php">
<link rel="shortcut icon" href="http://flowingdata.com/wp-content/themes/flowingdata-4-8/images/favicon.ico">
<script src="./Working with Line Maps, the Google Places API, and R_files/quant.js" async="" type="text/javascript"></script><script async="" type="text/javascript" src="http://www.googletagservices.com/tag/js/gpt.js"></script><script type="text/javascript" src="./Working with Line Maps, the Google Places API, and R_files/jquery-1.4.4.min.js"></script>
<script type="text/javascript">
    var googletag = googletag || {};
    googletag.cmd = googletag.cmd || [];
    (function() {
    var gads = document.createElement('script');
    gads.async = true;
    gads.type = 'text/javascript';
    var useSSL = 'https:' == document.location.protocol;
    gads.src = (useSSL ? 'https:' : 'http:') + 
    '//www.googletagservices.com/tag/js/gpt.js';
    var node = document.getElementsByTagName('script')[0];
    node.parentNode.insertBefore(gads, node);
    })();
    </script>
<script type="text/javascript">
    googletag.cmd.push(function() {
    googletag.defineSlot('/2462688/Sidebar_rectangle', [300, 250], 'div-gpt-ad-1332011316310-2').addService(googletag.pubads());
    googletag.defineSlot('/2462688/Square1', [125, 125], 'div-gpt-ad-1332011316310-3').addService(googletag.pubads());
    googletag.defineSlot('/2462688/Square2', [125, 125], 'div-gpt-ad-1332011316310-4').addService(googletag.pubads());
    googletag.defineSlot('/2462688/Square3', [125, 125], 'div-gpt-ad-1332011316310-5').addService(googletag.pubads());
    googletag.defineSlot('/2462688/Square4', [125, 125], 'div-gpt-ad-1358209090048-5').addService(googletag.pubads());
googletag.defineSlot('/2462688/Bottom_Post', [300, 250], 'div-gpt-ad-1332011316310-0').addService(googletag.pubads());    googletag.pubads().enableSingleRequest();
    googletag.pubads().collapseEmptyDivs();
    googletag.enableServices();
    });
    </script>
<link rel="alternate" type="application/rss+xml" title="FlowingData Â» Working with Line Maps, the Google Places API, and R Comments Feed" href="http://flowingdata.com/2013/09/12/working-with-line-maps-the-google-places-api-and-r/feed/">
<script type="text/javascript" src="./Working with Line Maps, the Google Places API, and R_files/comment-reply.min.js"></script>
<script type="text/javascript" src="./Working with Line Maps, the Google Places API, and R_files/jquery.js"></script>
<script type="text/javascript" src="./Working with Line Maps, the Google Places API, and R_files/jquery-migrate.min.js"></script>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://flowingdata.com/xmlrpc.php?rsd">
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://flowingdata.com/wp-includes/wlwmanifest.xml">
<link rel="prev" title="Treemap art" href="http://flowingdata.com/2013/09/11/treemap-art/">
<link rel="next" title="Game map from Grand Theft Auto 5" href="http://flowingdata.com/2013/09/12/game-map-from-grand-theft-auto-5/">
<meta name="generator" content="WordPress 3.8">
<link rel="canonical" href="./Working with Line Maps, the Google Places API, and R_files/Working with Line Maps, the Google Places API, and R.html">
<link rel="shortlink" href="http://flowingdata.com/?p=32275">
 <script type="text/javascript" src="./Working with Line Maps, the Google Places API, and R_files/democracy.js"></script><link rel="stylesheet" href="./Working with Line Maps, the Google Places API, and R_files/basic.css" type="text/css"><link rel="stylesheet" href="./Working with Line Maps, the Google Places API, and R_files/style(1).css" type="text/css"><link rel="stylesheet" href="./Working with Line Maps, the Google Places API, and R_files/wp-page-numbers.css" type="text/css" media="screen"><style type="text/css">img#wpstats{display:none}</style><link rel="stylesheet" type="text/css" href="./Working with Line Maps, the Google Places API, and R_files/shCore.css"><link rel="stylesheet" type="text/css" href="./Working with Line Maps, the Google Places API, and R_files/shThemeDefault.css"><style type="text/css" id="syntaxhighlighteranchor"></style>
<style>#agzugshrzfrcrxxroelvaiqdymvyvzikyb{border:solid 2px #fff !important;box-sizing:content-box !important;color:#fff !important;display:block !important;height:auto !important;margin:0 !important;opacity:0.9 !important;padding:7px 10px !important;position:fixed !important;visibility:visible !important;width:auto !important;z-index:2147483647 !important;-webkit-border-radius:5px !important;-webkit-box-shadow:0px 0px 20px #000 !important;-webkit-box-sizing:content-box !important;}.agzugshrzfrcrxxroelvaiqdymvyvzikyb-blocked{color:#777 !important;display:inline !important;text-decoration:line-through !important;}#agzugshrzfrcrxxroelvaiqdymvyvzikyb br{display:block !important;}#agzugshrzfrcrxxroelvaiqdymvyvzikyb span{background:transparent !important;}#agzugshrzfrcrxxroelvaiqdymvyvzikyb div{border:0 !important;margin:0 !important;padding:0 !important;width:auto !important;letter-spacing:normal !important;font:13px Arial,Helvetica !important;text-align:left !important;text-shadow:none !important;text-transform:none !important;word-spacing:normal !important;}#agzugshrzfrcrxxroelvaiqdymvyvzikyb a{font-weight:normal !important;background:none !important;text-decoration:underline !important;color:#fff !important;}@media print{#agzugshrzfrcrxxroelvaiqdymvyvzikyb{display:none !important;}}</style></head><style type="text/css">embed[type*="application/x-shockwave-flash"],embed[src*=".swf"],object[type*="application/x-shockwave-flash"],object[codetype*="application/x-shockwave-flash"],object[src*=".swf"],object[codebase*="swflash.cab"],object[classid*="D27CDB6E-AE6D-11cf-96B8-444553540000"],object[classid*="d27cdb6e-ae6d-11cf-96b8-444553540000"],object[classid*="D27CDB6E-AE6D-11cf-96B8-444553540000"]{	display: none !important;}</style>
<body style="">
<a name="top"></a>
<div id="topnav">
<div id="topnav-content" class="content">
<div id="login" class="float-right">
<span id="username-meta">Logged in as <a href="http://flowingdata.com/profile/">abresler</a> &nbsp;&nbsp;</span>
<a href="http://flowingdata.com/wp-login.php?action=logout&_wpnonce=d018091d15">Log out</a> </div>
</div>
<div class="clear-line"></div>
</div> 
<div id="header">
<div id="header-content" class="content">
<div id="nav">
<a href="http://flowingdata.com/">
<img src="./Working with Line Maps, the Google Places API, and R_files/logo.png" class="float-left" scale="0">
</a>
<div id="pages" class="float-right">
<ul>
<li><a href="http://flowingdata.com/membership/">Membership</a></li>
<li><a href="http://flowingdata.com/learning/">Learning</a></li>
<li><a href="https://jobs.flowingdata.com/">Job Board</a></li>
<li><a href="http://flowingdata.com/category/projects/">Projects</a></li>
<li><a href="http://flowingdata.com/about/">About</a></li>
</ul>
</div> 
<div class="clear-line"></div>
</div> 
</div> 
</div> 
<div class="clear-line"></div>
<div id="main-wrapper">
<div id="content-wrapper" class="content">
<div class="post" id="post-32275">
<div id="content" class="single-long">
<div class="entry">
<div class="category">
<a href="http://flowingdata.com/category/tutorials/" title="View all posts in Tutorials" rel="category tag">Tutorials</a> &nbsp;/&nbsp; <a href="http://flowingdata.com/tag/google/" rel="tag">Google</a>, <a href="http://flowingdata.com/tag/mysql/" rel="tag">MySQL</a>, <a href="http://flowingdata.com/tag/python/" rel="tag">Python</a>, <a href="http://flowingdata.com/tag/r/" rel="tag">R</a> <span class="members-note"><a href="http://flowingdata.com/members-only">Members Only</a></span> </div>
<h1>Working with Line Maps, the Google Places API, and R</h1>
<div class="clear-line"></div>
<div class="author">
By <strong>Nathan Yau</strong>
</div> 
<div id="lead-in">
<p class="img-right"><img src="./Working with Line Maps, the Google Places API, and R_files/Line-maps-Google-Places-and-R.png" class="attachment-long-form-thumb wp-post-image" alt="Line maps, Google Places API, and R" width="425" height="295" src-orig="http://i2.wp.com/flowingdata.com/wp-content/uploads/2013/09/Line-maps-Google-Places-and-R.png?fit=425%2C9999" scale="2"></p>
<div class="entry-excerpt">
A frequent challenge of visualization is behind the scenes, to get the data and to mold it into the format you need. Do that. Then map. </div>
<div id="tut-meta">
<div class="button-link"><a href="http://flowingdata.com/2013/08/27/in-search-of-food-deserts/">Demo</a></div>
<div class="button-link"><a href="http://flowingdata.com/?s2member_file_download=2013/201309linemaps-tutorial.zip">Download Source</a></div>
<div class="clear-line"></div>
</div> 
<div class="clear-line"></div>
</div> 
<div class="entry-content">
<p>There are a lot of maps that show locations, which turn into density or choropleth maps. The focus inevitably is on areas where there are lot of something: a lot of stores, restaurants, or people. I was interested in the reverse though when I <a href="http://flowingdata.com/2013/08/27/in-search-of-food-deserts/">looked for food deserts</a>. I also wanted a more granular view that wasn't restricted to boundary lines, so I used the Google Places API to sample at regular intervals across the country and then used R to map the data. This tutorial explains the process.</p>
<p>We can break it down into three main parts:</p>
<ol>
<li>Retrive data from Google</li>
<li>Refine the data for mapping</li>
<li>Make the maps</li>
</ol>
<p><span class="tip">There are ways to do this all in R, but my preference is to interface with data via Python, so that I don't have to worry too much about speed in projects that are one-time use anyway.</span>The first two parts are done in Python and MySQL, and the visuals are made in R. The former takes as much (or more) time to complete as the latter, so let's get to it.</p>
<h2>Setup</h2>
<p>Google offers a lot of APIs to access their forever-growing data sources programmatically, and in my experience, they're quite developer-friendly. They're easy to access and easy to test in your browser, so you know exactly what data you're working with. You use the Google Places API in this tutorial to find the nearest grocery store locations across the country.</p>
<p>First though, you need a Google API key, which you can get for free via the <a href="https://code.google.com/apis/console/">Google APIs Console</a>. Click on the API Access tab on the left, and then the button that says "Create new Server key..." Copy and paste your new key somewhere, as you'll need it later.</p>
<p><span class="tip">I verified my account and wasn't charged anything. Only 1,000 courtesy requests per day isn't much if you plan to do a lot of continuous searches.</span>Then go to the Services tab, scroll down to the Places API, and flip the switch on. Notice that in the notes you get 1,000 courtesy requests per day with a max "billable" limit of 100,000 requests per day. Google doesn't actually charge you though to use their Places API. They just take your credit card information to verify your account, so it's worth doing.</p>
<p>Software-wise, like I said, you use Python, MySQL, and R in this tutorial, so you need to download and install those if you don't have them already. This is all free software, by the way.</p>
<ul>
<li>OS X comes with Python pre-installed. If you're on Windows, <a href="http://docs.python-guide.org/en/latest/starting/install/win/">this guide to installing Python</a> should be useful.</li>
<li><a href="http://dev.mysql.com/downloads/mysql/">Download MySQL directly from the site</a>. Download the appropriate version for your machine and follow the installation instructions.</li>
<li><a href="http://www.r-project.org/">Download R from the R site</a>. Click on CRAN on the left, select a server near you, and download the version for your operating system.</li>
</ul>
<p>This probably seems like a lot of setup if you're new to this stuff, but you only have to do it once (with the occasional software update), and you can skip this part for your next project.</p>
<h2>Retrieve data from Google</h2>
<p><span class="tip">The URL typically requires your API key that you get got in the setup.</span>In a nutshell, to retrieve data via a Google API, you put together a URL per the <a href="https://developers.google.com/places/documentation/search">documentation</a>, call it via code or punch it in manually in a browser, and you get a result in a specified data format.</p>
<p>That's essentially all there is to it. To get the data you need, you do the above programmatically a few thousand times.</p>
<p><span class="tip">See the full documentation for Places Search <a href="https://developers.google.com/places/documentation/search">here</a>.</span>The Places API has several request types, but your interest is in <a href="https://developers.google.com/places/documentation/search">the places search</a>, which lets you specify a location, set a search radius, and then ask for places nearby. In this case, the places nearby are grocery stores. </p>
<p>I won't rehash the full documentation, but here's a search for grocery stores or supermarkets within a 25,000-meter radius of a location. Replace GOOGLE_API_KEY with your own key, and the load URL in your browser.</p>
<div id="highlighter_262565" class="syntaxhighlighter  "><div class="bar"><div class="toolbar"><a href="http://flowingdata.com/2013/09/12/working-with-line-maps-the-google-places-api-and-r/#viewSource" title="view source" class="item viewSource" style="width: 16px; height: 16px;">view source</a><div class="item copyToClipboard"><embed width="16" height="16" id="highlighter_262565_clipboard" type="application/x-shockwave-flash" title="copy to clipboard" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_262565" menu="false" src="http://flowingdata.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter2/scripts/clipboard.swf"></div><a href="http://flowingdata.com/2013/09/12/working-with-line-maps-the-google-places-api-and-r/#printSource" title="print" class="item printSource" style="width: 16px; height: 16px;">print</a><a href="http://flowingdata.com/2013/09/12/working-with-line-maps-the-google-places-api-and-r/#about" title="?" class="item about" style="width: 16px; height: 16px;">?</a></div></div><div class="lines"><div class="line alt1"><table><tbody><tr><td class="number"><code>1</code></td><td class="content"><code class="plain"><a href="https://maps.googleapis.com/maps/api/place/search/json?location=37.391982">https://maps.googleapis.com/maps/api/place/search/json?location=37.391982</a>,-84.199219&amp;sensor=false&amp;key=GOOGLE_API_KEY&amp;radius=25000&amp;types=grocery_or_supermarket</code></td></tr></tbody></table></div></div></div>
<p><span class="tip">There are <a href="https://developers.google.com/places/documentation/supported_types">many other place types</a> other than grocery and supermarket.</span>You get something like the data below, which is in JSON format. The latitude and longitude is shown for location, as well as the name of the business and other information. The latitude and longitude is what you care most about.</p>
<div id="highlighter_979228" class="syntaxhighlighter  "><div class="bar"><div class="toolbar"><a href="http://flowingdata.com/2013/09/12/working-with-line-maps-the-google-places-api-and-r/#viewSource" title="view source" class="item viewSource" style="width: 16px; height: 16px;">view source</a><div class="item copyToClipboard"><embed width="16" height="16" id="highlighter_979228_clipboard" type="application/x-shockwave-flash" title="copy to clipboard" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_979228" menu="false" src="http://flowingdata.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter2/scripts/clipboard.swf"></div><a href="http://flowingdata.com/2013/09/12/working-with-line-maps-the-google-places-api-and-r/#printSource" title="print" class="item printSource" style="width: 16px; height: 16px;">print</a><a href="http://flowingdata.com/2013/09/12/working-with-line-maps-the-google-places-api-and-r/#about" title="?" class="item about" style="width: 16px; height: 16px;">?</a></div></div><div class="lines"><div class="line alt1"><table><tbody><tr><td class="number"><code>1</code></td><td class="content"><code class="plain">{</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>2</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">"geometry" : {</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>3</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">"location" : {</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>4</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">"lat" : 37.31941,</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>5</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">"lng" : -83.969898</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>6</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>7</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">},</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>8</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">"icon" : "<a href="http://maps.gstatic.com/mapfiles/place_api/icons/generic_business-71.png">http://maps.gstatic.com/mapfiles/place_api/icons/generic_business-71.png</a>",</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>9</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">"id" : "83a8d3c6af2cc672404682d08c272ae365e56767",</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>10</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">"name" : "Annville Town &amp; Country Market",</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>11</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">"reference" : "CoQBewAAAJsOFXSS7UDu8_sTQwNJTxFVB4Ek1-NmRRcuOYPfDcZBKlhqyyLDscvduvQ34Qssfo2zVsCkgmaCJZjE69XU1u3</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>12</code></td><td class="content"><code class="plain">QX6MmM8NbDkQVOvPUENJXvjTPVhGEoSTQhtTCNT1mFfbYJIxdCM4lRZIS...",</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>13</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">"types" : [ "grocery_or_supermarket", "food", "store", "establishment" ],</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>14</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">"vicinity" : "4368 Highway 30 W, Annville"</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>15</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">},</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>16</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">{</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>17</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">"geometry" : {</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>18</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">"location" : {</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>19</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">"lat" : 37.565609,</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>20</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">"lng" : -84.272977</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>21</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>22</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">},</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>23</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">"icon" : "<a href="http://maps.gstatic.com/mapfiles/place_api/icons/generic_business-71.png">http://maps.gstatic.com/mapfiles/place_api/icons/generic_business-71.png</a>",</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>24</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">"id" : "ab1c4225fecea7fea1fa1a443bec1b2080273bb5",</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>25</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">"name" : "Moore's Grocery",</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>26</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">"reference" : "CnRtAAAAR_vsLv8VZXyXy_Oab8IxVA-n_kSZr_dSXsuY9ch2bFNhOXxocgYAwy5olsDM3FaksMaXG8i1Hfoeyij...",</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>27</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">"types" : [ "grocery_or_supermarket", "food", "store", "establishment" ],</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>28</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">"vicinity" : "1080 Big Hill Road, Berea"</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>29</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">}</code></td></tr></tbody></table></div></div></div>
<p>So that's how you get data via the Places API. Now you have to write code that sweeps across the United States or some other region of your choosing and makes an API call. This is a good time to open <strong>get-nearest-python.py</strong> in this tutorial's download so you can follow along in the Python script.</p>
<p>The first two lines import libraries that you use later in the code. urllib2 lets you download pages and simplejson lets you parse JSON data. The second line is a custom function that estimates the spherical distance between two points, given their latitude and longitude coordinates. And, if you plan on running the script, insert your Google API key in place of the holder.</p>
<div id="highlighter_315111" class="syntaxhighlighter  "><div class="bar"><div class="toolbar"><a href="http://flowingdata.com/2013/09/12/working-with-line-maps-the-google-places-api-and-r/#viewSource" title="view source" class="item viewSource" style="width: 16px; height: 16px;">view source</a><div class="item copyToClipboard"><embed width="16" height="16" id="highlighter_315111_clipboard" type="application/x-shockwave-flash" title="copy to clipboard" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_315111" menu="false" src="http://flowingdata.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter2/scripts/clipboard.swf"></div><a href="http://flowingdata.com/2013/09/12/working-with-line-maps-the-google-places-api-and-r/#printSource" title="print" class="item printSource" style="width: 16px; height: 16px;">print</a><a href="http://flowingdata.com/2013/09/12/working-with-line-maps-the-google-places-api-and-r/#about" title="?" class="item about" style="width: 16px; height: 16px;">?</a></div></div><div class="lines"><div class="line alt1"><table><tbody><tr><td class="number"><code>1</code></td><td class="content"><code class="keyword">import</code> <code class="plain">urllib2, simplejson</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>2</code></td><td class="content"><code class="keyword">from</code> <code class="plain">distancesphere </code><code class="keyword">import</code> <code class="plain">distance_on_unit_sphere</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>3</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>4</code></td><td class="content"><code class="plain">GOOGLE_API_KEY </code><code class="keyword">=</code> <code class="string">'INSERT_YOUR_GOOGLE_API_KEY_HERE'</code></td></tr></tbody></table></div></div></div>
<p><span class="tip">Here's <a href="http://www.gorissen.info/Pierre/maps/googleMapLocationv3.php">a useful tool</a> to quickly look up latitude and longitude coordinates via map.</span>The following lines set constants that are also used later on. The (<code>lat_NW</code>, <code>lng_NW</code>) pair is the northwest corner of the United States and the (<code>lat_SE</code>, <code>lng_SE</code>) is the southeast corner. So if you imagine a bounding rectangle, you can think of the NW pair as the top left and the SE as the bottom right, you can change these coordinates if you're only interested in a certain area.</p>
<p>The increment lines for degrees are roughly the equivalent of 20-mile increments.</p>
<div id="highlighter_264408" class="syntaxhighlighter  "><div class="bar"><div class="toolbar"><a href="http://flowingdata.com/2013/09/12/working-with-line-maps-the-google-places-api-and-r/#viewSource" title="view source" class="item viewSource" style="width: 16px; height: 16px;">view source</a><div class="item copyToClipboard"><embed width="16" height="16" id="highlighter_264408_clipboard" type="application/x-shockwave-flash" title="copy to clipboard" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_264408" menu="false" src="http://flowingdata.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter2/scripts/clipboard.swf"></div><a href="http://flowingdata.com/2013/09/12/working-with-line-maps-the-google-places-api-and-r/#printSource" title="print" class="item printSource" style="width: 16px; height: 16px;">print</a><a href="http://flowingdata.com/2013/09/12/working-with-line-maps-the-google-places-api-and-r/#about" title="?" class="item about" style="width: 16px; height: 16px;">?</a></div></div><div class="lines"><div class="line alt1"><table><tbody><tr><td class="number"><code>1</code></td><td class="content"><code class="comments"># Country corners</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>2</code></td><td class="content"><code class="plain">lat_NW </code><code class="keyword">=</code> <code class="value">49.44098806129775</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>3</code></td><td class="content"><code class="plain">lng_NW </code><code class="keyword">=</code> <code class="keyword">-</code><code class="value">127.13476612499217</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>4</code></td><td class="content"><code class="plain">lat_SE </code><code class="keyword">=</code> <code class="value">23.725012</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>5</code></td><td class="content"><code class="plain">lng_SE </code><code class="keyword">=</code> <code class="keyword">-</code><code class="value">61.347656</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>6</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>7</code></td><td class="content"><code class="comments"># About 20 miles</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>8</code></td><td class="content"><code class="plain">lat_incr </code><code class="keyword">=</code> <code class="keyword">-</code><code class="plain">.</code><code class="value">29</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>9</code></td><td class="content"><code class="plain">lng_incr </code><code class="keyword">=</code> <code class="plain">.</code><code class="value">29</code></td></tr></tbody></table></div></div></div>
<p>Next set the starting points and the beginning of the CSV file that you want to output.</p>
<div id="highlighter_547581" class="syntaxhighlighter  "><div class="bar"><div class="toolbar"><a href="http://flowingdata.com/2013/09/12/working-with-line-maps-the-google-places-api-and-r/#viewSource" title="view source" class="item viewSource" style="width: 16px; height: 16px;">view source</a><div class="item copyToClipboard"><embed width="16" height="16" id="highlighter_547581_clipboard" type="application/x-shockwave-flash" title="copy to clipboard" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_547581" menu="false" src="http://flowingdata.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter2/scripts/clipboard.swf"></div><a href="http://flowingdata.com/2013/09/12/working-with-line-maps-the-google-places-api-and-r/#printSource" title="print" class="item printSource" style="width: 16px; height: 16px;">print</a><a href="http://flowingdata.com/2013/09/12/working-with-line-maps-the-google-places-api-and-r/#about" title="?" class="item about" style="width: 16px; height: 16px;">?</a></div></div><div class="lines"><div class="line alt1"><table><tbody><tr><td class="number"><code>1</code></td><td class="content"><code class="comments"># Start in the northwest and iterate to the southeast</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>2</code></td><td class="content"><code class="plain">lat_curr </code><code class="keyword">=</code> <code class="plain">lat_NW</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>3</code></td><td class="content"><code class="plain">lng_curr </code><code class="keyword">=</code> <code class="plain">lng_NW</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>4</code></td><td class="content"><code class="plain">total_calls </code><code class="keyword">=</code> <code class="value">0</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>5</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>6</code></td><td class="content"><code class="comments"># Print CSV header</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>7</code></td><td class="content"><code class="functions">print</code> <code class="string">'lat,lng,latnear,lngnear,dist_miles'</code></td></tr></tbody></table></div></div></div>
<p>That's the setup. Time to iterate. Remember, as shown below, you start in the northwest, ask Google for the nearest grocery store, move east 20 miles, ask again until you reach the east coast, and then go back to the west coast 20 miles south, and then go across again. Repeat until you reach the south part of Florida.</p>
<p>You do this with two loops. The outside loop covers latitude and the inside loop covers longitude.</p>
<div id="highlighter_946500" class="syntaxhighlighter  "><div class="bar"><div class="toolbar"><a href="http://flowingdata.com/2013/09/12/working-with-line-maps-the-google-places-api-and-r/#viewSource" title="view source" class="item viewSource" style="width: 16px; height: 16px;">view source</a><div class="item copyToClipboard"><embed width="16" height="16" id="highlighter_946500_clipboard" type="application/x-shockwave-flash" title="copy to clipboard" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_946500" menu="false" src="http://flowingdata.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter2/scripts/clipboard.swf"></div><a href="http://flowingdata.com/2013/09/12/working-with-line-maps-the-google-places-api-and-r/#printSource" title="print" class="item printSource" style="width: 16px; height: 16px;">print</a><a href="http://flowingdata.com/2013/09/12/working-with-line-maps-the-google-places-api-and-r/#about" title="?" class="item about" style="width: 16px; height: 16px;">?</a></div></div><div class="lines"><div class="line alt1"><table><tbody><tr><td class="number"><code>1</code></td><td class="content"><code class="keyword">while</code> <code class="plain">lat_curr &gt; lat_SE:</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>2</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>3</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">lng_curr </code><code class="keyword">=</code> <code class="plain">lng_NW</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>4</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>5</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword">while</code> <code class="plain">lng_curr &lt; lng_SE:</code></td></tr></tbody></table></div></div></div>
<p>Put together the URL at each iteration. The only thing that changes each iteration is the location, which is the latitude followed by longitude, separated by a comma.</p>
<div id="highlighter_317419" class="syntaxhighlighter  "><div class="bar"><div class="toolbar"><a href="http://flowingdata.com/2013/09/12/working-with-line-maps-the-google-places-api-and-r/#viewSource" title="view source" class="item viewSource" style="width: 16px; height: 16px;">view source</a><div class="item copyToClipboard"><embed width="16" height="16" id="highlighter_317419_clipboard" type="application/x-shockwave-flash" title="copy to clipboard" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_317419" menu="false" src="http://flowingdata.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter2/scripts/clipboard.swf"></div><a href="http://flowingdata.com/2013/09/12/working-with-line-maps-the-google-places-api-and-r/#printSource" title="print" class="item printSource" style="width: 16px; height: 16px;">print</a><a href="http://flowingdata.com/2013/09/12/working-with-line-maps-the-google-places-api-and-r/#about" title="?" class="item about" style="width: 16px; height: 16px;">?</a></div></div><div class="lines"><div class="line alt1"><table><tbody><tr><td class="number"><code>1</code></td><td class="content"><code class="plain">curr_location </code><code class="keyword">=</code> <code class="functions">str</code><code class="plain">(lat_curr) </code><code class="keyword">+</code> <code class="string">","</code> <code class="keyword">+</code> <code class="functions">str</code><code class="plain">(lng_curr)</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>2</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>3</code></td><td class="content"><code class="comments"># 10-mile search radius</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>4</code></td><td class="content"><code class="plain">url </code><code class="keyword">=</code> <code class="string">'<a href="https://maps.googleapis.com/maps/api/place/search/json?location=">https://maps.googleapis.com/maps/api/place/search/json?location=</a>'</code> <code class="keyword">+</code> <code class="plain">curr_location </code><code class="keyword">+</code> <code class="string">'&amp;sensor=false&amp;key='</code> <code class="keyword">+</code> <code class="plain">GOOGLE_API_KEY </code><code class="keyword">+</code> <code class="string">'&amp;radius=16100&amp;types=grocery_or_supermarket'</code></td></tr></tbody></table></div></div></div>
<p>With full URL in hand, download the result with <code>urlopen()</code> and parse the JSON result with <code>simplejson.loads()</code>.</p>
<div id="highlighter_357688" class="syntaxhighlighter  "><div class="bar"><div class="toolbar"><a href="http://flowingdata.com/2013/09/12/working-with-line-maps-the-google-places-api-and-r/#viewSource" title="view source" class="item viewSource" style="width: 16px; height: 16px;">view source</a><div class="item copyToClipboard"><embed width="16" height="16" id="highlighter_357688_clipboard" type="application/x-shockwave-flash" title="copy to clipboard" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_357688" menu="false" src="http://flowingdata.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter2/scripts/clipboard.swf"></div><a href="http://flowingdata.com/2013/09/12/working-with-line-maps-the-google-places-api-and-r/#printSource" title="print" class="item printSource" style="width: 16px; height: 16px;">print</a><a href="http://flowingdata.com/2013/09/12/working-with-line-maps-the-google-places-api-and-r/#about" title="?" class="item about" style="width: 16px; height: 16px;">?</a></div></div><div class="lines"><div class="line alt1"><table><tbody><tr><td class="number"><code>1</code></td><td class="content"><code class="plain"># Ping the API</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>2</code></td><td class="content"><code class="plain">response = urllib2.urlopen(url)</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>3</code></td><td class="content"><code class="plain">result = response.read()</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>4</code></td><td class="content"><code class="plain">d = simplejson.loads(result)</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>5</code></td><td class="content"><code class="plain">total_calls += 1</code></td></tr></tbody></table></div></div></div>
<p><span class="tip">You can also set <code>rankby</code> in the API url to "distance," but I found it often returns empty results when there was something nearby.</span>Find the nearest grocery store in the set of Google search results and then print the latitude and longitude, along with the distance, which you find with <code>distance_on_unit_sphere()</code></p>
<div id="highlighter_998441" class="syntaxhighlighter  "><div class="bar"><div class="toolbar"><a href="http://flowingdata.com/2013/09/12/working-with-line-maps-the-google-places-api-and-r/#viewSource" title="view source" class="item viewSource" style="width: 16px; height: 16px;">view source</a><div class="item copyToClipboard"><embed width="16" height="16" id="highlighter_998441_clipboard" type="application/x-shockwave-flash" title="copy to clipboard" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_998441" menu="false" src="http://flowingdata.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter2/scripts/clipboard.swf"></div><a href="http://flowingdata.com/2013/09/12/working-with-line-maps-the-google-places-api-and-r/#printSource" title="print" class="item printSource" style="width: 16px; height: 16px;">print</a><a href="http://flowingdata.com/2013/09/12/working-with-line-maps-the-google-places-api-and-r/#about" title="?" class="item about" style="width: 16px; height: 16px;">?</a></div></div><div class="lines"><div class="line alt1"><table><tbody><tr><td class="number"><code>1</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="comments"># Output nearest grocery store</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>2</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword">if</code> <code class="functions">len</code><code class="plain">(d[</code><code class="string">'results'</code><code class="plain">]) &gt; </code><code class="value">0</code><code class="plain">:</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>3</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>4</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">least_miles </code><code class="keyword">=</code> <code class="value">999999999</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>5</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword">for</code> <code class="plain">g </code><code class="keyword">in</code> <code class="plain">d[</code><code class="string">'results'</code><code class="plain">]:</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>6</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">near_lat </code><code class="keyword">=</code> <code class="plain">g[</code><code class="string">'geometry'</code><code class="plain">][</code><code class="string">'location'</code><code class="plain">][</code><code class="string">'lat'</code><code class="plain">]</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>7</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">near_lng </code><code class="keyword">=</code> <code class="plain">g[</code><code class="string">'geometry'</code><code class="plain">][</code><code class="string">'location'</code><code class="plain">][</code><code class="string">'lng'</code><code class="plain">]</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>8</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">dist_miles </code><code class="keyword">=</code> <code class="plain">distance_on_unit_sphere(lat_curr, lng_curr, near_lat, near_lng)</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>9</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword">if</code> <code class="plain">dist_miles &lt; least_miles:</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>10</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">least_miles </code><code class="keyword">=</code> <code class="plain">dist_miles</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>11</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">nearest_lat </code><code class="keyword">=</code> <code class="plain">near_lat</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>12</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">nearest_lng </code><code class="keyword">=</code> <code class="plain">near_lng</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>13</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword">print</code> <code class="plain">curr_location </code><code class="keyword">+</code> <code class="string">','</code> <code class="keyword">+</code> <code class="functions">str</code><code class="plain">(nearest_lat) </code><code class="keyword">+</code> <code class="string">','</code> <code class="keyword">+</code> <code class="functions">str</code><code class="plain">(nearest_lng) </code><code class="keyword">+</code> <code class="string">','</code> <code class="keyword">+</code> <code class="functions">str</code><code class="plain">(least_miles)</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>14</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>15</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="comments"># Or no location found</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>16</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword">else</code><code class="plain">:</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>17</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="functions">print</code> <code class="plain">curr_location </code><code class="keyword">+</code> <code class="string">',,,'</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>18</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>19</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">lng_curr </code><code class="keyword">+</code><code class="keyword">=</code> <code class="plain">lng_incr</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>20</code></td><td class="content"><code class="plain">lat_curr </code><code class="keyword">+</code><code class="keyword">=</code> <code class="plain">lat_incr</code></td></tr></tbody></table></div></div></div>
<p>Run the code as shown below and this gets you a CSV file called nearest-grocery.csv.</p>
<p><span class="tip">Running a Python script in the terminal.</span><img src="./Working with Line Maps, the Google Places API, and R_files/Run-Python-script.png" alt="Run Python script" class="alignnone size-full wp-image-32281" width="604" height="409" src-orig="http://i1.wp.com/flowingdata.com/wp-content/uploads/2013/09/Run-Python-script.png?resize=604%2C409" scale="2"></p>
<p>It's possible the API or your internet connection might crap out before the script finishes. If this happens, set <code>lat_curr</code> and <code>lng_curr</code> to the last searched for coordinates in nearest-grocery.csv. Be sure to store those results in a different file, or it will overwrite the original file. Repeat as needed.</p>
<h2>Refine the data</h2>
<p>You could stop here, and go straight to mapping, but the data isn't quite there yet. There are some gaps in the north and some random spots in Mexico and Canada. There are also some lines that extend into the ocean, which provides a sort of cool visual, but it doesn't make that much sense in reality.</p>
<p><span class="tip">You're getting close to map time, but the data isn't quite complete yet.</span><img src="./Working with Line Maps, the Google Places API, and R_files/Incomplete-data.png" alt="Incomplete data" class="alignnone size-medium wp-image-32287" width="625" height="392" src-orig="http://i0.wp.com/flowingdata.com/wp-content/uploads/2013/09/Incomplete-data.png?resize=625%2C392" scale="2"></p>
<p>This is when MySQL comes in. Create a database, and a table named "grocery" with the following SQL.</p>
<div id="highlighter_380865" class="syntaxhighlighter  "><div class="bar"><div class="toolbar"><a href="http://flowingdata.com/2013/09/12/working-with-line-maps-the-google-places-api-and-r/#viewSource" title="view source" class="item viewSource" style="width: 16px; height: 16px;">view source</a><div class="item copyToClipboard"><embed width="16" height="16" id="highlighter_380865_clipboard" type="application/x-shockwave-flash" title="copy to clipboard" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_380865" menu="false" src="http://flowingdata.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter2/scripts/clipboard.swf"></div><a href="http://flowingdata.com/2013/09/12/working-with-line-maps-the-google-places-api-and-r/#printSource" title="print" class="item printSource" style="width: 16px; height: 16px;">print</a><a href="http://flowingdata.com/2013/09/12/working-with-line-maps-the-google-places-api-and-r/#about" title="?" class="item about" style="width: 16px; height: 16px;">?</a></div></div><div class="lines"><div class="line alt1"><table><tbody><tr><td class="number"><code>1</code></td><td class="content"><code class="keyword">CREATE</code> <code class="keyword">TABLE</code> <code class="plain">IF </code><code class="color1">NOT</code> <code class="plain">EXISTS `grocery` (</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>2</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">`id` </code><code class="keyword">int</code><code class="plain">(11) </code><code class="color1">NOT</code> <code class="color1">NULL</code> <code class="plain">auto_increment,</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>3</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">`latitude` </code><code class="keyword">decimal</code><code class="plain">(10,7) </code><code class="color1">NOT</code> <code class="color1">NULL</code><code class="plain">,</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>4</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">`longitude` </code><code class="keyword">decimal</code><code class="plain">(10,7) </code><code class="color1">NOT</code> <code class="color1">NULL</code><code class="plain">,</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>5</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">PRIMARY</code> <code class="keyword">KEY</code>&nbsp; <code class="plain">(`id`)</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>6</code></td><td class="content"><code class="plain">) ENGINE=MyISAM&nbsp; </code><code class="keyword">DEFAULT</code> <code class="plain">CHARSET=latin1 AUTO_INCREMENT=1 ;</code></td></tr></tbody></table></div></div></div>
<p>Import <strong>nearest-grocery.csv</strong> using <strong>import-grocery.py</strong>. The code below assumes you created the the grocery table already in a database named "places." I won't go into too much detail since there's plenty of existing documentation on importing data into a MySQL database, but the basic logic is:</p>
<ol>
<li>Use MySQLdb and csv libraries to handle CSV file and interact with your database.</li>
<li>Open each grocery location file. In my case, it took six tries, which is why there are 6 files, but only 2 through 7 are needed.</li>
<li>For each row, make sure the location doesn't already exist in the database. If it does not exist yet, insert the row.</li>
</ol>
<div id="highlighter_721744" class="syntaxhighlighter  "><div class="bar"><div class="toolbar"><a href="http://flowingdata.com/2013/09/12/working-with-line-maps-the-google-places-api-and-r/#viewSource" title="view source" class="item viewSource" style="width: 16px; height: 16px;">view source</a><div class="item copyToClipboard"><embed width="16" height="16" id="highlighter_721744_clipboard" type="application/x-shockwave-flash" title="copy to clipboard" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_721744" menu="false" src="http://flowingdata.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter2/scripts/clipboard.swf"></div><a href="http://flowingdata.com/2013/09/12/working-with-line-maps-the-google-places-api-and-r/#printSource" title="print" class="item printSource" style="width: 16px; height: 16px;">print</a><a href="http://flowingdata.com/2013/09/12/working-with-line-maps-the-google-places-api-and-r/#about" title="?" class="item about" style="width: 16px; height: 16px;">?</a></div></div><div class="lines"><div class="line alt1"><table><tbody><tr><td class="number"><code>1</code></td><td class="content"><code class="keyword">import</code> <code class="plain">MySQLdb, csv</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>2</code></td><td class="content"><code class="plain">db </code><code class="keyword">=</code> <code class="plain">MySQLdb.connect(user</code><code class="keyword">=</code><code class="string">"root"</code><code class="plain">, db</code><code class="keyword">=</code><code class="string">"places"</code><code class="plain">)</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>3</code></td><td class="content"><code class="plain">c </code><code class="keyword">=</code> <code class="plain">db.cursor()</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>4</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>5</code></td><td class="content"><code class="keyword">for</code> <code class="plain">i </code><code class="keyword">in</code> <code class="functions">range</code><code class="plain">(</code><code class="value">2</code><code class="plain">,</code><code class="value">7</code><code class="plain">):</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>6</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">filename </code><code class="keyword">=</code> <code class="string">'nearest-grocery'</code> <code class="keyword">+</code> <code class="functions">str</code><code class="plain">(i) </code><code class="keyword">+</code> <code class="string">'.csv'</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>7</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">reader </code><code class="keyword">=</code> <code class="plain">csv.reader(</code><code class="functions">open</code><code class="plain">(filename, </code><code class="string">'rb'</code><code class="plain">), delimiter</code><code class="keyword">=</code><code class="string">','</code><code class="plain">)</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>8</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">skipped_header </code><code class="keyword">=</code> <code class="color1">False</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>9</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword">for</code> <code class="plain">row </code><code class="keyword">in</code> <code class="plain">reader:</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>10</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword">if</code> <code class="keyword">not</code> <code class="plain">skipped_header:</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>11</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">skipped_header </code><code class="keyword">=</code> <code class="color1">True</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>12</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword">continue</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>13</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>14</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="comments"># If no result from Google</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>15</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword">if</code> <code class="plain">row[</code><code class="value">2</code><code class="plain">] </code><code class="keyword">=</code><code class="keyword">=</code> <code class="plain">'</code><code class="string">' or row[3] == '</code><code class="plain">':</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>16</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword">continue</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>17</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>18</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="comments"># Only add unique locations</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>19</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">query </code><code class="keyword">=</code> <code class="string">"SELECT * FROM `grocery` WHERE `latitude` = '"</code> <code class="keyword">+</code> <code class="functions">str</code><code class="plain">(row[</code><code class="value">2</code><code class="plain">]) </code><code class="keyword">+</code> <code class="string">"' AND `longitude` = '"</code> <code class="keyword">+</code> <code class="functions">str</code><code class="plain">(row[</code><code class="value">3</code><code class="plain">]) </code><code class="keyword">+</code> <code class="comments">"'"</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>20</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="comments">c.execute(query)</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>21</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="comments">if len(c.fetchall()) &gt; 0:</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>22</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="comments">continue</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>23</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>24</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="comments">sql = "INSERT INTO `grocery` (latitude, longitude) VALUES ("</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>25</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="comments">sql += "'"</code> <code class="keyword">+</code> <code class="functions">str</code><code class="plain">(row[</code><code class="value">2</code><code class="plain">]) </code><code class="keyword">+</code> <code class="string">"','"</code> <code class="keyword">+</code> <code class="functions">str</code><code class="plain">(row[</code><code class="value">3</code><code class="plain">]) </code><code class="keyword">+</code> <code class="string">"'"</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>26</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">sql </code><code class="keyword">+</code><code class="keyword">=</code> <code class="string">")"</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>27</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">c.execute(sql)</code></td></tr></tbody></table></div></div></div>
<p>Then run <strong>get-nearest-grocery-full.py</strong>. It's similar to get-nearest-grocery.py in logic, except instead of asking Google for the nearest location, it asks your MySQL database. The output is a new CSV file, which you can save as <strong>nearest-grocery-full.csv</strong>.</p>
<h2>Make maps</h2>
<p>With properly formatted and complete data, the mapping process is relatively straightforward in R. Refer to <strong>map-grocery.R</strong> for the full code. First you make the national map, which only shows state boundaries, and then you can make the closer up state maps with roads.</p>
<div id="highlighter_474423" class="syntaxhighlighter  "><div class="bar"><div class="toolbar"><a href="http://flowingdata.com/2013/09/12/working-with-line-maps-the-google-places-api-and-r/#viewSource" title="view source" class="item viewSource" style="width: 16px; height: 16px;">view source</a><div class="item copyToClipboard"><embed width="16" height="16" id="highlighter_474423_clipboard" type="application/x-shockwave-flash" title="copy to clipboard" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_474423" menu="false" src="http://flowingdata.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter2/scripts/clipboard.swf"></div><a href="http://flowingdata.com/2013/09/12/working-with-line-maps-the-google-places-api-and-r/#printSource" title="print" class="item printSource" style="width: 16px; height: 16px;">print</a><a href="http://flowingdata.com/2013/09/12/working-with-line-maps-the-google-places-api-and-r/#about" title="?" class="item about" style="width: 16px; height: 16px;">?</a></div></div><div class="lines"><div class="line alt1"><table><tbody><tr><td class="number"><code>1</code></td><td class="content"><code class="functions">source</code><code class="plain">(</code><code class="string">'library/latlong2state.R'</code><code class="plain">)</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>2</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>3</code></td><td class="content"><code class="functions">library</code><code class="plain">(maps)</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>4</code></td><td class="content"><code class="functions">library</code><code class="plain">(mapproj)</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>5</code></td><td class="content"><code class="functions">library</code><code class="plain">(geosphere)</code></td></tr></tbody></table></div></div></div>
<p>The helper function below, <code>getLineColor()</code>, takes a value and outputs a corresponding color. In this example, you create a color ramp that goes from white to red, and the higher the value, the more red. Values greater than 50 are automatically given the most red shade. When you apply this to you own data, you'll probably want to change the color ramp and/or value ranges.</p>
<div id="highlighter_113643" class="syntaxhighlighter  "><div class="bar"><div class="toolbar"><a href="http://flowingdata.com/2013/09/12/working-with-line-maps-the-google-places-api-and-r/#viewSource" title="view source" class="item viewSource" style="width: 16px; height: 16px;">view source</a><div class="item copyToClipboard"><embed width="16" height="16" id="highlighter_113643_clipboard" type="application/x-shockwave-flash" title="copy to clipboard" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_113643" menu="false" src="http://flowingdata.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter2/scripts/clipboard.swf"></div><a href="http://flowingdata.com/2013/09/12/working-with-line-maps-the-google-places-api-and-r/#printSource" title="print" class="item printSource" style="width: 16px; height: 16px;">print</a><a href="http://flowingdata.com/2013/09/12/working-with-line-maps-the-google-places-api-and-r/#about" title="?" class="item about" style="width: 16px; height: 16px;">?</a></div></div><div class="lines"><div class="line alt1"><table><tbody><tr><td class="number"><code>1</code></td><td class="content"><code class="plain">getLineColor &lt;- </code><code class="keyword">function</code><code class="plain">(val) {</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>2</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">pal &lt;- </code><code class="functions">colorRampPalette</code><code class="plain">(</code><code class="functions">c</code><code class="plain">(</code><code class="string">"#ffffff"</code><code class="plain">, </code><code class="string">"red"</code><code class="plain">))</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>3</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">colors &lt;- </code><code class="functions">pal</code><code class="plain">(80)</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>4</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">val.log &lt;- </code><code class="functions">log</code><code class="plain">(val)</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>5</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>6</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="functions">if </code><code class="plain">(val &gt; 50) {</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>7</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">col &lt;- colors[80]</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>8</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">} </code><code class="keyword">else</code> <code class="plain">{</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>9</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">colindex &lt;- </code><code class="functions">max</code><code class="plain">( 1, </code><code class="functions">round</code><code class="plain">( 80 * val / 50 ) )</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>10</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">col &lt;- colors[colindex]</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>11</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>12</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>13</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="functions">return</code><code class="plain">(col)</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>14</code></td><td class="content"><code class="plain">}</code></td></tr></tbody></table></div></div></div>
<p>You get back to this function in the next few lines, but first, load the grocery store data in <strong>nearest-grocery-store-full.csv</strong> with <code>read.csv()</code>.</p>
<div id="highlighter_533520" class="syntaxhighlighter  "><div class="bar"><div class="toolbar"><a href="http://flowingdata.com/2013/09/12/working-with-line-maps-the-google-places-api-and-r/#viewSource" title="view source" class="item viewSource" style="width: 16px; height: 16px;">view source</a><div class="item copyToClipboard"><embed width="16" height="16" id="highlighter_533520_clipboard" type="application/x-shockwave-flash" title="copy to clipboard" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_533520" menu="false" src="http://flowingdata.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter2/scripts/clipboard.swf"></div><a href="http://flowingdata.com/2013/09/12/working-with-line-maps-the-google-places-api-and-r/#printSource" title="print" class="item printSource" style="width: 16px; height: 16px;">print</a><a href="http://flowingdata.com/2013/09/12/working-with-line-maps-the-google-places-api-and-r/#about" title="?" class="item about" style="width: 16px; height: 16px;">?</a></div></div><div class="lines"><div class="line alt1"><table><tbody><tr><td class="number"><code>1</code></td><td class="content"><code class="comments"># Load the data</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>2</code></td><td class="content"><code class="plain">grocery &lt;- </code><code class="functions">read.csv</code><code class="plain">(</code><code class="string">"nearest-grocery-full.csv"</code><code class="plain">, stringsAsFactors=</code><code class="keyword">FALSE</code><code class="plain">)</code></td></tr></tbody></table></div></div></div>
<p>Use the helper function <code>latlong2state()</code> to filter out the locations in the data that aren't within the boundaries of the United States. Remember there are two locations for each row of data: the origin and destination, so the function is called on both latitude-longitude pairs. The <code>latlong2state()</code> returns <code>NA</code> if the location is not in a state, so you can use <code>na.omit()</code> to remove any rows of data that aren't in the country.</p>
<div id="highlighter_828862" class="syntaxhighlighter  "><div class="bar"><div class="toolbar"><a href="http://flowingdata.com/2013/09/12/working-with-line-maps-the-google-places-api-and-r/#viewSource" title="view source" class="item viewSource" style="width: 16px; height: 16px;">view source</a><div class="item copyToClipboard"><embed width="16" height="16" id="highlighter_828862_clipboard" type="application/x-shockwave-flash" title="copy to clipboard" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_828862" menu="false" src="http://flowingdata.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter2/scripts/clipboard.swf"></div><a href="http://flowingdata.com/2013/09/12/working-with-line-maps-the-google-places-api-and-r/#printSource" title="print" class="item printSource" style="width: 16px; height: 16px;">print</a><a href="http://flowingdata.com/2013/09/12/working-with-line-maps-the-google-places-api-and-r/#about" title="?" class="item about" style="width: 16px; height: 16px;">?</a></div></div><div class="lines"><div class="line alt1"><table><tbody><tr><td class="number"><code>1</code></td><td class="content"><code class="comments"># Omit locations not in US</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>2</code></td><td class="content"><code class="plain">grocery$state &lt;- </code><code class="functions">latlong2state</code><code class="plain">(</code><code class="functions">data.frame</code><code class="plain">(grocery$lng, grocery$lat))</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>3</code></td><td class="content"><code class="plain">grocery$nearstate &lt;- </code><code class="functions">latlong2state</code><code class="plain">(</code><code class="functions">data.frame</code><code class="plain">(grocery$lngnear, grocery$latnear))</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>4</code></td><td class="content"><code class="plain">grocery &lt;- </code><code class="functions">na.omit</code><code class="plain">(grocery)</code></td></tr></tbody></table></div></div></div>
<p>The code to draw a national map is similar to what we saw towards the end of the <a href="http://flowingdata.com/2013/02/19/using-transparency-in-r-to-improve-clarity/">transparency tutorial</a> or the one on <a href="http://flowingdata.com/2011/05/11/how-to-map-connections-with-great-circles/">how to map connections with great circles</a>. Draw a base map and then lines on top of that. Here's how to draw the base map, which assumes you loaded the maps package.</p>
<div id="highlighter_860427" class="syntaxhighlighter  "><div class="bar"><div class="toolbar"><a href="http://flowingdata.com/2013/09/12/working-with-line-maps-the-google-places-api-and-r/#viewSource" title="view source" class="item viewSource" style="width: 16px; height: 16px;">view source</a><div class="item copyToClipboard"><embed width="16" height="16" id="highlighter_860427_clipboard" type="application/x-shockwave-flash" title="copy to clipboard" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_860427" menu="false" src="http://flowingdata.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter2/scripts/clipboard.swf"></div><a href="http://flowingdata.com/2013/09/12/working-with-line-maps-the-google-places-api-and-r/#printSource" title="print" class="item printSource" style="width: 16px; height: 16px;">print</a><a href="http://flowingdata.com/2013/09/12/working-with-line-maps-the-google-places-api-and-r/#about" title="?" class="item about" style="width: 16px; height: 16px;">?</a></div></div><div class="lines"><div class="line alt1"><table><tbody><tr><td class="number"><code>1</code></td><td class="content"><code class="comments"># Draw base map</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>2</code></td><td class="content"><code class="functions">map</code><code class="plain">(</code><code class="string">"state"</code><code class="plain">, proj=</code><code class="string">"albers"</code><code class="plain">, param=</code><code class="functions">c</code><code class="plain">(39, 45), col=</code><code class="string">"#cccccc"</code><code class="plain">, fill=</code><code class="keyword">FALSE</code><code class="plain">, bg=</code><code class="string">"#ffffff"</code><code class="plain">, lwd=0.8)</code></td></tr></tbody></table></div></div></div>
<p><span class="tip">The <a href="http://www.milanor.net/blog/?p=534">quick article</a> by Max Marchi provides sample code to draw European maps.</span>As you expect, you get a map with state boundaries. If you deal with non-US data, you can use "world" instead of "state" and then experiment with the <code>param</code> argument, which specifies where to focus.</p>
<p><span class="tip">A blank state map sets the foundation.</span><img src="./Working with Line Maps, the Google Places API, and R_files/Blank-state-map.png" alt="Blank state map" class="alignnone size-medium wp-image-32282" width="625" height="407" src-orig="http://i2.wp.com/flowingdata.com/wp-content/uploads/2013/09/Blank-state-map.png?resize=625%2C407" scale="2"></p>
<p>Use <code>mapproject()</code> to project the latitude and longitude coordinates to the current map. The first call projects the origins and the second call projects the nearest grocery stores. Then with <code>sapply()</code>, apply the previously made helper function <code>getLineColor()</code> to the values of <code>dist_miles</code>.</p>
<div id="highlighter_550498" class="syntaxhighlighter  "><div class="bar"><div class="toolbar"><a href="http://flowingdata.com/2013/09/12/working-with-line-maps-the-google-places-api-and-r/#viewSource" title="view source" class="item viewSource" style="width: 16px; height: 16px;">view source</a><div class="item copyToClipboard"><embed width="16" height="16" id="highlighter_550498_clipboard" type="application/x-shockwave-flash" title="copy to clipboard" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_550498" menu="false" src="http://flowingdata.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter2/scripts/clipboard.swf"></div><a href="http://flowingdata.com/2013/09/12/working-with-line-maps-the-google-places-api-and-r/#printSource" title="print" class="item printSource" style="width: 16px; height: 16px;">print</a><a href="http://flowingdata.com/2013/09/12/working-with-line-maps-the-google-places-api-and-r/#about" title="?" class="item about" style="width: 16px; height: 16px;">?</a></div></div><div class="lines"><div class="line alt1"><table><tbody><tr><td class="number"><code>1</code></td><td class="content"><code class="comments"># Calculate colors</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>2</code></td><td class="content"><code class="plain">pts0 &lt;- </code><code class="functions">mapproject</code><code class="plain">(</code><code class="functions">unlist</code><code class="plain">(grocery[, </code><code class="string">'lng'</code><code class="plain">]), </code><code class="functions">unlist</code><code class="plain">(grocery[, </code><code class="string">'lat'</code><code class="plain">]))</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>3</code></td><td class="content"><code class="plain">pts1 &lt;- </code><code class="functions">mapproject</code><code class="plain">(</code><code class="functions">unlist</code><code class="plain">(grocery[, </code><code class="string">'lngnear'</code><code class="plain">]), </code><code class="functions">unlist</code><code class="plain">(grocery[, </code><code class="string">'latnear'</code><code class="plain">]))</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>4</code></td><td class="content"><code class="plain">seg.colors &lt;- </code><code class="functions">sapply</code><code class="plain">(grocery$dist_miles, FUN=getLineColor)</code></td></tr></tbody></table></div></div></div>
<p>Now draw the segments with the processed data.</p>
<div id="highlighter_368035" class="syntaxhighlighter  "><div class="bar"><div class="toolbar"><a href="http://flowingdata.com/2013/09/12/working-with-line-maps-the-google-places-api-and-r/#viewSource" title="view source" class="item viewSource" style="width: 16px; height: 16px;">view source</a><div class="item copyToClipboard"><embed width="16" height="16" id="highlighter_368035_clipboard" type="application/x-shockwave-flash" title="copy to clipboard" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_368035" menu="false" src="http://flowingdata.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter2/scripts/clipboard.swf"></div><a href="http://flowingdata.com/2013/09/12/working-with-line-maps-the-google-places-api-and-r/#printSource" title="print" class="item printSource" style="width: 16px; height: 16px;">print</a><a href="http://flowingdata.com/2013/09/12/working-with-line-maps-the-google-places-api-and-r/#about" title="?" class="item about" style="width: 16px; height: 16px;">?</a></div></div><div class="lines"><div class="line alt1"><table><tbody><tr><td class="number"><code>1</code></td><td class="content"><code class="comments"># Draw map and line segments</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>2</code></td><td class="content"><code class="functions">segments</code><code class="plain">(pts0$x, pts0$y, pts1$x, pts1$y, col=seg.colors, lwd=0.8)</code></td></tr></tbody></table></div></div></div>
<p></p>
<p>You get the finished map below.</p>
<p><span class="tip">The map now shows a completed dataset.</span><img src="./Working with Line Maps, the Google Places API, and R_files/Nearest-grocery-all.png" alt="Nearest grocery all" class="alignnone size-medium wp-image-32283" width="625" height="412" src-orig="http://i0.wp.com/flowingdata.com/wp-content/uploads/2013/09/Nearest-grocery-all.png?resize=625%2C412" scale="2"></p>
<p>However, at the national level, you miss out on details and landmarks. For this dataset in particular, the view doesn't help a local citizen point out food deserts where they live, so for a more detailed view, we turn to the ggmap package. With the same data you use above, it's straightforward to make a similar map with Google street maps in the background for context.</p>
<p><span class="tip">In R, go to the Packages &amp; Data &gt; Package Installer menu and select ggmap to install.</span>So load (or install first, and then load) the package.</p>
<div id="highlighter_105994" class="syntaxhighlighter  "><div class="bar"><div class="toolbar"><a href="http://flowingdata.com/2013/09/12/working-with-line-maps-the-google-places-api-and-r/#viewSource" title="view source" class="item viewSource" style="width: 16px; height: 16px;">view source</a><div class="item copyToClipboard"><embed width="16" height="16" id="highlighter_105994_clipboard" type="application/x-shockwave-flash" title="copy to clipboard" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_105994" menu="false" src="http://flowingdata.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter2/scripts/clipboard.swf"></div><a href="http://flowingdata.com/2013/09/12/working-with-line-maps-the-google-places-api-and-r/#printSource" title="print" class="item printSource" style="width: 16px; height: 16px;">print</a><a href="http://flowingdata.com/2013/09/12/working-with-line-maps-the-google-places-api-and-r/#about" title="?" class="item about" style="width: 16px; height: 16px;">?</a></div></div><div class="lines"><div class="line alt1"><table><tbody><tr><td class="number"><code>1</code></td><td class="content"><code class="functions">library</code><code class="plain">(ggmap)</code></td></tr></tbody></table></div></div></div>
<p><span class="tip">For more on how/why this code works, see <a href="http://ggplot2.org/">the ggplot2 site</a> for full documentation.</span>And with the helper function <code>stateMap()</code> below, you can easily make a map. The first line of the function uses <code>get_map()</code> to fetch a base map from Google within a region specified by <code>bbox</code>. Then points, segments, and color gradients are applied to the map. In case this syntax looks foreign to you, the ggmap package is an extension of Hadley Wickham's <a href="http://ggplot2.org/">ggplot2 package</a>, which approaches graphics as layers.</p>
<div id="highlighter_813102" class="syntaxhighlighter  "><div class="bar"><div class="toolbar"><a href="http://flowingdata.com/2013/09/12/working-with-line-maps-the-google-places-api-and-r/#viewSource" title="view source" class="item viewSource" style="width: 16px; height: 16px;">view source</a><div class="item copyToClipboard"><embed width="16" height="16" id="highlighter_813102_clipboard" type="application/x-shockwave-flash" title="copy to clipboard" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_813102" menu="false" src="http://flowingdata.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter2/scripts/clipboard.swf"></div><a href="http://flowingdata.com/2013/09/12/working-with-line-maps-the-google-places-api-and-r/#printSource" title="print" class="item printSource" style="width: 16px; height: 16px;">print</a><a href="http://flowingdata.com/2013/09/12/working-with-line-maps-the-google-places-api-and-r/#about" title="?" class="item about" style="width: 16px; height: 16px;">?</a></div></div><div class="lines"><div class="line alt1"><table><tbody><tr><td class="number"><code>1</code></td><td class="content"><code class="comments">#</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>2</code></td><td class="content"><code class="comments"># Map more specific locations</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>3</code></td><td class="content"><code class="comments">#</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>4</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>5</code></td><td class="content"><code class="plain">stateMap &lt;- </code><code class="keyword">function</code><code class="plain">(bbox, thedata) {</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>6</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">basemap &lt;- </code><code class="functions">get_map</code><code class="plain">(location=bbox, zoom=7, source=</code><code class="string">'google'</code><code class="plain">, maptype=</code><code class="string">"terrain"</code><code class="plain">, color=</code><code class="string">"bw"</code><code class="plain">)</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>7</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="functions">ggmap</code><code class="plain">(basemap) + </code><code class="functions">geom_segment</code><code class="plain">(</code><code class="functions">aes</code><code class="plain">(x=lng, xend=lngnear, y=lat, yend=latnear, colour=dist_miles), size=0.6, data=thedata) + </code><code class="functions">geom_point</code><code class="plain">(</code><code class="functions">aes</code><code class="plain">(x=lngnear, y=latnear), size=1.5, color=</code><code class="string">"#000000"</code><code class="plain">, border=</code><code class="string">"black"</code><code class="plain">, data=thedata) + </code><code class="functions">scale_colour_gradient</code><code class="plain">(low=</code><code class="string">"white"</code><code class="plain">, high=</code><code class="string">"red"</code><code class="plain">, limits=</code><code class="functions">c</code><code class="plain">(0, 60))</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>8</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>9</code></td><td class="content"><code class="plain">}</code></td></tr></tbody></table></div></div></div>
<p><span class="tip">As before, the <a href="http://www.gorissen.info/Pierre/maps/googleMapLocationv3.php">latitude and longitude popup tool</a> is useful to quickly get coordinates via point and click.</span>Now let's say you want to make a map for Montana. Get the latitude and longitude for the northwest corner of the state and then the latitude and longitude for the southeast corner. This gives you a bounding box, which you can pass to <code>stateMap()</code>. You can also subset the data to just locations in Montana.</p>
<div id="highlighter_716176" class="syntaxhighlighter  "><div class="bar"><div class="toolbar"><a href="http://flowingdata.com/2013/09/12/working-with-line-maps-the-google-places-api-and-r/#viewSource" title="view source" class="item viewSource" style="width: 16px; height: 16px;">view source</a><div class="item copyToClipboard"><embed width="16" height="16" id="highlighter_716176_clipboard" type="application/x-shockwave-flash" title="copy to clipboard" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_716176" menu="false" src="http://flowingdata.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter2/scripts/clipboard.swf"></div><a href="http://flowingdata.com/2013/09/12/working-with-line-maps-the-google-places-api-and-r/#printSource" title="print" class="item printSource" style="width: 16px; height: 16px;">print</a><a href="http://flowingdata.com/2013/09/12/working-with-line-maps-the-google-places-api-and-r/#about" title="?" class="item about" style="width: 16px; height: 16px;">?</a></div></div><div class="lines"><div class="line alt1"><table><tbody><tr><td class="number"><code>1</code></td><td class="content"><code class="comments"># States (bottom left lng, bottom left lat, top right lng, top right lat)</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>2</code></td><td class="content"><code class="plain">montana &lt;- </code><code class="functions">c</code><code class="plain">(-116.23363635500002, 44.11419853862171, -103.48949572999454, 49.349270649782994)</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>3</code></td><td class="content"><code class="functions">stateMap</code><code class="plain">(montana, </code><code class="functions">subset</code><code class="plain">(grocery, state==</code><code class="string">'montana'</code><code class="plain">))</code></td></tr></tbody></table></div></div></div>
<p>And you get a map similar to the national one, except now you see roads and some terrain and dots for each grocery store in the area.</p>
<p><span class="tip">Google map tiles lend context to locations.</span><img src="./Working with Line Maps, the Google Places API, and R_files/Montana-map.png" alt="Montana map" class="alignnone size-medium wp-image-32284" width="625" height="352" src-orig="http://i2.wp.com/flowingdata.com/wp-content/uploads/2013/09/Montana-map.png?resize=625%2C352" scale="2"></p>
<p>Try it one more time, but this time set the bounding box to span four states.</p>
<div id="highlighter_824222" class="syntaxhighlighter  "><div class="bar"><div class="toolbar"><a href="http://flowingdata.com/2013/09/12/working-with-line-maps-the-google-places-api-and-r/#viewSource" title="view source" class="item viewSource" style="width: 16px; height: 16px;">view source</a><div class="item copyToClipboard"><embed width="16" height="16" id="highlighter_824222_clipboard" type="application/x-shockwave-flash" title="copy to clipboard" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_824222" menu="false" src="http://flowingdata.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter2/scripts/clipboard.swf"></div><a href="http://flowingdata.com/2013/09/12/working-with-line-maps-the-google-places-api-and-r/#printSource" title="print" class="item printSource" style="width: 16px; height: 16px;">print</a><a href="http://flowingdata.com/2013/09/12/working-with-line-maps-the-google-places-api-and-r/#about" title="?" class="item about" style="width: 16px; height: 16px;">?</a></div></div><div class="lines"><div class="line alt1"><table><tbody><tr><td class="number"><code>1</code></td><td class="content"><code class="plain">nv.ut.ca.az &lt;- </code><code class="functions">c</code><code class="plain">(-124.23168322999285, 31.460280893111246, -108.14769885499943, 42.32097191215088)</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>2</code></td><td class="content"><code class="functions">stateMap</code><code class="plain">(nv.ut.ca.az, </code><code class="functions">subset</code><code class="plain">(grocery, state==</code><code class="string">'nevada'</code> <code class="plain">| state == </code><code class="string">'utah'</code> <code class="plain">| state == </code><code class="string">'california'</code> <code class="plain">| state == </code><code class="string">'arizona'</code><code class="plain">))</code></td></tr></tbody></table></div></div></div>
<p>As expected, you get a map that shows Nevada, Utah, California, and Arizona.</p>
<p><span class="tip">You can map more than one state at a time.</span><img src="./Working with Line Maps, the Google Places API, and R_files/West-map.png" alt="West map" class="alignnone size-medium wp-image-32285" width="625" height="528" src-orig="http://i2.wp.com/flowingdata.com/wp-content/uploads/2013/09/West-map.png?resize=625%2C528" scale="2"></p>
<h2>Wrapping up</h2>
<p>We often get caught thinking of visualization as a self-encapsulated task and then get stuck when it's time to actually start, because there's no real data. Get the data first and then visualize. Not the other way around.</p>
<p>This tutorial accesses data via the Google API, but accessing other APIs is typically a similar process. The key is to figure out the arguments, restrictions, and the various method calls, which are typically described in the documentation. The bigger APIs usually have pretty good docs.</p>
<p>Once you get the data, the visualization process is just like any other visualization. Start with the base and work your way up.</p>
<div class="clear-line"></div>
</div> 
</div> 
<div class="clear-line"></div>
<div id="end"></div>
 
<span id="comments"></span>
<div style="width:625px">
<div id="comments-block">
<h2>3 Comments</h2>
<ul class="commentlist">
<li class="comment byuser comment-author-nateakadino even thread-even depth-1" id="li-comment-239808">
<div id="comment-239808" class="">
<div class="avatar">
<img alt="" src="./Working with Line Maps, the Google Places API, and R_files/e92ac21e948bd67ca7fd03aa58b9f391" class="avatar avatar-50 photo" height="50" width="50" originals="50" src-orig="http://0.gravatar.com/avatar/e92ac21e948bd67ca7fd03aa58b9f391?s=50&amp;d=http%3A%2F%2Fflowingdata.com%2Fwp-content%2Fthemes%2Fflowingdata-4-8%2Fimages%2Fblank-square.png%3Fs%3D50&amp;r=PG" scale="2"> </div> 
<div class="comment-content">
<div class="comment-author vcard">
<cite class="fn">Nathan Brigmon</cite> <span class="comment-meta">â <a href="http://flowingdata.com/2013/09/12/working-with-line-maps-the-google-places-api-and-r/#comment-239808">September 16, 2013 at 5:11 pm</a>
</span>
</div>
<div class="comment-text"><p>Hi! Could you point to a good tutorial or resource for learning how to work with MySQL? Iâm having trouble with the part where we need to create a database and a table named âgroceryâ with SQL.</p>
<p>Thanks!</p>
</div>
<div class="reply">
</div>
</div> 
<div class="clear-line"></div>
</div>
<ul class="children">
<li class="comment byuser comment-author-nateakadino odd alt depth-2" id="li-comment-239809">
<div id="comment-239809" class="">
<div class="avatar">
<img alt="" src="./Working with Line Maps, the Google Places API, and R_files/e92ac21e948bd67ca7fd03aa58b9f391" class="avatar avatar-50 photo" height="50" width="50" originals="50" src-orig="http://0.gravatar.com/avatar/e92ac21e948bd67ca7fd03aa58b9f391?s=50&amp;d=http%3A%2F%2Fflowingdata.com%2Fwp-content%2Fthemes%2Fflowingdata-4-8%2Fimages%2Fblank-square.png%3Fs%3D50&amp;r=PG" scale="2"> </div> 
<div class="comment-content">
<div class="comment-author vcard">
<cite class="fn">Nathan Brigmon</cite> <span class="comment-meta">â <a href="http://flowingdata.com/2013/09/12/working-with-line-maps-the-google-places-api-and-r/#comment-239809">September 17, 2013 at 9:12 am</a>
</span>
</div>
<div class="comment-text"><p>Sorry! Figured it out!</p>
</div>
<div class="reply">
</div>
</div> 
<div class="clear-line"></div>
</div>
</li> 
</ul> 
</li> 
<li class="comment byuser comment-author-nateakadino even thread-odd thread-alt depth-1" id="li-comment-239810">
<div id="comment-239810" class="">
<div class="avatar">
<img alt="" src="./Working with Line Maps, the Google Places API, and R_files/e92ac21e948bd67ca7fd03aa58b9f391" class="avatar avatar-50 photo" height="50" width="50" originals="50" src-orig="http://0.gravatar.com/avatar/e92ac21e948bd67ca7fd03aa58b9f391?s=50&amp;d=http%3A%2F%2Fflowingdata.com%2Fwp-content%2Fthemes%2Fflowingdata-4-8%2Fimages%2Fblank-square.png%3Fs%3D50&amp;r=PG" scale="2"> </div> 
<div class="comment-content">
<div class="comment-author vcard">
<cite class="fn">Nathan Brigmon</cite> <span class="comment-meta">â <a href="http://flowingdata.com/2013/09/12/working-with-line-maps-the-google-places-api-and-r/#comment-239810">September 17, 2013 at 10:33 am</a>
</span>
</div>
<div class="comment-text"><p>Great tutorial. </p>
<p>One small note: In R, using the StateMap function, when you use source= âgoogleâ there are some problems in the ggmap code: <a href="https://github.com/dkahle/ggmap/blob/master/R/get_map.R" rel="nofollow">https://github.com/dkahle/ggmap/blob/master/R/get_map.R</a> It basically takes your bounding box parameters and approximates it to a square. This makes it impossible to view states that are not shaped like squares (i.e. most of them).</p>
<p>Instead, I changed source to either âosmâ (which doesnât have great text) or âstamenâ (which is the better option). I hope they fix this, âgoogleâ is the better choice.</p>
<p>Thanks!</p>
</div>
<div class="reply">
</div>
</div> 
<div class="clear-line"></div>
</div>
</li> 
</ul>
</div> 
</div>
</div>
</div> 
</div> 
</div> 
<div id="footer">
<div id="footer-container" class="content">
<div class="float-left" style="width:32%;margin-right:5%;">
<div id="about" class="sec">
<h3>About</h3>
<p>FlowingData explores how designers, statisticians, and computer scientists are using data to understand ourselves better â mainly through data visualization.</p>
<p>As for me, I'm Nathan Yau, and I have a PhD in statistics, with a background in eating.</p>
<p><a href="http://flowingdata.com/about/">More...</a></p>
</div>
</div>
<div class="float-left" style="width:36%;margin-right:5%;">
<div id="book-single" class="sec">
<h3>Books</h3>
<ul id="books" style="margin-bottom:0">
<li>
<a href="http://flowingdata.com/data-points/"><img src="./Working with Line Maps, the Google Places API, and R_files/DataPoints60x75.png" title="Data Points" class="img-left" style="margin-bottom:0" scale="0"><strong>Data Points</strong><br>Visualization that Means Something</a><br>
<div class="clear-line"></div>
</li>
<li><a href="http://flowingdata.com/visualize-this/"><img src="./Working with Line Maps, the Google Places API, and R_files/flowingdata60x79.jpg" title="Visualize This" class="img-left" style="margin-bottom:0" scale="0"><strong>Visualize This</strong><br>The FlowingData Guide to Design, Visualization, and Statistics</a><br>
<div class="clear-line"></div>
</li>
</ul>
</div> 
</div>
<div class="float-left" style="width:22%">
<div id="follow" class="sec">
<h3>Follow</h3>
<p>
<a href="http://twitter.com/flowingdata">Twitter</a> &nbsp;â¢&nbsp;
<a href="http://facebook.com/flowingdata">Facebook</a> &nbsp;â¢&nbsp;
<a href="http://eepurl.com/icL0o">Email</a> &nbsp;â¢&nbsp;
<a href="http://flowingdata.com/feed">RSS</a>
</p>
</div>
<div id="misc" class="sec">
<h3>Miscellaneous</h3>
<a href="http://flowingdata.com/contact">Contact</a> &nbsp;â¢&nbsp;
<a href="http://flowingdata.com/advertise">Sponsorship</a> &nbsp;â¢&nbsp;
<a href="http://flowingdata.bigcartel.com/">Shop</a><a>
</a></div><a>
</a></div><a>
<div class="clear-line"></div>
</a></div><a> 
</a></div><a> 
</a><div id="bottom"><a>
Unless otherwise noted, graphics and words by me are licensed under </a><a href="http://creativecommons.org/licenses/by-nc/3.0/us/">Creative Commons BY-NC</a>. Contact original authors for everything else.
</div>
 
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script><script src="./Working with Line Maps, the Google Places API, and R_files/ga.js" type="text/javascript"></script>
<script type="text/javascript">
var pageTracker = _gat._getTracker("UA-865100-4");
pageTracker._initData();
pageTracker._trackPageview();
</script>
<script type="text/javascript" src="./Working with Line Maps, the Google Places API, and R_files/shCore.js"></script>
<script type="text/javascript" src="./Working with Line Maps, the Google Places API, and R_files/shBrushPlain.js"></script>
<script type="text/javascript" src="./Working with Line Maps, the Google Places API, and R_files/shBrushPython.js"></script>
<script type="text/javascript" src="./Working with Line Maps, the Google Places API, and R_files/shBrushSql.js"></script>
<script type="text/javascript" src="./Working with Line Maps, the Google Places API, and R_files/shBrushR.js"></script>
<script type="text/javascript">
	(function(){
		var corecss = document.createElement('link');
		var themecss = document.createElement('link');
		var corecssurl = "http://flowingdata.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter2/styles/shCore.css?ver=2.1.364";
		if ( corecss.setAttribute ) {
				corecss.setAttribute( "rel", "stylesheet" );
				corecss.setAttribute( "type", "text/css" );
				corecss.setAttribute( "href", corecssurl );
		} else {
				corecss.rel = "stylesheet";
				corecss.href = corecssurl;
		}
		document.getElementsByTagName("head")[0].insertBefore( corecss, document.getElementById("syntaxhighlighteranchor") );
		var themecssurl = "http://flowingdata.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter2/styles/shThemeDefault.css?ver=2.1.364";
		if ( themecss.setAttribute ) {
				themecss.setAttribute( "rel", "stylesheet" );
				themecss.setAttribute( "type", "text/css" );
				themecss.setAttribute( "href", themecssurl );
		} else {
				themecss.rel = "stylesheet";
				themecss.href = themecssurl;
		}
		//document.getElementById("syntaxhighlighteranchor").appendChild(themecss);
		document.getElementsByTagName("head")[0].insertBefore( themecss, document.getElementById("syntaxhighlighteranchor") );
	})();
	SyntaxHighlighter.config.clipboardSwf = 'http://flowingdata.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter2/scripts/clipboard.swf';
	SyntaxHighlighter.config.strings.expandSource = 'show source';
	SyntaxHighlighter.config.strings.viewSource = 'view source';
	SyntaxHighlighter.config.strings.copyToClipboard = 'copy to clipboard';
	SyntaxHighlighter.config.strings.copyToClipboardConfirmation = 'The code is in your clipboard now';
	SyntaxHighlighter.config.strings.print = 'print';
	SyntaxHighlighter.config.strings.help = '?';
	SyntaxHighlighter.config.strings.alert = 'SyntaxHighlighter\n\n';
	SyntaxHighlighter.config.strings.noBrush = 'Can\'t find brush for: ';
	SyntaxHighlighter.config.strings.brushNotHtmlScript = 'Brush wasn\'t configured for html-script option: ';
	SyntaxHighlighter.defaults['pad-line-numbers'] = false;
	SyntaxHighlighter.all();
</script>
<script type="text/javascript" src="./Working with Line Maps, the Google Places API, and R_files/photon.js"></script>
<script type="text/javascript" src="./Working with Line Maps, the Google Places API, and R_files/devicepx-jetpack.js"></script>
<script src="./Working with Line Maps, the Google Places API, and R_files/e-201350.js" type="text/javascript"></script>
<script type="text/javascript">
	st_go({v:'ext',j:'1:2.7',blog:'1938889',post:'32275',tz:'-8'});
	var load_cmc = function(){linktracker_init(1938889,32275,2);};
	if ( typeof addLoadEvent != 'undefined' ) addLoadEvent(load_cmc);
	else load_cmc();
	</script><img id="wpstats" src="./Working with Line Maps, the Google Places API, and R_files/g.gif" alt="" scale="0">
</body></html>