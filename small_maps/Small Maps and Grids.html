<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- saved from url=(0055)http://flowingdata.com/2013/07/08/small-maps-and-grids/ -->
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US"><head profile="http://gmpg.org/xfn/11"><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<title> Small Maps and Grids</title>
<meta name="generator" content="WordPress 3.8">  
<link rel="stylesheet" href="./Small Maps and Grids_files/style.css" type="text/css" media="screen">
<link rel="alternate" type="application/rss+xml" title="RSS 2.0" href="http://flowingdata.com/feed">
<link rel="pingback" href="http://flowingdata.com/xmlrpc.php">
<link rel="shortcut icon" href="http://flowingdata.com/wp-content/themes/flowingdata-4-8/images/favicon.ico">
<script src="./Small Maps and Grids_files/quant.js" async="" type="text/javascript"></script><script async="" type="text/javascript" src="http://www.googletagservices.com/tag/js/gpt.js"></script><script type="text/javascript" src="./Small Maps and Grids_files/jquery-1.4.4.min.js"></script>
<script type="text/javascript">
    var googletag = googletag || {};
    googletag.cmd = googletag.cmd || [];
    (function() {
    var gads = document.createElement('script');
    gads.async = true;
    gads.type = 'text/javascript';
    var useSSL = 'https:' == document.location.protocol;
    gads.src = (useSSL ? 'https:' : 'http:') + 
    '//www.googletagservices.com/tag/js/gpt.js';
    var node = document.getElementsByTagName('script')[0];
    node.parentNode.insertBefore(gads, node);
    })();
    </script>
<script type="text/javascript">
    googletag.cmd.push(function() {
    googletag.defineSlot('/2462688/Sidebar_rectangle', [300, 250], 'div-gpt-ad-1332011316310-2').addService(googletag.pubads());
    googletag.defineSlot('/2462688/Square1', [125, 125], 'div-gpt-ad-1332011316310-3').addService(googletag.pubads());
    googletag.defineSlot('/2462688/Square2', [125, 125], 'div-gpt-ad-1332011316310-4').addService(googletag.pubads());
    googletag.defineSlot('/2462688/Square3', [125, 125], 'div-gpt-ad-1332011316310-5').addService(googletag.pubads());
    googletag.defineSlot('/2462688/Square4', [125, 125], 'div-gpt-ad-1358209090048-5').addService(googletag.pubads());
googletag.defineSlot('/2462688/Bottom_Post', [300, 250], 'div-gpt-ad-1332011316310-0').addService(googletag.pubads());    googletag.pubads().enableSingleRequest();
    googletag.pubads().collapseEmptyDivs();
    googletag.enableServices();
    });
    </script>
<link rel="alternate" type="application/rss+xml" title="FlowingData » Small Maps and Grids Comments Feed" href="http://flowingdata.com/2013/07/08/small-maps-and-grids/feed/">
<script type="text/javascript" src="./Small Maps and Grids_files/comment-reply.min.js"></script>
<script type="text/javascript" src="./Small Maps and Grids_files/jquery.js"></script>
<script type="text/javascript" src="./Small Maps and Grids_files/jquery-migrate.min.js"></script>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://flowingdata.com/xmlrpc.php?rsd">
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://flowingdata.com/wp-includes/wlwmanifest.xml">
<link rel="prev" title="Dictionary of Numbers extension adds context to numbers" href="http://flowingdata.com/2013/07/08/dictionary-of-numbers-extension-adds-context-to-numbers/">
<link rel="next" title="Statistics for Point Pattern Analysis in the Real World" href="http://flowingdata.com/2013/07/08/statistics-for-point-pattern-analysis-in-the-real-world/">
<meta name="generator" content="WordPress 3.8">
<link rel="canonical" href="./Small Maps and Grids_files/Small Maps and Grids.html">
<link rel="shortlink" href="http://flowingdata.com/?p=31457">
 <script type="text/javascript" src="./Small Maps and Grids_files/democracy.js"></script><link rel="stylesheet" href="./Small Maps and Grids_files/basic.css" type="text/css"><link rel="stylesheet" href="./Small Maps and Grids_files/style(1).css" type="text/css"><link rel="stylesheet" href="./Small Maps and Grids_files/wp-page-numbers.css" type="text/css" media="screen"><style type="text/css">img#wpstats{display:none}</style><link rel="stylesheet" type="text/css" href="./Small Maps and Grids_files/shCore.css"><link rel="stylesheet" type="text/css" href="./Small Maps and Grids_files/shThemeDefault.css"><style type="text/css" id="syntaxhighlighteranchor"></style>
<style>#twbfuxmjthuxrmlfbyxxqvivsxvkvlinezuxr{border:solid 2px #fff !important;box-sizing:content-box !important;color:#fff !important;display:block !important;height:auto !important;margin:0 !important;opacity:0.9 !important;padding:7px 10px !important;position:fixed !important;visibility:visible !important;width:auto !important;z-index:2147483647 !important;-webkit-border-radius:5px !important;-webkit-box-shadow:0px 0px 20px #000 !important;-webkit-box-sizing:content-box !important;}.twbfuxmjthuxrmlfbyxxqvivsxvkvlinezuxr-blocked{color:#777 !important;display:inline !important;text-decoration:line-through !important;}#twbfuxmjthuxrmlfbyxxqvivsxvkvlinezuxr br{display:block !important;}#twbfuxmjthuxrmlfbyxxqvivsxvkvlinezuxr span{background:transparent !important;}#twbfuxmjthuxrmlfbyxxqvivsxvkvlinezuxr div{border:0 !important;margin:0 !important;padding:0 !important;width:auto !important;letter-spacing:normal !important;font:13px Arial,Helvetica !important;text-align:left !important;text-shadow:none !important;text-transform:none !important;word-spacing:normal !important;}#twbfuxmjthuxrmlfbyxxqvivsxvkvlinezuxr a{font-weight:normal !important;background:none !important;text-decoration:underline !important;color:#fff !important;}@media print{#twbfuxmjthuxrmlfbyxxqvivsxvkvlinezuxr{display:none !important;}}</style></head><style type="text/css">embed[type*="application/x-shockwave-flash"],embed[src*=".swf"],object[type*="application/x-shockwave-flash"],object[codetype*="application/x-shockwave-flash"],object[src*=".swf"],object[codebase*="swflash.cab"],object[classid*="D27CDB6E-AE6D-11cf-96B8-444553540000"],object[classid*="d27cdb6e-ae6d-11cf-96b8-444553540000"],object[classid*="D27CDB6E-AE6D-11cf-96B8-444553540000"]{	display: none !important;}</style>
<body style="">
<a name="top"></a>
<div id="topnav">
<div id="topnav-content" class="content">
<div id="login" class="float-right">
<span id="username-meta">Logged in as <a href="http://flowingdata.com/profile/">abresler</a> &nbsp;&nbsp;</span>
<a href="http://flowingdata.com/wp-login.php?action=logout&_wpnonce=d018091d15">Log out</a> </div>
</div>
<div class="clear-line"></div>
</div> 
<div id="header">
<div id="header-content" class="content">
<div id="nav">
<a href="http://flowingdata.com/">
<img src="./Small Maps and Grids_files/logo.png" class="float-left" scale="0">
</a>
<div id="pages" class="float-right">
<ul>
<li><a href="http://flowingdata.com/membership/">Membership</a></li>
<li><a href="http://flowingdata.com/learning/">Learning</a></li>
<li><a href="https://jobs.flowingdata.com/">Job Board</a></li>
<li><a href="http://flowingdata.com/category/projects/">Projects</a></li>
<li><a href="http://flowingdata.com/about/">About</a></li>
</ul>
</div> 
<div class="clear-line"></div>
</div> 
</div> 
</div> 
<div class="clear-line"></div>
<div id="main-wrapper">
<div id="content-wrapper" class="content">
<div class="post" id="post-31457">
<div id="content" class="single-long">
<div class="entry">
<div class="category">
<a href="http://flowingdata.com/category/tutorials/" title="View all posts in Tutorials" rel="category tag">Tutorials</a> &nbsp;/&nbsp; <a href="http://flowingdata.com/tag/choropleth/" rel="tag">choropleth</a>, <a href="http://flowingdata.com/tag/point-map/" rel="tag">point map</a>, <a href="http://flowingdata.com/tag/r/" rel="tag">R</a> <span class="members-note"><a href="http://flowingdata.com/members-only">Members Only</a></span> </div>
<h1>Small Maps and Grids</h1>
<div class="clear-line"></div>
<div class="author">
By <strong>Nathan Yau</strong>
</div> 
<div id="lead-in">
<p class="img-right"><img src="./Small Maps and Grids_files/00-featured-edit.png" class="attachment-long-form-thumb wp-post-image" alt="Small maps and grids" width="425" height="258" src-orig="http://i1.wp.com/flowingdata.com/wp-content/uploads/2013/07/00-featured-edit.png?fit=425%2C9999" scale="2"></p>
<div class="entry-excerpt">
Maybe you want to make spatial comparisons over time or across categories. Organized small maps might do the trick. </div>
<div id="tut-meta">
<div class="button-link"><a href="http://flowingdata.com/2013/06/26/grocery-store-geography/">Demo</a></div>
<div class="button-link"><a href="http://flowingdata.com/?s2member_file_download=2013/201307small-maps-tutorial.zip">Download Source</a></div>
<div class="clear-line"></div>
</div> 
<div class="clear-line"></div>
</div> 
<div class="entry-content">
<p>Small multiples, a visualization layout that lets you quickly compare a collection of small charts, works well with maps. You just have to make sure they're not too complex, because after all, they're small, so you can't see every detail that you would see in a large map. </p>
<p>The key to creating these things uses the same logic as the <a href="http://flowingdata.com/2013/04/29/small-multiples-in-r/">small multiples tutorial</a>. If you know how to make one type of chart, then you can make a bunch of them, and similarly, if you know how to make one type of map, you can make a bunch of them.</p>
<p>So first I'll go over how to make single maps, and then go into how to make many of them in one swoop.</p>
<h3>Setup</h3>
<p>You use R in this tutorial, so <a href="http://cran.r-project.org/">download and install it</a> if you haven't already. It's free and open source.</p>
<p><span class="tip">You can install packages via the Package Installer in R. Go to Packages &amp; Data → Package Installer. Choose the packages you want to install and click the button.</span>Once you have R installed, load the following packages (or install them first and then load them):</p>
<ul>
<li>foreign</li>
<li>maps</li>
<li>mapproj</li>
<li>plyr</li>
</ul>
<p>If you have the packages above installed already, use the code below to load them. The maps project is dependent on the mapproj package, which will load automatically.</p>
<div id="highlighter_854614" class="syntaxhighlighter  "><div class="bar"><div class="toolbar"><a href="http://flowingdata.com/2013/07/08/small-maps-and-grids/#viewSource" title="view source" class="item viewSource" style="width: 16px; height: 16px;">view source</a><div class="item copyToClipboard"><div style="display: block; cursor: pointer; text-align: center; width: 16px; height: 16px; top: auto; left: auto; position: static;"><div style="-webkit-transition: opacity 150ms ease-out; transition: opacity 150ms ease-out; background-image: url(chrome-extension://gofhjkjmkpinhpoiabjplobcaignabnl/icon_play.png); text-align: left; opacity: 0.25; border: 1px solid rgb(0, 0, 0); width: 100%; height: 100%; background-color: rgba(193, 217, 244, 0.498039); background-repeat: no-repeat no-repeat;"></div></div><embed width="16" height="16" id="highlighter_854614_clipboard" type="application/x-shockwave-flash" title="copy to clipboard" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_854614" menu="false" src="http://flowingdata.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter2/scripts/clipboard.swf" style="display: none !important;"></div><a href="http://flowingdata.com/2013/07/08/small-maps-and-grids/#printSource" title="print" class="item printSource" style="width: 16px; height: 16px;">print</a><a href="http://flowingdata.com/2013/07/08/small-maps-and-grids/#about" title="?" class="item about" style="width: 16px; height: 16px;">?</a></div></div><div class="lines"><div class="line alt1"><table><tbody><tr><td class="number"><code>1</code></td><td class="content"><code class="comments"># Load packages</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>2</code></td><td class="content"><code class="functions">library</code><code class="plain">(foreign)&nbsp;&nbsp;&nbsp; </code><code class="comments"># To read .dbf file</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>3</code></td><td class="content"><code class="functions">library</code><code class="plain">(maps)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code><code class="comments"># To draw map</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>4</code></td><td class="content"><code class="functions">library</code><code class="plain">(plyr)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code><code class="comments"># Data formatting</code></td></tr></tbody></table></div></div></div>
<p>Then load the data. You'll be looking at fatal automobile accidents in the United States in 2001.</p>
<div id="highlighter_159635" class="syntaxhighlighter  "><div class="bar"><div class="toolbar"><a href="http://flowingdata.com/2013/07/08/small-maps-and-grids/#viewSource" title="view source" class="item viewSource" style="width: 16px; height: 16px;">view source</a><div class="item copyToClipboard"><div style="display: block; cursor: pointer; text-align: center; width: 16px; height: 16px; top: auto; left: auto; position: static;"><div style="-webkit-transition: opacity 150ms ease-out; transition: opacity 150ms ease-out; background-image: url(chrome-extension://gofhjkjmkpinhpoiabjplobcaignabnl/icon_play.png); text-align: left; opacity: 0.25; border: 1px solid rgb(0, 0, 0); width: 100%; height: 100%; background-color: rgba(193, 217, 244, 0.498039); background-repeat: no-repeat no-repeat;"></div></div><embed width="16" height="16" id="highlighter_159635_clipboard" type="application/x-shockwave-flash" title="copy to clipboard" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_159635" menu="false" src="http://flowingdata.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter2/scripts/clipboard.swf" style="display: none !important;"></div><a href="http://flowingdata.com/2013/07/08/small-maps-and-grids/#printSource" title="print" class="item printSource" style="width: 16px; height: 16px;">print</a><a href="http://flowingdata.com/2013/07/08/small-maps-and-grids/#about" title="?" class="item about" style="width: 16px; height: 16px;">?</a></div></div><div class="lines"><div class="line alt1"><table><tbody><tr><td class="number"><code>1</code></td><td class="content"><code class="plain">file_loc &lt;- </code><code class="string">"data/accident2001.dbf"</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>2</code></td><td class="content"><code class="plain">acc &lt;- </code><code class="functions">read.dbf</code><code class="plain">(file_loc)</code></td></tr></tbody></table></div></div></div>
<p>Type <code>head(acc)</code> in the R console to get a sense of what the data looks like. There are several variables, but for the purposes of this tutorial, the main ones are the where and when of each accident.</p>
<h3>Basic mapping</h3>
<p>The <code>map()</code> function from the maps package does a lot of the work for you map-wise. In the code below, the first line draws a blank map with state boundaries. The second line draws points on the map, one point per accident. Notice the order of longitude and latitude.</p>
<div id="highlighter_14616" class="syntaxhighlighter  "><div class="bar"><div class="toolbar"><a href="http://flowingdata.com/2013/07/08/small-maps-and-grids/#viewSource" title="view source" class="item viewSource" style="width: 16px; height: 16px;">view source</a><div class="item copyToClipboard"><div style="display: block; cursor: pointer; text-align: center; width: 16px; height: 16px; top: auto; left: auto; position: static;"><div style="-webkit-transition: opacity 150ms ease-out; transition: opacity 150ms ease-out; background-image: url(chrome-extension://gofhjkjmkpinhpoiabjplobcaignabnl/icon_play.png); text-align: left; opacity: 0.25; border: 1px solid rgb(0, 0, 0); width: 100%; height: 100%; background-color: rgba(193, 217, 244, 0.498039); background-repeat: no-repeat no-repeat;"></div></div><embed width="16" height="16" id="highlighter_14616_clipboard" type="application/x-shockwave-flash" title="copy to clipboard" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_14616" menu="false" src="http://flowingdata.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter2/scripts/clipboard.swf" style="display: none !important;"></div><a href="http://flowingdata.com/2013/07/08/small-maps-and-grids/#printSource" title="print" class="item printSource" style="width: 16px; height: 16px;">print</a><a href="http://flowingdata.com/2013/07/08/small-maps-and-grids/#about" title="?" class="item about" style="width: 16px; height: 16px;">?</a></div></div><div class="lines"><div class="line alt1"><table><tbody><tr><td class="number"><code>1</code></td><td class="content"><code class="functions">map</code><code class="plain">(</code><code class="string">"state"</code><code class="plain">, lwd=1, col=</code><code class="string">"#cccccc"</code><code class="plain">)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # Default projection is rectangular</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>2</code></td><td class="content"><code class="functions">points</code><code class="plain">(acc$longitud, acc$latitude, col=</code><code class="keyword">NA</code><code class="plain">, bg=</code><code class="string">"#000000"</code><code class="plain">, pch=21, cex=0.20)</code></td></tr></tbody></table></div></div></div>
<p><span class="tip">After loading the necessary packages and the data, it took only two lines of code to make a map.</span><img src="./Small Maps and Grids_files/01-Accidents-in-2001.png" alt="01-Accidents in 2001" class="alignnone size-medium wp-image-31462" width="625" height="336" src-orig="http://i0.wp.com/flowingdata.com/wp-content/uploads/2013/07/01-Accidents-in-2001.png?resize=625%2C336" scale="2"></p>
<p>You don't have to stick with the default rectangular projection. For example, you can use the Albers projection, as shown below. Notice that <code>mapproject()</code> is used in <code>points()</code>. This transforms the latitude and longitude coordinates so that they are placed properly on the new space.</p>
<div id="highlighter_878945" class="syntaxhighlighter  "><div class="bar"><div class="toolbar"><a href="http://flowingdata.com/2013/07/08/small-maps-and-grids/#viewSource" title="view source" class="item viewSource" style="width: 16px; height: 16px;">view source</a><div class="item copyToClipboard"><div style="display: block; cursor: pointer; text-align: center; width: 16px; height: 16px; top: auto; left: auto; position: static;"><div style="-webkit-transition: opacity 150ms ease-out; transition: opacity 150ms ease-out; background-image: url(chrome-extension://gofhjkjmkpinhpoiabjplobcaignabnl/icon_play.png); text-align: left; opacity: 0.25; border: 1px solid rgb(0, 0, 0); width: 100%; height: 100%; background-color: rgba(193, 217, 244, 0.498039); background-repeat: no-repeat no-repeat;"></div></div><embed width="16" height="16" id="highlighter_878945_clipboard" type="application/x-shockwave-flash" title="copy to clipboard" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_878945" menu="false" src="http://flowingdata.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter2/scripts/clipboard.swf" style="display: none !important;"></div><a href="http://flowingdata.com/2013/07/08/small-maps-and-grids/#printSource" title="print" class="item printSource" style="width: 16px; height: 16px;">print</a><a href="http://flowingdata.com/2013/07/08/small-maps-and-grids/#about" title="?" class="item about" style="width: 16px; height: 16px;">?</a></div></div><div class="lines"><div class="line alt1"><table><tbody><tr><td class="number"><code>1</code></td><td class="content"><code class="comments"># Albers projection</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>2</code></td><td class="content"><code class="functions">map</code><code class="plain">(</code><code class="string">"state"</code><code class="plain">, proj=</code><code class="string">"albers"</code><code class="plain">, param=</code><code class="functions">c</code><code class="plain">(39,45), lwd=1, col=</code><code class="string">"#cccccc"</code><code class="plain">)</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>3</code></td><td class="content"><code class="functions">points</code><code class="plain">(</code><code class="functions">mapproject</code><code class="plain">(acc$longitud, acc$latitude), col=</code><code class="keyword">NA</code><code class="plain">, bg=</code><code class="string">"#00000030"</code><code class="plain">, pch=21, cex=0.20)</code></td></tr></tbody></table></div></div></div>
<p><span class="tip">The Albers projection provides a more accurate representation of the United States.</span><img src="./Small Maps and Grids_files/02-Albers-projection.png" alt="02-Albers projection" class="alignnone size-medium wp-image-31463" width="625" height="401" src-orig="http://i2.wp.com/flowingdata.com/wp-content/uploads/2013/07/02-Albers-projection.png?resize=625%2C401" scale="2"></p>
<p>Here's the same thing as above but with the Elliptic projection.</p>
<div id="highlighter_815616" class="syntaxhighlighter  "><div class="bar"><div class="toolbar"><a href="http://flowingdata.com/2013/07/08/small-maps-and-grids/#viewSource" title="view source" class="item viewSource" style="width: 16px; height: 16px;">view source</a><div class="item copyToClipboard"><div style="display: block; cursor: pointer; text-align: center; width: 16px; height: 16px; top: auto; left: auto; position: static;"><div style="-webkit-transition: opacity 150ms ease-out; transition: opacity 150ms ease-out; background-image: url(chrome-extension://gofhjkjmkpinhpoiabjplobcaignabnl/icon_play.png); text-align: left; opacity: 0.25; border: 1px solid rgb(0, 0, 0); width: 100%; height: 100%; background-color: rgba(193, 217, 244, 0.498039); background-repeat: no-repeat no-repeat;"></div></div><embed width="16" height="16" id="highlighter_815616_clipboard" type="application/x-shockwave-flash" title="copy to clipboard" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_815616" menu="false" src="http://flowingdata.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter2/scripts/clipboard.swf" style="display: none !important;"></div><a href="http://flowingdata.com/2013/07/08/small-maps-and-grids/#printSource" title="print" class="item printSource" style="width: 16px; height: 16px;">print</a><a href="http://flowingdata.com/2013/07/08/small-maps-and-grids/#about" title="?" class="item about" style="width: 16px; height: 16px;">?</a></div></div><div class="lines"><div class="line alt1"><table><tbody><tr><td class="number"><code>1</code></td><td class="content"><code class="comments"># Elliptic projection</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>2</code></td><td class="content"><code class="functions">map</code><code class="plain">(</code><code class="string">"state"</code><code class="plain">, proj=</code><code class="string">"elliptic"</code><code class="plain">, par=100, lwd=1, col=</code><code class="string">"#cccccc"</code><code class="plain">)</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>3</code></td><td class="content"><code class="functions">points</code><code class="plain">(</code><code class="functions">mapproject</code><code class="plain">(acc$longitud, acc$latitude), col=</code><code class="keyword">NA</code><code class="plain">, bg=</code><code class="string">"#00007030"</code><code class="plain">, pch=21, cex=0.20)</code></td></tr></tbody></table></div></div></div>
<p><img src="./Small Maps and Grids_files/03-Elliptic-projection.png" alt="03-Elliptic projection" class="alignnone size-medium wp-image-31464" width="625" height="282" src-orig="http://i2.wp.com/flowingdata.com/wp-content/uploads/2013/07/03-Elliptic-projection.png?resize=625%2C282" scale="2"></p>
<p>See the <code>mapproject()</code> documentation (<code>?mapproject</code>) to see what other projections are available.</p>
<h3>Multiple maps at once</h3>
<p>Okay, so now you know how to make a single map. You want to put multiple maps in a single view though. You can change <code>mfrow</code> with the <code>par()</code> function. The first line of code below specifies a grid of one row and two columns (with zero margin in between). Then you just have to call <code>map()</code> twice.</p>
<div id="highlighter_937623" class="syntaxhighlighter  "><div class="bar"><div class="toolbar"><a href="http://flowingdata.com/2013/07/08/small-maps-and-grids/#viewSource" title="view source" class="item viewSource" style="width: 16px; height: 16px;">view source</a><div class="item copyToClipboard"><div style="display: block; cursor: pointer; text-align: center; width: 16px; height: 16px; top: auto; left: auto; position: static;"><div style="-webkit-transition: opacity 150ms ease-out; transition: opacity 150ms ease-out; background-image: url(chrome-extension://gofhjkjmkpinhpoiabjplobcaignabnl/icon_play.png); text-align: left; opacity: 0.25; border: 1px solid rgb(0, 0, 0); width: 100%; height: 100%; background-color: rgba(193, 217, 244, 0.498039); background-repeat: no-repeat no-repeat;"></div></div><embed width="16" height="16" id="highlighter_937623_clipboard" type="application/x-shockwave-flash" title="copy to clipboard" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_937623" menu="false" src="http://flowingdata.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter2/scripts/clipboard.swf" style="display: none !important;"></div><a href="http://flowingdata.com/2013/07/08/small-maps-and-grids/#printSource" title="print" class="item printSource" style="width: 16px; height: 16px;">print</a><a href="http://flowingdata.com/2013/07/08/small-maps-and-grids/#about" title="?" class="item about" style="width: 16px; height: 16px;">?</a></div></div><div class="lines"><div class="line alt1"><table><tbody><tr><td class="number"><code>1</code></td><td class="content"><code class="comments"># One row, two columns, with no margin around each</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>2</code></td><td class="content"><code class="functions">par</code><code class="plain">(mfrow=</code><code class="functions">c</code><code class="plain">(1,2), mar=</code><code class="functions">c</code><code class="plain">(0,0,0,0))</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>3</code></td><td class="content"><code class="functions">map</code><code class="plain">(</code><code class="string">"state"</code><code class="plain">, proj=</code><code class="string">"albers"</code><code class="plain">, param=</code><code class="functions">c</code><code class="plain">(39,45), lwd=1, col=</code><code class="string">"#cccccc"</code><code class="plain">)&nbsp;&nbsp; # First the Albers</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>4</code></td><td class="content"><code class="functions">points</code><code class="plain">(</code><code class="functions">mapproject</code><code class="plain">(acc$longitud, acc$latitude), col=</code><code class="keyword">NA</code><code class="plain">, bg=</code><code class="string">"#00000030"</code><code class="plain">, pch=21, cex=0.20)</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>5</code></td><td class="content"><code class="functions">map</code><code class="plain">(</code><code class="string">"state"</code><code class="plain">, proj=</code><code class="string">"elliptic"</code><code class="plain">, par=100, lwd=1, col=</code><code class="string">"#cccccc"</code><code class="plain">)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # Then the Elliptic</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>6</code></td><td class="content"><code class="functions">points</code><code class="plain">(</code><code class="functions">mapproject</code><code class="plain">(acc$longitud, acc$latitude), col=</code><code class="keyword">NA</code><code class="plain">, bg=</code><code class="string">"#00007030"</code><code class="plain">, pch=21, cex=0.20)</code></td></tr></tbody></table></div></div></div>
<p>The maps are placed left to right.</p>
<p><span class="tip">Set <code>mfrow</code> with <code>par()</code> to produce multiple maps in a window.</span><img src="./Small Maps and Grids_files/04-Two-maps-at-once.png" alt="04-Two maps at once" class="alignnone size-medium wp-image-31465" width="625" height="201" src-orig="http://i2.wp.com/flowingdata.com/wp-content/uploads/2013/07/04-Two-maps-at-once.png?resize=625%2C201" scale="2"></p>
<p>This view isn't particularly useful. It's just the same data mapped on two different projections, but say you wanted to compare different hours in the day. Here's how to map only the accidents that occurred at 1am.</p>
<div id="highlighter_395506" class="syntaxhighlighter  "><div class="bar"><div class="toolbar"><a href="http://flowingdata.com/2013/07/08/small-maps-and-grids/#viewSource" title="view source" class="item viewSource" style="width: 16px; height: 16px;">view source</a><div class="item copyToClipboard"><div style="display: block; cursor: pointer; text-align: center; width: 16px; height: 16px; top: auto; left: auto; position: static;"><div style="-webkit-transition: opacity 150ms ease-out; transition: opacity 150ms ease-out; background-image: url(chrome-extension://gofhjkjmkpinhpoiabjplobcaignabnl/icon_play.png); text-align: left; opacity: 0.25; border: 1px solid rgb(0, 0, 0); width: 100%; height: 100%; background-color: rgba(193, 217, 244, 0.498039); background-repeat: no-repeat no-repeat;"></div></div><embed width="16" height="16" id="highlighter_395506_clipboard" type="application/x-shockwave-flash" title="copy to clipboard" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_395506" menu="false" src="http://flowingdata.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter2/scripts/clipboard.swf" style="display: none !important;"></div><a href="http://flowingdata.com/2013/07/08/small-maps-and-grids/#printSource" title="print" class="item printSource" style="width: 16px; height: 16px;">print</a><a href="http://flowingdata.com/2013/07/08/small-maps-and-grids/#about" title="?" class="item about" style="width: 16px; height: 16px;">?</a></div></div><div class="lines"><div class="line alt1"><table><tbody><tr><td class="number"><code>1</code></td><td class="content"><code class="comments"># Accidents at 1am</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>2</code></td><td class="content"><code class="plain">acc.1 &lt;- acc[acc$HOUR == 1,]&nbsp;&nbsp;&nbsp;&nbsp; </code><code class="comments"># Subset the midnight accidents</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>3</code></td><td class="content"><code class="functions">map</code><code class="plain">(</code><code class="string">"state"</code><code class="plain">, proj=</code><code class="string">"albers"</code><code class="plain">, param=</code><code class="functions">c</code><code class="plain">(39,45), lwd=1, col=</code><code class="string">"#cccccc"</code><code class="plain">)</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>4</code></td><td class="content"><code class="functions">points</code><code class="plain">(</code><code class="functions">mapproject</code><code class="plain">(acc.1$longitud, acc.1$latitude), col=</code><code class="keyword">NA</code><code class="plain">, bg=</code><code class="string">"#000000"</code><code class="plain">, pch=21, cex=0.20)</code></td></tr></tbody></table></div></div></div>
<p><img src="./Small Maps and Grids_files/05-Accidents-at-1am.png" alt="05-Accidents at 1am" class="alignnone size-medium wp-image-31466" width="625" height="409" src-orig="http://i1.wp.com/flowingdata.com/wp-content/uploads/2013/07/05-Accidents-at-1am.png?resize=625%2C409" scale="2"></p>
<p>Now try making a map for every hour in the day. The code below iterates through each unique hour in the the HOUR column of the acc dataframe. For each hour, your subset on the hour and then make a map of the points in the respective hour. A grid with five rows and six columns is set with <code>par()</code>.</p>
<div id="highlighter_96866" class="syntaxhighlighter  "><div class="bar"><div class="toolbar"><a href="http://flowingdata.com/2013/07/08/small-maps-and-grids/#viewSource" title="view source" class="item viewSource" style="width: 16px; height: 16px;">view source</a><div class="item copyToClipboard"><div style="display: block; cursor: pointer; text-align: center; width: 16px; height: 16px; top: auto; left: auto; position: static;"><div style="-webkit-transition: opacity 150ms ease-out; transition: opacity 150ms ease-out; background-image: url(chrome-extension://gofhjkjmkpinhpoiabjplobcaignabnl/icon_play.png); text-align: left; opacity: 0.25; border: 1px solid rgb(0, 0, 0); width: 100%; height: 100%; background-color: rgba(193, 217, 244, 0.498039); background-repeat: no-repeat no-repeat;"></div></div><embed width="16" height="16" id="highlighter_96866_clipboard" type="application/x-shockwave-flash" title="copy to clipboard" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_96866" menu="false" src="http://flowingdata.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter2/scripts/clipboard.swf" style="display: none !important;"></div><a href="http://flowingdata.com/2013/07/08/small-maps-and-grids/#printSource" title="print" class="item printSource" style="width: 16px; height: 16px;">print</a><a href="http://flowingdata.com/2013/07/08/small-maps-and-grids/#about" title="?" class="item about" style="width: 16px; height: 16px;">?</a></div></div><div class="lines"><div class="line alt1"><table><tbody><tr><td class="number"><code>1</code></td><td class="content"><code class="comments"># Map for every hour</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>2</code></td><td class="content"><code class="plain">hrs &lt;- </code><code class="functions">unique</code><code class="plain">(acc$HOUR)</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>3</code></td><td class="content"><code class="functions">length</code><code class="plain">(hrs)</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>4</code></td><td class="content"><code class="functions">par</code><code class="plain">(mfrow=</code><code class="functions">c</code><code class="plain">(5,6), mar=</code><code class="functions">c</code><code class="plain">(0,0,0,0))&nbsp;&nbsp;&nbsp; </code><code class="comments"># Five rows, six columns</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>5</code></td><td class="content"><code class="functions">for </code><code class="plain">(i </code><code class="keyword">in</code> <code class="plain">1:</code><code class="functions">length</code><code class="plain">(hrs)) {</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>6</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>7</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">acc.hr &lt;- acc[acc$HOUR == hrs[i],]</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>8</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="functions">map</code><code class="plain">(</code><code class="string">"state"</code><code class="plain">, proj=</code><code class="string">"albers"</code><code class="plain">, param=</code><code class="functions">c</code><code class="plain">(39,45), lwd=1, col=</code><code class="string">"#cccccc"</code><code class="plain">)</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>9</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="functions">points</code><code class="plain">(</code><code class="functions">mapproject</code><code class="plain">(acc.hr$longitud, acc.hr$latitude), col=</code><code class="keyword">NA</code><code class="plain">, bg=</code><code class="string">"#000000"</code><code class="plain">, pch=21, cex=0.20)</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>10</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>11</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="comments"># Label the map</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>12</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="functions">text</code><code class="plain">(</code><code class="functions">mapproject</code><code class="plain">(-99.843750, 52.130116), </code><code class="functions">paste</code><code class="plain">(</code><code class="string">"Hour:"</code><code class="plain">, hrs[i]), cex=1.2)</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>13</code></td><td class="content"><code class="plain">}</code></td></tr></tbody></table></div></div></div>
<p>In addition to the map, a label is also added to the top of each map with the <code>text()</code> function.</p>
<p><span class="tip">The hours are just in the order they appear in the dataset.</span><img src="./Small Maps and Grids_files/06-Accidents-by-hour.png" alt="06-Accidents by hour" class="alignnone size-medium wp-image-31467" width="625" height="515" src-orig="http://i2.wp.com/flowingdata.com/wp-content/uploads/2013/07/06-Accidents-by-hour.png?resize=625%2C515" scale="2"></p>
<p>The order of the hours looks like of random though, because the code above iterates through <code>hrs</code>, which is the order that <code>unique()</code> found them in. There's also an hour 0 and 24, which is an inconsistency in reporting the 12am hour. There's also an hour 99, which indicates non-reporting.</p>
<p>The code below shows hours in order, omits the 99 hour, and combines the 0 and 24 hours.</p>
<div id="highlighter_84100" class="syntaxhighlighter  "><div class="bar"><div class="toolbar"><a href="http://flowingdata.com/2013/07/08/small-maps-and-grids/#viewSource" title="view source" class="item viewSource" style="width: 16px; height: 16px;">view source</a><div class="item copyToClipboard"><div style="display: block; cursor: pointer; text-align: center; width: 16px; height: 16px; top: auto; left: auto; position: static;"><div style="-webkit-transition: opacity 150ms ease-out; transition: opacity 150ms ease-out; background-image: url(chrome-extension://gofhjkjmkpinhpoiabjplobcaignabnl/icon_play.png); text-align: left; opacity: 0.25; border: 1px solid rgb(0, 0, 0); width: 100%; height: 100%; background-color: rgba(193, 217, 244, 0.498039); background-repeat: no-repeat no-repeat;"></div></div><embed width="16" height="16" id="highlighter_84100_clipboard" type="application/x-shockwave-flash" title="copy to clipboard" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_84100" menu="false" src="http://flowingdata.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter2/scripts/clipboard.swf" style="display: none !important;"></div><a href="http://flowingdata.com/2013/07/08/small-maps-and-grids/#printSource" title="print" class="item printSource" style="width: 16px; height: 16px;">print</a><a href="http://flowingdata.com/2013/07/08/small-maps-and-grids/#about" title="?" class="item about" style="width: 16px; height: 16px;">?</a></div></div><div class="lines"><div class="line alt1"><table><tbody><tr><td class="number"><code>1</code></td><td class="content"><code class="comments"># Map for every hour, sorted</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>2</code></td><td class="content"><code class="functions">par</code><code class="plain">(mfrow=</code><code class="functions">c</code><code class="plain">(6,4), mar=</code><code class="functions">c</code><code class="plain">(0,0,0,0))</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>3</code></td><td class="content"><code class="functions">for </code><code class="plain">(hr </code><code class="keyword">in</code> <code class="plain">0:24) {</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>4</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>5</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="functions">if </code><code class="plain">(hr == 0) {</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>6</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">acc.hr &lt;- acc[acc$HOUR == hr | acc$HOUR == 24,]</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>7</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">} </code><code class="keyword">else</code> <code class="functions">if </code><code class="plain">(hr == 24) {</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>8</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword">next</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>9</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">} </code><code class="keyword">else</code> <code class="plain">{</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>10</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">acc.hr &lt;- acc[acc$HOUR == hr,]</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>11</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>12</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>13</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="functions">map</code><code class="plain">(</code><code class="string">"state"</code><code class="plain">, proj=</code><code class="string">"albers"</code><code class="plain">, param=</code><code class="functions">c</code><code class="plain">(39,45), lwd=0.3, col=</code><code class="string">"#cccccc"</code><code class="plain">)</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>14</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="functions">points</code><code class="plain">(</code><code class="functions">mapproject</code><code class="plain">(acc.hr$longitud, acc.hr$latitude), col=</code><code class="keyword">NA</code><code class="plain">, bg=</code><code class="string">"#000070"</code><code class="plain">, pch=21, cex=0.15)</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>15</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>16</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="comments"># Label the map</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>17</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="functions">text</code><code class="plain">(</code><code class="functions">mapproject</code><code class="plain">(-99, 52), </code><code class="functions">paste</code><code class="plain">(</code><code class="string">"Hour:"</code><code class="plain">, hr), cex=1)</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>18</code></td><td class="content"><code class="plain">}</code></td></tr></tbody></table></div></div></div>
<p>The grid is also a different size, and the points were colored blue (for reason other than demonstration).</p>
<p><span class="tip">The by-hour maps are sorted more logically in this view.</span><img src="./Small Maps and Grids_files/07-Accidents-by-hour-sorted.png" alt="07-Accidents by hour sorted" class="alignnone size-medium wp-image-31468" width="625" height="748" src-orig="http://i0.wp.com/flowingdata.com/wp-content/uploads/2013/07/07-Accidents-by-hour-sorted.png?resize=625%2C748" scale="2"></p>
<p>Look back on the previous code. You find some categories to iterate on, then you use the for loop to iterate, and on each iteration you subset on the current category. Finally, you map the subset.</p>
<p>Try this logic one more time, this time on road function (ROAD_FNC).</p>
<div id="highlighter_625260" class="syntaxhighlighter  "><div class="bar"><div class="toolbar"><a href="http://flowingdata.com/2013/07/08/small-maps-and-grids/#viewSource" title="view source" class="item viewSource" style="width: 16px; height: 16px;">view source</a><div class="item copyToClipboard"><div style="display: block; cursor: pointer; text-align: center; width: 16px; height: 16px; top: auto; left: auto; position: static;"><div style="-webkit-transition: opacity 150ms ease-out; transition: opacity 150ms ease-out; background-image: url(chrome-extension://gofhjkjmkpinhpoiabjplobcaignabnl/icon_play.png); text-align: left; opacity: 0.25; border: 1px solid rgb(0, 0, 0); width: 100%; height: 100%; background-color: rgba(193, 217, 244, 0.498039); background-repeat: no-repeat no-repeat;"></div></div><embed width="16" height="16" id="highlighter_625260_clipboard" type="application/x-shockwave-flash" title="copy to clipboard" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_625260" menu="false" src="http://flowingdata.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter2/scripts/clipboard.swf" style="display: none !important;"></div><a href="http://flowingdata.com/2013/07/08/small-maps-and-grids/#printSource" title="print" class="item printSource" style="width: 16px; height: 16px;">print</a><a href="http://flowingdata.com/2013/07/08/small-maps-and-grids/#about" title="?" class="item about" style="width: 16px; height: 16px;">?</a></div></div><div class="lines"><div class="line alt1"><table><tbody><tr><td class="number"><code>1</code></td><td class="content"><code class="comments"># Map for every road function</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>2</code></td><td class="content"><code class="plain">fncs &lt;- </code><code class="functions">unique</code><code class="plain">(acc$ROAD_FNC)</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>3</code></td><td class="content"><code class="plain">fnc_names &lt;- </code><code class="functions">read.table</code><code class="plain">(</code><code class="string">"data/road-fnc-vals.csv"</code><code class="plain">, as.is=</code><code class="keyword">TRUE</code><code class="plain">, header=</code><code class="keyword">TRUE</code><code class="plain">, sep=</code><code class="string">","</code><code class="plain">)</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>4</code></td><td class="content"><code class="functions">length</code><code class="plain">(fncs)</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>5</code></td><td class="content"><code class="functions">par</code><code class="plain">(mfrow=</code><code class="functions">c</code><code class="plain">(4,4), mar=</code><code class="functions">c</code><code class="plain">(0,0,0,0))</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>6</code></td><td class="content"><code class="functions">for </code><code class="plain">(i </code><code class="keyword">in</code> <code class="plain">1:</code><code class="functions">length</code><code class="plain">(fncs)) {</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>7</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>8</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">acc.fnc &lt;- acc[acc$ROAD_FNC == fncs[i],]</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>9</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="functions">map</code><code class="plain">(</code><code class="string">"state"</code><code class="plain">, proj=</code><code class="string">"albers"</code><code class="plain">, param=</code><code class="functions">c</code><code class="plain">(39,45), lwd=1, col=</code><code class="string">"#f0f0f0"</code><code class="plain">)</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>10</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="functions">points</code><code class="plain">(</code><code class="functions">mapproject</code><code class="plain">(acc.fnc$longitud, acc.fnc$latitude), col=</code><code class="keyword">NA</code><code class="plain">, bg=</code><code class="string">"#9c6910"</code><code class="plain">, pch=21, cex=0.15)</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>11</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>12</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="comments"># Label</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>13</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">fnc_name &lt;- fnc_names[fnc_names$code == fncs[i],]</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>14</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="functions">text</code><code class="plain">(</code><code class="functions">mapproject</code><code class="plain">(-99, 55), fnc_name$name, cex=1)</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>15</code></td><td class="content"><code class="plain">}</code></td></tr></tbody></table></div></div></div>
<p>This gives you a map for each type of road.</p>
<p><span class="tip">The map for interstate accidents stands out from the rest.</span><img src="./Small Maps and Grids_files/08-By-road-function.png" alt="08-By road function" class="alignnone size-medium wp-image-31469" width="625" height="548" src-orig="http://i1.wp.com/flowingdata.com/wp-content/uploads/2013/07/08-By-road-function.png?resize=625%2C548" scale="2"></p>
<h3>Applying the same idea to choropleth maps</h3>
<p>Say instead of point maps, you want to aggregate by state and map with choropleth. The logic is still the same: Learn to make one map and then make more of them.</p>
<p><span class="tip">I realize it would've been better to use 2001 population numbers, but for the purposes of this tutorial, this should be okay.</span>It might be useful to map the number of accidents by state, but instead of absolute counts, let's look at number of accidents per million population. I put state population for 2012 in states.csv.</p>
<div id="highlighter_388455" class="syntaxhighlighter  "><div class="bar"><div class="toolbar"><a href="http://flowingdata.com/2013/07/08/small-maps-and-grids/#viewSource" title="view source" class="item viewSource" style="width: 16px; height: 16px;">view source</a><div class="item copyToClipboard"><div style="display: block; cursor: pointer; text-align: center; width: 16px; height: 16px; top: auto; left: auto; position: static;"><div style="-webkit-transition: opacity 150ms ease-out; transition: opacity 150ms ease-out; background-image: url(chrome-extension://gofhjkjmkpinhpoiabjplobcaignabnl/icon_play.png); text-align: left; opacity: 0.25; border: 1px solid rgb(0, 0, 0); width: 100%; height: 100%; background-color: rgba(193, 217, 244, 0.498039); background-repeat: no-repeat no-repeat;"></div></div><embed width="16" height="16" id="highlighter_388455_clipboard" type="application/x-shockwave-flash" title="copy to clipboard" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_388455" menu="false" src="http://flowingdata.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter2/scripts/clipboard.swf" style="display: none !important;"></div><a href="http://flowingdata.com/2013/07/08/small-maps-and-grids/#printSource" title="print" class="item printSource" style="width: 16px; height: 16px;">print</a><a href="http://flowingdata.com/2013/07/08/small-maps-and-grids/#about" title="?" class="item about" style="width: 16px; height: 16px;">?</a></div></div><div class="lines"><div class="line alt1"><table><tbody><tr><td class="number"><code>1</code></td><td class="content"><code class="plain">statepop &lt;- </code><code class="functions">read.csv</code><code class="plain">(</code><code class="string">"data/states.csv"</code><code class="plain">)</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>2</code></td><td class="content"><code class="plain">statecnts &lt;- </code><code class="functions">count</code><code class="plain">(acc$STATE)</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>3</code></td><td class="content"><code class="plain">states &lt;- </code><code class="functions">merge</code><code class="plain">(statepop, statecnts, by.x=</code><code class="string">"code"</code><code class="plain">, by.y=</code><code class="string">"x"</code><code class="plain">)</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>4</code></td><td class="content"><code class="plain">states$accrate &lt;- states$freq / (states$pop2012/1000000)</code></td></tr></tbody></table></div></div></div>
<p>Here's a helper function that will help in the next step. It takes a value and returns a color based on that number.</p>
<div id="highlighter_193154" class="syntaxhighlighter  "><div class="bar"><div class="toolbar"><a href="http://flowingdata.com/2013/07/08/small-maps-and-grids/#viewSource" title="view source" class="item viewSource" style="width: 16px; height: 16px;">view source</a><div class="item copyToClipboard"><div style="display: block; cursor: pointer; text-align: center; width: 16px; height: 16px; top: auto; left: auto; position: static;"><div style="-webkit-transition: opacity 150ms ease-out; transition: opacity 150ms ease-out; background-image: url(chrome-extension://gofhjkjmkpinhpoiabjplobcaignabnl/icon_play.png); text-align: left; opacity: 0.25; border: 1px solid rgb(0, 0, 0); width: 100%; height: 100%; background-color: rgba(193, 217, 244, 0.498039); background-repeat: no-repeat no-repeat;"></div></div><embed width="16" height="16" id="highlighter_193154_clipboard" type="application/x-shockwave-flash" title="copy to clipboard" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_193154" menu="false" src="http://flowingdata.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter2/scripts/clipboard.swf" style="display: none !important;"></div><a href="http://flowingdata.com/2013/07/08/small-maps-and-grids/#printSource" title="print" class="item printSource" style="width: 16px; height: 16px;">print</a><a href="http://flowingdata.com/2013/07/08/small-maps-and-grids/#about" title="?" class="item about" style="width: 16px; height: 16px;">?</a></div></div><div class="lines"><div class="line alt1"><table><tbody><tr><td class="number"><code>1</code></td><td class="content"><code class="comments"># Helper function to get color (annual), based on actions per million population</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>2</code></td><td class="content"><code class="plain">getColor &lt;- </code><code class="functions">function</code><code class="plain">(x) {</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>3</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="functions">if </code><code class="plain">(x &gt; 200) {</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>4</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">col &lt;- </code><code class="string">"#13373e"</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>5</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">} </code><code class="keyword">else</code> <code class="functions">if </code><code class="plain">(x &gt; 150) {</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>6</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">col &lt;- </code><code class="string">"#246571"</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>7</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">} </code><code class="keyword">else</code> <code class="functions">if </code><code class="plain">(x &gt; 100) {</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>8</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">col &lt;- </code><code class="string">"#308898"</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>9</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">} </code><code class="keyword">else</code> <code class="plain">{</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>10</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">col &lt;- </code><code class="string">"#7bc7d5"</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>11</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>12</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="functions">return</code><code class="plain">(col)</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>13</code></td><td class="content"><code class="plain">}</code></td></tr></tbody></table></div></div></div>
<p>Now get a color for each accident rate per state. Apply the <code>getColor()</code> helper function to each value. Then all you have to do is map regions with those colors. Be sure to set fill to TRUE and col to statecols.</p>
<div id="highlighter_460643" class="syntaxhighlighter  "><div class="bar"><div class="toolbar"><a href="http://flowingdata.com/2013/07/08/small-maps-and-grids/#viewSource" title="view source" class="item viewSource" style="width: 16px; height: 16px;">view source</a><div class="item copyToClipboard"><div style="display: block; cursor: pointer; text-align: center; width: 16px; height: 16px; top: auto; left: auto; position: static;"><div style="-webkit-transition: opacity 150ms ease-out; transition: opacity 150ms ease-out; background-image: url(chrome-extension://gofhjkjmkpinhpoiabjplobcaignabnl/icon_play.png); text-align: left; opacity: 0.25; border: 1px solid rgb(0, 0, 0); width: 100%; height: 100%; background-color: rgba(193, 217, 244, 0.498039); background-repeat: no-repeat no-repeat;"></div></div><embed width="16" height="16" id="highlighter_460643_clipboard" type="application/x-shockwave-flash" title="copy to clipboard" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_460643" menu="false" src="http://flowingdata.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter2/scripts/clipboard.swf" style="display: none !important;"></div><a href="http://flowingdata.com/2013/07/08/small-maps-and-grids/#printSource" title="print" class="item printSource" style="width: 16px; height: 16px;">print</a><a href="http://flowingdata.com/2013/07/08/small-maps-and-grids/#about" title="?" class="item about" style="width: 16px; height: 16px;">?</a></div></div><div class="lines"><div class="line alt1"><table><tbody><tr><td class="number"><code>1</code></td><td class="content"><code class="plain">statecols &lt;- </code><code class="functions">sapply</code><code class="plain">(states$accrate, FUN=getColor)</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>2</code></td><td class="content"><code class="functions">map</code><code class="plain">(</code><code class="string">"state"</code><code class="plain">, regions=states$name, proj=</code><code class="string">"albers"</code><code class="plain">, param=</code><code class="functions">c</code><code class="plain">(39,45), fill=</code><code class="keyword">TRUE</code><code class="plain">, col=statecols, border=</code><code class="keyword">NA</code><code class="plain">, resolution=0)</code></td></tr></tbody></table></div></div></div>
<p><span class="tip">If you didn't divide by population, the states would be colored by population. In this case, rate is of greater interest.</span><img src="./Small Maps and Grids_files/09-Choropleth-state-map.png" alt="09-Choropleth state map" class="alignnone size-medium wp-image-31470" width="625" height="397" src-orig="http://i1.wp.com/flowingdata.com/wp-content/uploads/2013/07/09-Choropleth-state-map.png?resize=625%2C397" scale="2"></p>
<p>The resolution argument specifies the accuracy of the map. A resolution of zero is most accurate, and a resolution of 1 is least accurate. You can see below that a map of resolution of 1 is a little more rough. </p>
<div id="highlighter_188310" class="syntaxhighlighter  "><div class="bar"><div class="toolbar"><a href="http://flowingdata.com/2013/07/08/small-maps-and-grids/#viewSource" title="view source" class="item viewSource" style="width: 16px; height: 16px;">view source</a><div class="item copyToClipboard"><div style="display: block; cursor: pointer; text-align: center; width: 16px; height: 16px; top: auto; left: auto; position: static;"><div style="-webkit-transition: opacity 150ms ease-out; transition: opacity 150ms ease-out; background-image: url(chrome-extension://gofhjkjmkpinhpoiabjplobcaignabnl/icon_play.png); text-align: left; opacity: 0.25; border: 1px solid rgb(0, 0, 0); width: 100%; height: 100%; background-color: rgba(193, 217, 244, 0.498039); background-repeat: no-repeat no-repeat;"></div></div><embed width="16" height="16" id="highlighter_188310_clipboard" type="application/x-shockwave-flash" title="copy to clipboard" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_188310" menu="false" src="http://flowingdata.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter2/scripts/clipboard.swf" style="display: none !important;"></div><a href="http://flowingdata.com/2013/07/08/small-maps-and-grids/#printSource" title="print" class="item printSource" style="width: 16px; height: 16px;">print</a><a href="http://flowingdata.com/2013/07/08/small-maps-and-grids/#about" title="?" class="item about" style="width: 16px; height: 16px;">?</a></div></div><div class="lines"><div class="line alt1"><table><tbody><tr><td class="number"><code>1</code></td><td class="content"><code class="functions">map</code><code class="plain">(</code><code class="string">"state"</code><code class="plain">, regions=states$name, proj=</code><code class="string">"albers"</code><code class="plain">, param=</code><code class="functions">c</code><code class="plain">(39,45), fill=</code><code class="keyword">TRUE</code><code class="plain">, col=statecols, border=</code><code class="keyword">NA</code><code class="plain">, resolution=1)</code></td></tr></tbody></table></div></div></div>
<p><span class="tip">The lower resolution borders cause space in between states like a puzzle with pieces that don't quite fit.</span><img src="./Small Maps and Grids_files/10-Choropleth-state-map-lower-resolution.png" alt="10-Choropleth state map lower resolution" class="alignnone size-medium wp-image-31471" width="625" height="395" src-orig="http://i0.wp.com/flowingdata.com/wp-content/uploads/2013/07/10-Choropleth-state-map-lower-resolution.png?resize=625%2C395" scale="2"></p>
<p>So that's how you make one choropleth map. Time to move on to multiple maps. The process is the same as before. First, the helper function to get color based on a value.</p>
<div id="highlighter_93611" class="syntaxhighlighter  "><div class="bar"><div class="toolbar"><a href="http://flowingdata.com/2013/07/08/small-maps-and-grids/#viewSource" title="view source" class="item viewSource" style="width: 16px; height: 16px;">view source</a><div class="item copyToClipboard"><div style="display: block; cursor: pointer; text-align: center; width: 16px; height: 16px; top: auto; left: auto; position: static;"><div style="-webkit-transition: opacity 150ms ease-out; transition: opacity 150ms ease-out; background-image: url(chrome-extension://gofhjkjmkpinhpoiabjplobcaignabnl/icon_play.png); text-align: left; opacity: 0.25; border: 1px solid rgb(0, 0, 0); width: 100%; height: 100%; background-color: rgba(193, 217, 244, 0.498039); background-repeat: no-repeat no-repeat;"></div></div><embed width="16" height="16" id="highlighter_93611_clipboard" type="application/x-shockwave-flash" title="copy to clipboard" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_93611" menu="false" src="http://flowingdata.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter2/scripts/clipboard.swf" style="display: none !important;"></div><a href="http://flowingdata.com/2013/07/08/small-maps-and-grids/#printSource" title="print" class="item printSource" style="width: 16px; height: 16px;">print</a><a href="http://flowingdata.com/2013/07/08/small-maps-and-grids/#about" title="?" class="item about" style="width: 16px; height: 16px;">?</a></div></div><div class="lines"><div class="line alt1"><table><tbody><tr><td class="number"><code>1</code></td><td class="content"><code class="plain">getColor.m &lt;- </code><code class="functions">function</code><code class="plain">(x) {&nbsp; </code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>2</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="functions">if </code><code class="plain">(x &gt; 20) {</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>3</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">col &lt;- </code><code class="string">"#13373e"</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>4</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">} </code><code class="keyword">else</code> <code class="functions">if </code><code class="plain">(x &gt; 15) {</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>5</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">col &lt;- </code><code class="string">"#246571"</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>6</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">} </code><code class="keyword">else</code> <code class="functions">if </code><code class="plain">(x &gt; 10) {</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>7</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">col &lt;- </code><code class="string">"#308898"</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>8</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">} </code><code class="keyword">else</code> <code class="plain">{</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>9</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">col &lt;- </code><code class="string">"#7bc7d5"</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>10</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>11</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="functions">return</code><code class="plain">(col)</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>12</code></td><td class="content"><code class="plain">}</code></td></tr></tbody></table></div></div></div>
<p>Now draw a map for each month.</p>
<div id="highlighter_358029" class="syntaxhighlighter  "><div class="bar"><div class="toolbar"><a href="http://flowingdata.com/2013/07/08/small-maps-and-grids/#viewSource" title="view source" class="item viewSource" style="width: 16px; height: 16px;">view source</a><div class="item copyToClipboard"><div style="display: block; cursor: pointer; text-align: center; width: 16px; height: 16px; top: auto; left: auto; position: static;"><div style="-webkit-transition: opacity 150ms ease-out; transition: opacity 150ms ease-out; background-image: url(chrome-extension://gofhjkjmkpinhpoiabjplobcaignabnl/icon_play.png); text-align: left; opacity: 0.25; border: 1px solid rgb(0, 0, 0); width: 100%; height: 100%; background-color: rgba(193, 217, 244, 0.498039); background-repeat: no-repeat no-repeat;"></div></div><embed width="16" height="16" id="highlighter_358029_clipboard" type="application/x-shockwave-flash" title="copy to clipboard" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_358029" menu="false" src="http://flowingdata.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter2/scripts/clipboard.swf" style="display: none !important;"></div><a href="http://flowingdata.com/2013/07/08/small-maps-and-grids/#printSource" title="print" class="item printSource" style="width: 16px; height: 16px;">print</a><a href="http://flowingdata.com/2013/07/08/small-maps-and-grids/#about" title="?" class="item about" style="width: 16px; height: 16px;">?</a></div></div><div class="lines"><div class="line alt1"><table><tbody><tr><td class="number"><code>1</code></td><td class="content"><code class="comments"># Draw the maps</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>2</code></td><td class="content"><code class="functions">par</code><code class="plain">(mfrow=</code><code class="functions">c</code><code class="plain">(4,4), mar=</code><code class="functions">c</code><code class="plain">(0,0,0,0))</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>3</code></td><td class="content"><code class="plain">months &lt;- 1:12</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>4</code></td><td class="content"><code class="plain">monthnames &lt;- </code><code class="functions">c</code><code class="plain">(</code><code class="string">"January"</code><code class="plain">, </code><code class="string">"February"</code><code class="plain">, </code><code class="string">"March"</code><code class="plain">, </code><code class="string">"April"</code><code class="plain">, </code><code class="string">"May"</code><code class="plain">, </code><code class="string">"June"</code><code class="plain">, </code><code class="string">"July"</code><code class="plain">, </code><code class="string">"August"</code><code class="plain">, </code><code class="string">"September"</code><code class="plain">, </code><code class="string">"October"</code><code class="plain">, </code><code class="string">"November"</code><code class="plain">, </code><code class="string">"December"</code><code class="plain">)</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>5</code></td><td class="content"><code class="functions">for </code><code class="plain">(m </code><code class="keyword">in</code> <code class="plain">months) {</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>6</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>7</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">acc.m &lt;- acc[acc$MONTH == m,]</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>8</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">statecnts.m &lt;- </code><code class="functions">count</code><code class="plain">(acc.m$STATE)</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>9</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">states.m &lt;- </code><code class="functions">merge</code><code class="plain">(statepop, statecnts.m, by.x=</code><code class="string">"code"</code><code class="plain">, by.y=</code><code class="string">"x"</code><code class="plain">)</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>10</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">states.m$accrate &lt;- states.m$freq / (states.m$pop2012/1000000)</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>11</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>12</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">statecols.m &lt;- </code><code class="functions">sapply</code><code class="plain">(states.m$accrate, FUN=getColor.m)</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>13</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="functions">map</code><code class="plain">(</code><code class="string">"state"</code><code class="plain">, regions=states.m$name, proj=</code><code class="string">"albers"</code><code class="plain">, param=</code><code class="functions">c</code><code class="plain">(39,45), fill=</code><code class="keyword">TRUE</code><code class="plain">, col=statecols.m, border=</code><code class="keyword">NA</code><code class="plain">, resolution=0)</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>14</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>15</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="functions">text</code><code class="plain">(</code><code class="functions">mapproject</code><code class="plain">(-99, 55), monthnames[m], cex=1)</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>16</code></td><td class="content"><code class="plain">}</code></td></tr></tbody></table></div></div></div>
<p>Tada:</p>
<p><img src="./Small Maps and Grids_files/11-Grid-of-choropleth-maps.png" alt="11-Grid of choropleth maps" class="alignnone size-medium wp-image-31472" width="625" height="582" src-orig="http://i2.wp.com/flowingdata.com/wp-content/uploads/2013/07/11-Grid-of-choropleth-maps.png?resize=625%2C582" scale="2"></p>
<p>The legend on the bottom is a make-shift one using the <code>rect()</code> function.</p>
<div id="highlighter_70145" class="syntaxhighlighter  "><div class="bar"><div class="toolbar"><a href="http://flowingdata.com/2013/07/08/small-maps-and-grids/#viewSource" title="view source" class="item viewSource" style="width: 16px; height: 16px;">view source</a><div class="item copyToClipboard"><div style="display: block; cursor: pointer; text-align: center; width: 16px; height: 16px; top: auto; left: auto; position: static;"><div style="-webkit-transition: opacity 150ms ease-out; transition: opacity 150ms ease-out; background-image: url(chrome-extension://gofhjkjmkpinhpoiabjplobcaignabnl/icon_play.png); text-align: left; opacity: 0.25; border: 1px solid rgb(0, 0, 0); width: 100%; height: 100%; background-color: rgba(193, 217, 244, 0.498039); background-repeat: no-repeat no-repeat;"></div></div><embed width="16" height="16" id="highlighter_70145_clipboard" type="application/x-shockwave-flash" title="copy to clipboard" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_70145" menu="false" src="http://flowingdata.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter2/scripts/clipboard.swf" style="display: none !important;"></div><a href="http://flowingdata.com/2013/07/08/small-maps-and-grids/#printSource" title="print" class="item printSource" style="width: 16px; height: 16px;">print</a><a href="http://flowingdata.com/2013/07/08/small-maps-and-grids/#about" title="?" class="item about" style="width: 16px; height: 16px;">?</a></div></div><div class="lines"><div class="line alt1"><table><tbody><tr><td class="number"><code>1</code></td><td class="content"><code class="comments"># Make-shift legend</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>2</code></td><td class="content"><code class="functions">plot</code><code class="plain">(0, 0, type=</code><code class="string">"n"</code><code class="plain">, axes=</code><code class="keyword">FALSE</code><code class="plain">, xlim=</code><code class="functions">c</code><code class="plain">(0,30), ylim=</code><code class="functions">c</code><code class="plain">(0,2))</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>3</code></td><td class="content"><code class="functions">rect</code><code class="plain">(</code><code class="functions">c</code><code class="plain">(5,10,15,20), </code><code class="functions">c</code><code class="plain">(1,1,1,1), </code><code class="functions">c</code><code class="plain">(10,15,20,25), </code><code class="functions">c</code><code class="plain">(1.25,1.25,1.25,1.25), col=</code><code class="functions">sapply</code><code class="plain">(</code><code class="functions">c</code><code class="plain">(6,11,16,21), getColor.m), border=</code><code class="string">"white"</code><code class="plain">, lwd=0.4)</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>4</code></td><td class="content"><code class="functions">text</code><code class="plain">(15, 1.35, </code><code class="string">"Accidents per mil. pop."</code><code class="plain">)</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>5</code></td><td class="content"><code class="functions">text</code><code class="plain">(</code><code class="functions">c</code><code class="plain">(10,15,20), </code><code class="functions">c</code><code class="plain">(0.9,0.9,0.9), </code><code class="functions">c</code><code class="plain">(10,15,20), cex=0.8) </code><code class="comments"># Tick labels</code></td></tr></tbody></table></div></div></div>
<h3>Wrapping up</h3>
<p>At this point, you can experiment with color, projections, and your own data. I'd probably bring it into Adobe Illustrator for post-editing, but you can also mess around with parameters in R. The key is knowing how to make that individual map. Figure out how to do that, and then iterate to get multiple maps.</p>
<div class="clear-line"></div>
</div> 
</div> 
<div class="clear-line"></div>
<div id="end"></div>
 
<span id="comments"></span>
<div style="width:625px">
<div id="comments-block">
<h2>2 Comments</h2>
<ul class="commentlist">
<li class="comment byuser comment-author-mattsigal even thread-even depth-1" id="li-comment-238563">
<div id="comment-238563" class="">
<div class="avatar">
<img alt="" src="./Small Maps and Grids_files/28e69a7a18d299f35877dac82e502886" class="avatar avatar-50 photo" height="50" width="50" originals="50" src-orig="http://0.gravatar.com/avatar/28e69a7a18d299f35877dac82e502886?s=50&amp;d=http%3A%2F%2Fflowingdata.com%2Fwp-content%2Fthemes%2Fflowingdata-4-8%2Fimages%2Fblank-square.png%3Fs%3D50&amp;r=PG" scale="2"> </div> 
<div class="comment-content">
<div class="comment-author vcard">
<cite class="fn">Matthew Sigal</cite> <span class="comment-meta">— <a href="http://flowingdata.com/2013/07/08/small-maps-and-grids/#comment-238563">July 8, 2013 at 10:40 am</a>
</span>
</div>
<div class="comment-text"><p>In a future tutorial, is there any way you could explain how to use maps for places that aren’t included in the maps library? For instance, I would love to be able to replicate this tutorial for Canada instead of the USA but can’t seem to get the shapefile to load correctly. A general tutorial for doing so would be really appreciated!</p>
</div>
<div class="reply">
</div>
</div> 
<div class="clear-line"></div>
</div>
</li> 
<li class="comment byuser comment-author-ulrich odd alt thread-odd thread-alt depth-1" id="li-comment-238586">
<div id="comment-238586" class="">
<div class="avatar">
<img alt="" src="./Small Maps and Grids_files/d1dc886b5a4eb2f048886b5b98590caa" class="avatar avatar-50 photo" height="50" width="50" originals="50" src-orig="http://1.gravatar.com/avatar/d1dc886b5a4eb2f048886b5b98590caa?s=50&amp;d=http%3A%2F%2Fflowingdata.com%2Fwp-content%2Fthemes%2Fflowingdata-4-8%2Fimages%2Fblank-square.png%3Fs%3D50&amp;r=PG" scale="2"> </div> 
<div class="comment-content">
<div class="comment-author vcard">
<cite class="fn">Ulrich</cite> <span class="comment-meta">— <a href="http://flowingdata.com/2013/07/08/small-maps-and-grids/#comment-238586">July 8, 2013 at 1:37 pm</a>
</span>
</div>
<div class="comment-text"><p>I echo Matthew. Would be great to see sources for European maps as well.</p>
</div>
<div class="reply">
</div>
</div> 
<div class="clear-line"></div>
</div>
</li> 
</ul>
</div> 
</div>
</div>
</div> 
</div> 
</div> 
<div id="footer">
<div id="footer-container" class="content">
<div class="float-left" style="width:32%;margin-right:5%;">
<div id="about" class="sec">
<h3>About</h3>
<p>FlowingData explores how designers, statisticians, and computer scientists are using data to understand ourselves better — mainly through data visualization.</p>
<p>As for me, I'm Nathan Yau, and I have a PhD in statistics, with a background in eating.</p>
<p><a href="http://flowingdata.com/about/">More...</a></p>
</div>
</div>
<div class="float-left" style="width:36%;margin-right:5%;">
<div id="book-single" class="sec">
<h3>Books</h3>
<ul id="books" style="margin-bottom:0">
<li>
<a href="http://flowingdata.com/data-points/"><img src="./Small Maps and Grids_files/DataPoints60x75.png" title="Data Points" class="img-left" style="margin-bottom:0" scale="0"><strong>Data Points</strong><br>Visualization that Means Something</a><br>
<div class="clear-line"></div>
</li>
<li><a href="http://flowingdata.com/visualize-this/"><img src="./Small Maps and Grids_files/flowingdata60x79.jpg" title="Visualize This" class="img-left" style="margin-bottom:0" scale="0"><strong>Visualize This</strong><br>The FlowingData Guide to Design, Visualization, and Statistics</a><br>
<div class="clear-line"></div>
</li>
</ul>
</div> 
</div>
<div class="float-left" style="width:22%">
<div id="follow" class="sec">
<h3>Follow</h3>
<p>
<a href="http://twitter.com/flowingdata">Twitter</a> &nbsp;•&nbsp;
<a href="http://facebook.com/flowingdata">Facebook</a> &nbsp;•&nbsp;
<a href="http://eepurl.com/icL0o">Email</a> &nbsp;•&nbsp;
<a href="http://flowingdata.com/feed">RSS</a>
</p>
</div>
<div id="misc" class="sec">
<h3>Miscellaneous</h3>
<a href="http://flowingdata.com/contact">Contact</a> &nbsp;•&nbsp;
<a href="http://flowingdata.com/advertise">Sponsorship</a> &nbsp;•&nbsp;
<a href="http://flowingdata.bigcartel.com/">Shop</a><a>
</a></div><a>
</a></div><a>
<div class="clear-line"></div>
</a></div><a> 
</a></div><a> 
</a><div id="bottom"><a>
Unless otherwise noted, graphics and words by me are licensed under </a><a href="http://creativecommons.org/licenses/by-nc/3.0/us/">Creative Commons BY-NC</a>. Contact original authors for everything else.
</div>
 
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script><script src="./Small Maps and Grids_files/ga.js" type="text/javascript"></script>
<script type="text/javascript">
var pageTracker = _gat._getTracker("UA-865100-4");
pageTracker._initData();
pageTracker._trackPageview();
</script>
<script type="text/javascript" src="./Small Maps and Grids_files/shCore.js"></script>
<script type="text/javascript" src="./Small Maps and Grids_files/shBrushR.js"></script>
<script type="text/javascript">
	(function(){
		var corecss = document.createElement('link');
		var themecss = document.createElement('link');
		var corecssurl = "http://flowingdata.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter2/styles/shCore.css?ver=2.1.364";
		if ( corecss.setAttribute ) {
				corecss.setAttribute( "rel", "stylesheet" );
				corecss.setAttribute( "type", "text/css" );
				corecss.setAttribute( "href", corecssurl );
		} else {
				corecss.rel = "stylesheet";
				corecss.href = corecssurl;
		}
		document.getElementsByTagName("head")[0].insertBefore( corecss, document.getElementById("syntaxhighlighteranchor") );
		var themecssurl = "http://flowingdata.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter2/styles/shThemeDefault.css?ver=2.1.364";
		if ( themecss.setAttribute ) {
				themecss.setAttribute( "rel", "stylesheet" );
				themecss.setAttribute( "type", "text/css" );
				themecss.setAttribute( "href", themecssurl );
		} else {
				themecss.rel = "stylesheet";
				themecss.href = themecssurl;
		}
		//document.getElementById("syntaxhighlighteranchor").appendChild(themecss);
		document.getElementsByTagName("head")[0].insertBefore( themecss, document.getElementById("syntaxhighlighteranchor") );
	})();
	SyntaxHighlighter.config.clipboardSwf = 'http://flowingdata.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter2/scripts/clipboard.swf';
	SyntaxHighlighter.config.strings.expandSource = 'show source';
	SyntaxHighlighter.config.strings.viewSource = 'view source';
	SyntaxHighlighter.config.strings.copyToClipboard = 'copy to clipboard';
	SyntaxHighlighter.config.strings.copyToClipboardConfirmation = 'The code is in your clipboard now';
	SyntaxHighlighter.config.strings.print = 'print';
	SyntaxHighlighter.config.strings.help = '?';
	SyntaxHighlighter.config.strings.alert = 'SyntaxHighlighter\n\n';
	SyntaxHighlighter.config.strings.noBrush = 'Can\'t find brush for: ';
	SyntaxHighlighter.config.strings.brushNotHtmlScript = 'Brush wasn\'t configured for html-script option: ';
	SyntaxHighlighter.defaults['pad-line-numbers'] = false;
	SyntaxHighlighter.all();
</script>
<script type="text/javascript" src="./Small Maps and Grids_files/photon.js"></script>
<script type="text/javascript" src="./Small Maps and Grids_files/devicepx-jetpack.js"></script>
<script src="./Small Maps and Grids_files/e-201350.js" type="text/javascript"></script>
<script type="text/javascript">
	st_go({v:'ext',j:'1:2.7',blog:'1938889',post:'31457',tz:'-8'});
	var load_cmc = function(){linktracker_init(1938889,31457,2);};
	if ( typeof addLoadEvent != 'undefined' ) addLoadEvent(load_cmc);
	else load_cmc();
	</script><img id="wpstats" src="./Small Maps and Grids_files/g.gif" alt="" scale="0">
</body></html>