<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- saved from url=(0076)http://flowingdata.com/2011/05/11/how-to-map-connections-with-great-circles/ -->
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US"><head profile="http://gmpg.org/xfn/11"><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<title> How to map connections with great circles</title>
<meta name="generator" content="WordPress 3.8">  
<link rel="stylesheet" href="./How to map connections with great circles_files/style.css" type="text/css" media="screen">
<link rel="alternate" type="application/rss+xml" title="RSS 2.0" href="http://flowingdata.com/feed">
<link rel="pingback" href="http://flowingdata.com/xmlrpc.php">
<link rel="shortcut icon" href="http://flowingdata.com/wp-content/themes/flowingdata-4-8/images/favicon.ico">
<script src="./How to map connections with great circles_files/quant.js" async="" type="text/javascript"></script><script async="" type="text/javascript" src="http://www.googletagservices.com/tag/js/gpt.js"></script><script type="text/javascript" src="./How to map connections with great circles_files/jquery-1.4.4.min.js"></script>
<script type="text/javascript">
    var googletag = googletag || {};
    googletag.cmd = googletag.cmd || [];
    (function() {
    var gads = document.createElement('script');
    gads.async = true;
    gads.type = 'text/javascript';
    var useSSL = 'https:' == document.location.protocol;
    gads.src = (useSSL ? 'https:' : 'http:') + 
    '//www.googletagservices.com/tag/js/gpt.js';
    var node = document.getElementsByTagName('script')[0];
    node.parentNode.insertBefore(gads, node);
    })();
    </script>
<script type="text/javascript">
    googletag.cmd.push(function() {
    googletag.defineSlot('/2462688/Sidebar_rectangle', [300, 250], 'div-gpt-ad-1332011316310-2').addService(googletag.pubads());
    googletag.defineSlot('/2462688/Square1', [125, 125], 'div-gpt-ad-1332011316310-3').addService(googletag.pubads());
    googletag.defineSlot('/2462688/Square2', [125, 125], 'div-gpt-ad-1332011316310-4').addService(googletag.pubads());
    googletag.defineSlot('/2462688/Square3', [125, 125], 'div-gpt-ad-1332011316310-5').addService(googletag.pubads());
    googletag.defineSlot('/2462688/Square4', [125, 125], 'div-gpt-ad-1358209090048-5').addService(googletag.pubads());
googletag.defineSlot('/2462688/Bottom_Post', [300, 250], 'div-gpt-ad-1332011316310-0').addService(googletag.pubads());    googletag.pubads().enableSingleRequest();
    googletag.pubads().collapseEmptyDivs();
    googletag.enableServices();
    });
    </script>
<link rel="alternate" type="application/rss+xml" title="FlowingData Â» How to map connections with great circles Comments Feed" href="http://flowingdata.com/2011/05/11/how-to-map-connections-with-great-circles/feed/">
<script type="text/javascript" src="./How to map connections with great circles_files/comment-reply.min.js"></script>
<script type="text/javascript" src="./How to map connections with great circles_files/jquery.js"></script>
<script type="text/javascript" src="./How to map connections with great circles_files/jquery-migrate.min.js"></script>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://flowingdata.com/xmlrpc.php?rsd">
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://flowingdata.com/wp-includes/wlwmanifest.xml">
<link rel="prev" title="Ben Cerveny talks Planetary and where they go next" href="http://flowingdata.com/2011/05/11/ben-cerveny-talks-planetary-and-where-they-go-next/">
<link rel="next" title="A century of deaths and a lot of fake blood" href="http://flowingdata.com/2011/05/12/a-century-of-deaths-and-a-lot-of-fake-blood/">
<meta name="generator" content="WordPress 3.8">
<link rel="canonical" href="./How to map connections with great circles_files/How to map connections with great circles.html">
<link rel="shortlink" href="http://flowingdata.com/?p=16555">
 <script type="text/javascript" src="./How to map connections with great circles_files/democracy.js"></script><link rel="stylesheet" href="./How to map connections with great circles_files/basic.css" type="text/css"><link rel="stylesheet" href="./How to map connections with great circles_files/style(1).css" type="text/css"><link rel="stylesheet" href="./How to map connections with great circles_files/wp-page-numbers.css" type="text/css" media="screen"><style type="text/css">img#wpstats{display:none}</style><link rel="stylesheet" type="text/css" href="./How to map connections with great circles_files/shCore.css"><link rel="stylesheet" type="text/css" href="./How to map connections with great circles_files/shThemeDefault.css"><style type="text/css" id="syntaxhighlighteranchor"></style>
<style>#yjcaqmuxhpuxrqzdcxyepsemifaoqfpxhqkt{border:solid 2px #fff !important;box-sizing:content-box !important;color:#fff !important;display:block !important;height:auto !important;margin:0 !important;opacity:0.9 !important;padding:7px 10px !important;position:fixed !important;visibility:visible !important;width:auto !important;z-index:2147483647 !important;-webkit-border-radius:5px !important;-webkit-box-shadow:0px 0px 20px #000 !important;-webkit-box-sizing:content-box !important;}.yjcaqmuxhpuxrqzdcxyepsemifaoqfpxhqkt-blocked{color:#777 !important;display:inline !important;text-decoration:line-through !important;}#yjcaqmuxhpuxrqzdcxyepsemifaoqfpxhqkt br{display:block !important;}#yjcaqmuxhpuxrqzdcxyepsemifaoqfpxhqkt span{background:transparent !important;}#yjcaqmuxhpuxrqzdcxyepsemifaoqfpxhqkt div{border:0 !important;margin:0 !important;padding:0 !important;width:auto !important;letter-spacing:normal !important;font:13px Arial,Helvetica !important;text-align:left !important;text-shadow:none !important;text-transform:none !important;word-spacing:normal !important;}#yjcaqmuxhpuxrqzdcxyepsemifaoqfpxhqkt a{font-weight:normal !important;background:none !important;text-decoration:underline !important;color:#fff !important;}@media print{#yjcaqmuxhpuxrqzdcxyepsemifaoqfpxhqkt{display:none !important;}}</style></head><style type="text/css">embed[type*="application/x-shockwave-flash"],embed[src*=".swf"],object[type*="application/x-shockwave-flash"],object[codetype*="application/x-shockwave-flash"],object[src*=".swf"],object[codebase*="swflash.cab"],object[classid*="D27CDB6E-AE6D-11cf-96B8-444553540000"],object[classid*="d27cdb6e-ae6d-11cf-96b8-444553540000"],object[classid*="D27CDB6E-AE6D-11cf-96B8-444553540000"]{	display: none !important;}</style>
<body style="">
<a name="top"></a>
<div id="topnav">
<div id="topnav-content" class="content">
<div id="login" class="float-right">
<span id="username-meta">Logged in as <a href="http://flowingdata.com/profile/">abresler</a> &nbsp;&nbsp;</span>
<a href="http://flowingdata.com/wp-login.php?action=logout&_wpnonce=d018091d15">Log out</a> </div>
</div>
<div class="clear-line"></div>
</div> 
<div id="header">
<div id="header-content" class="content">
<div id="nav">
<a href="http://flowingdata.com/">
<img src="./How to map connections with great circles_files/logo.png" class="float-left" scale="0">
</a>
<div id="pages" class="float-right">
<ul>
<li><a href="http://flowingdata.com/membership/">Membership</a></li>
<li><a href="http://flowingdata.com/learning/">Learning</a></li>
<li><a href="https://jobs.flowingdata.com/">Job Board</a></li>
<li><a href="http://flowingdata.com/category/projects/">Projects</a></li>
<li><a href="http://flowingdata.com/about/">About</a></li>
</ul>
</div> 
<div class="clear-line"></div>
</div> 
</div> 
</div> 
<div class="clear-line"></div>
<div id="main-wrapper">
<div id="content-wrapper" class="content">
<div class="post" id="post-16555">
<div id="content" class="single-long">
<div class="entry">
<div class="category">
<a href="http://flowingdata.com/category/tutorials/" title="View all posts in Tutorials" rel="category tag">Tutorials</a> &nbsp;/&nbsp; <a href="http://flowingdata.com/tag/airlines/" rel="tag">airlines</a>, <a href="http://flowingdata.com/tag/arcs/" rel="tag">arcs</a>, <a href="http://flowingdata.com/tag/featured/" rel="tag">featured</a>, <a href="http://flowingdata.com/tag/great-circle/" rel="tag">great circle</a> </div>
<h1>How to map connections with great circles</h1>
<div class="clear-line"></div>
<div class="author">
By <strong>Nathan Yau</strong>
</div> 
<div id="lead-in">
<p class="img-right"><img src="./How to map connections with great circles_files/4-airline-color.jpg" class="attachment-long-form-thumb wp-post-image" alt="Mapping connections with great circles" width="425" height="288" src-orig="http://i1.wp.com/flowingdata.com/wp-content/uploads/2011/05/4-airline-color.jpg?fit=425%2C9999" scale="2"></p>
<div class="entry-excerpt">
There are various ways to visualize connections, but one of the most intuitive and straightforward ways is to actually connect entities or objects with lines. And when it comes to <em>geographic</em> connections, great circles are a nice way to do this. </div>
<div id="tut-meta">
<div class="button-link"><a href="http://flowingdata.com/2011/05/05/where-do-major-airlines-fly-in-the-united-states/">Demo</a></div>
<div class="button-link"><a href="http://flowingdata.com/?s2member_file_download=2012/great-circle-connections.zip">Download Source</a></div>
<div class="clear-line"></div>
</div> 
<div class="clear-line"></div>
</div> 
<div class="entry-content">
<p>Here's the technical definition of great circles on Wikipedia:</p>
<blockquote><p>A great circle, also known as a Riemannian circle, of a sphere is the intersection of the sphere and a plane which passes through the center point of the sphere, as distinct from a small circle. Any diameter of any great circle coincides with a diameter of the sphere, and therefore all great circles have the same circumference as each other, and have the same center as the sphere. A great circle is the largest circle that can be drawn on any given sphere. Every circle in Euclidean space is a great circle of exactly one sphere.</p></blockquote>
<p><img src="./How to map connections with great circles_files/220px-Great_circle.png" alt="" title="Great circle" class="alignnone size-thumbnail wp-image-16563 img-right" width="210" height="192" src-orig="http://i1.wp.com/flowingdata.com/wp-content/uploads/2011/05/220px-Great_circle.png?resize=210%2C192" scale="2">The important bit is that the shortest distance between two points on a sphere is the minor arc of a great circle. When currents and wind don't interfere, ships and aircraft use great circle routes, which makes it perfect to show air carrier coverage. This is what you'll do in this example.</p>
<p>It turns out these maps are relatively easy to make in <a href="http://r-project.org/">R</a> once you know how to put the pieces together. The maps that I posted on <a href="http://flowingdata.com/2011/05/05/where-do-major-airlines-fly-in-the-united-states/">flight connections for each airline</a> are what we're after. With only about 30 lines of code, you can produce a series of maps that show flights for every major airline, so you get a lot of bang for the amount of effort.</p>
<h2>Step 0. Setup</h2>
<p><span class="tip">1. I wish they'd update the site; it totally looks like something out of the 1990s, but nevermind that. It's useful software.</span>You're going to use R in this example, so <a href="http://www.r-project.org/">download the free and open-source software</a> if you haven't already. It's a straightforward one-click install<sup>1</sup>.</p>
<h2>Step 1. Load packages</h2>
<p>Open R. You need two packages to do the heavy-lifting: <code>maps</code> and <code>geosphere</code>. If they're not installed, you can do that via the main menu <strong>Packages &amp; Data &gt; Package Installer</strong>. Once installed, load the two packages as follows:</p>
<div id="highlighter_39805" class="syntaxhighlighter  "><div class="bar"><div class="toolbar"><a href="http://flowingdata.com/2011/05/11/how-to-map-connections-with-great-circles/#viewSource" title="view source" class="item viewSource" style="width: 16px; height: 16px;">view source</a><div class="item copyToClipboard"><div style="display: block; cursor: pointer; text-align: center; width: 16px; height: 16px; top: auto; left: auto; position: static;"><div style="-webkit-transition: opacity 150ms ease-out; transition: opacity 150ms ease-out; background-image: url(chrome-extension://gofhjkjmkpinhpoiabjplobcaignabnl/icon_play.png); text-align: left; opacity: 0.25; border: 1px solid rgb(0, 0, 0); width: 100%; height: 100%; background-color: rgba(193, 217, 244, 0.498039); background-repeat: no-repeat no-repeat;"></div></div><embed width="16" height="16" id="highlighter_39805_clipboard" type="application/x-shockwave-flash" title="copy to clipboard" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_39805" menu="false" src="http://flowingdata.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter2/scripts/clipboard.swf" style="display: none !important;"></div><a href="http://flowingdata.com/2011/05/11/how-to-map-connections-with-great-circles/#printSource" title="print" class="item printSource" style="width: 16px; height: 16px;">print</a><a href="http://flowingdata.com/2011/05/11/how-to-map-connections-with-great-circles/#about" title="?" class="item about" style="width: 16px; height: 16px;">?</a></div></div><div class="lines"><div class="line alt1"><table><tbody><tr><td class="number"><code>1</code></td><td class="content"><code class="functions">library</code><code class="plain">(maps)</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>2</code></td><td class="content"><code class="functions">library</code><code class="plain">(geosphere)</code></td></tr></tbody></table></div></div></div>
<p>The first package <code>maps</code>, is used to draw the base maps, and the second, <code>geosphere</code> is used to draw the great circle arcs.</p>
<h2>Step 2. Draw base maps</h2>
<p>The <code>maps</code> package makes it easy to draw geographic areas in R with the <code>map()</code> function. Pass it a database name, and you you get a map in one line of code. For example, to map the United States, type the following in the R console.</p>
<div id="highlighter_303302" class="syntaxhighlighter  "><div class="bar"><div class="toolbar"><a href="http://flowingdata.com/2011/05/11/how-to-map-connections-with-great-circles/#viewSource" title="view source" class="item viewSource" style="width: 16px; height: 16px;">view source</a><div class="item copyToClipboard"><div style="display: block; cursor: pointer; text-align: center; width: 16px; height: 16px; top: auto; left: auto; position: static;"><div style="-webkit-transition: opacity 150ms ease-out; transition: opacity 150ms ease-out; background-image: url(chrome-extension://gofhjkjmkpinhpoiabjplobcaignabnl/icon_play.png); text-align: left; opacity: 0.25; border: 1px solid rgb(0, 0, 0); width: 100%; height: 100%; background-color: rgba(193, 217, 244, 0.498039); background-repeat: no-repeat no-repeat;"></div></div><embed width="16" height="16" id="highlighter_303302_clipboard" type="application/x-shockwave-flash" title="copy to clipboard" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_303302" menu="false" src="http://flowingdata.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter2/scripts/clipboard.swf" style="display: none !important;"></div><a href="http://flowingdata.com/2011/05/11/how-to-map-connections-with-great-circles/#printSource" title="print" class="item printSource" style="width: 16px; height: 16px;">print</a><a href="http://flowingdata.com/2011/05/11/how-to-map-connections-with-great-circles/#about" title="?" class="item about" style="width: 16px; height: 16px;">?</a></div></div><div class="lines"><div class="line alt1"><table><tbody><tr><td class="number"><code>1</code></td><td class="content"><code class="functions">map</code><code class="plain">(</code><code class="string">"state"</code><code class="plain">)</code></td></tr></tbody></table></div></div></div>
<p>Here's the map that you get:</p>
<p><span class="tip">Blank state map created in R. Nothing else.</span><img src="./How to map connections with great circles_files/Screen-shot-2011-05-08-at-6.28.19-PM.png" alt="Contiguous USA map" title="Screen shot 2011-05-08 at 6.28.19 PM.png" border="0" width="575" height="301" src-orig="http://i2.wp.com/flowingdata.com/wp-content/uploads/2011/05/Screen-shot-2011-05-08-at-6.28.19-PM.png?resize=575%2C301" scale="2"></p>
<p><span class="tip">2. Map projections are finicky in R and can be a pain sometimes, but if you want to map with a different projection like say, Albers, look into <code>mapproject()</code> in the <code>maps</code> package.</span>The projection isn't the prettiest thing in the world, but it'll do for now<sup>2</sup>. The bigger problem is that the <code>state</code> database doesn't include Alaska or Hawaii. To include the two often left out states, you use the <code>world</code> database.</p>
<div id="highlighter_192816" class="syntaxhighlighter  "><div class="bar"><div class="toolbar"><a href="http://flowingdata.com/2011/05/11/how-to-map-connections-with-great-circles/#viewSource" title="view source" class="item viewSource" style="width: 16px; height: 16px;">view source</a><div class="item copyToClipboard"><div style="display: block; cursor: pointer; text-align: center; width: 16px; height: 16px; top: auto; left: auto; position: static;"><div style="-webkit-transition: opacity 150ms ease-out; transition: opacity 150ms ease-out; background-image: url(chrome-extension://gofhjkjmkpinhpoiabjplobcaignabnl/icon_play.png); text-align: left; opacity: 0.25; border: 1px solid rgb(0, 0, 0); width: 100%; height: 100%; background-color: rgba(193, 217, 244, 0.498039); background-repeat: no-repeat no-repeat;"></div></div><embed width="16" height="16" id="highlighter_192816_clipboard" type="application/x-shockwave-flash" title="copy to clipboard" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_192816" menu="false" src="http://flowingdata.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter2/scripts/clipboard.swf" style="display: none !important;"></div><a href="http://flowingdata.com/2011/05/11/how-to-map-connections-with-great-circles/#printSource" title="print" class="item printSource" style="width: 16px; height: 16px;">print</a><a href="http://flowingdata.com/2011/05/11/how-to-map-connections-with-great-circles/#about" title="?" class="item about" style="width: 16px; height: 16px;">?</a></div></div><div class="lines"><div class="line alt1"><table><tbody><tr><td class="number"><code>1</code></td><td class="content"><code class="functions">map</code><code class="plain">(</code><code class="string">"world"</code><code class="plain">)</code></td></tr></tbody></table></div></div></div>
<p>This gives you a full black and white map of the world.</p>
<p><span class="tip">A blank world map is just as easy to make in R.</span><img src="./How to map connections with great circles_files/Screen-shot-2011-05-08-at-6.28.37-PM1.png" alt="Screen shot 2011 05 08 at 6 28 37 PM" title="Screen shot 2011-05-08 at 6.28.37 PM.png" border="0" width="575" height="275" src-orig="http://i1.wp.com/flowingdata.com/wp-content/uploads/2011/05/Screen-shot-2011-05-08-at-6.28.37-PM1.png?resize=575%2C275" scale="2"></p>
<h2>Step 3. Limiting boundaries</h2>
<p>The data at hand, which you'll get to soon, is only domestic flights for the United States, so you should focus on that area. Use the <code>xlim</code> and <code>ylim</code> variables to limit the map to a rectangle that only covers a range of latitude and longitude. </p>
<p>You can also play with the color of the base map at this point. By default, <code>maps()</code> doesn't fill regions, but it will if you set <code>fill</code> to <code>TRUE</code>. For some reason though, if you set the fill color, you can't change the border color. So instead (if you don't want to edit in Illustrator later) you can set the line width (<code>lwd</code>) to something really skinny. For the purpose of this example, we want the the border lines to get out of the way.</p>
<div id="highlighter_302769" class="syntaxhighlighter  "><div class="bar "><div class="toolbar"><a href="http://flowingdata.com/2011/05/11/how-to-map-connections-with-great-circles/#viewSource" title="view source" class="item viewSource" style="width: 16px; height: 16px;">view source</a><div class="item copyToClipboard"><div style="display: block; cursor: pointer; text-align: center; width: 16px; height: 16px; top: auto; left: auto; position: static;"><div style="-webkit-transition: opacity 150ms ease-out; transition: opacity 150ms ease-out; background-image: url(chrome-extension://gofhjkjmkpinhpoiabjplobcaignabnl/icon_play.png); text-align: left; opacity: 0.25; border: 1px solid rgb(0, 0, 0); width: 100%; height: 100%; background-color: rgba(193, 217, 244, 0.498039); background-repeat: no-repeat no-repeat;"></div></div><embed width="16" height="16" id="highlighter_302769_clipboard" type="application/x-shockwave-flash" title="copy to clipboard" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_302769" menu="false" src="http://flowingdata.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter2/scripts/clipboard.swf" style="display: none !important;"></div><a href="http://flowingdata.com/2011/05/11/how-to-map-connections-with-great-circles/#printSource" title="print" class="item printSource" style="width: 16px; height: 16px;">print</a><a href="http://flowingdata.com/2011/05/11/how-to-map-connections-with-great-circles/#about" title="?" class="item about" style="width: 16px; height: 16px;">?</a></div></div><div class="lines"><div class="line alt1"><table><tbody><tr><td class="number"><code>1</code></td><td class="content"><code class="plain">xlim &lt;- </code><code class="functions">c</code><code class="plain">(-171.738281, -56.601563)</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>2</code></td><td class="content"><code class="plain">ylim &lt;- </code><code class="functions">c</code><code class="plain">(12.039321, 71.856229)</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>3</code></td><td class="content"><code class="functions">map</code><code class="plain">(</code><code class="string">"world"</code><code class="plain">, col=</code><code class="string">"#f2f2f2"</code><code class="plain">, fill=</code><code class="keyword">TRUE</code><code class="plain">, bg=</code><code class="string">"white"</code><code class="plain">, lwd=0.05, xlim=xlim, ylim=ylim)</code></td></tr></tbody></table></div></div></div>
<p>And here's what you get with the above code. A simple and clean map of the United States that includes Alaska and Hawaii.</p>
<p><span class="tip">Focusing on all states. That includes Hawaii and Alaska.</span><img src="./How to map connections with great circles_files/Screen-shot-2011-05-08-at-6.29.11-PM.png" alt="Screen shot 2011 05 08 at 6 29 11 PM" title="Screen shot 2011-05-08 at 6.29.11 PM.png" border="0" width="575" height="386" src-orig="http://i2.wp.com/flowingdata.com/wp-content/uploads/2011/05/Screen-shot-2011-05-08-at-6.29.11-PM.png?resize=575%2C386" scale="2"></p>
<h2>Step 4. Draw connecting lines</h2>
<p>Now that you have a map, you can draw connecting lines. This is really easy with <code>gcIntermediate()</code> from the <code>geosphere</code> package. Pass it the latitude and longitude of the two connecting points, and <code>gcIntermediate()</code> spits out the coordinates of points on the circle. </p>
<p>The <code>n</code> argument indicates how many points you want the function to return. The more points you indicate, the smoother the resulting line will be, but up to a certain point, you won't see much difference. The <code>addStartEnd</code> argument indicates that you want to include the start and end points in the great circle coordinates. Lastly, use <code>lines()</code> to actually draw the line. </p>
<div id="highlighter_476648" class="syntaxhighlighter  "><div class="bar"><div class="toolbar"><a href="http://flowingdata.com/2011/05/11/how-to-map-connections-with-great-circles/#viewSource" title="view source" class="item viewSource" style="width: 16px; height: 16px;">view source</a><div class="item copyToClipboard"><div style="display: block; cursor: pointer; text-align: center; width: 16px; height: 16px; top: auto; left: auto; position: static;"><div style="-webkit-transition: opacity 150ms ease-out; transition: opacity 150ms ease-out; background-image: url(chrome-extension://gofhjkjmkpinhpoiabjplobcaignabnl/icon_play.png); text-align: left; opacity: 0.25; border: 1px solid rgb(0, 0, 0); width: 100%; height: 100%; background-color: rgba(193, 217, 244, 0.498039); background-repeat: no-repeat no-repeat;"></div></div><embed width="16" height="16" id="highlighter_476648_clipboard" type="application/x-shockwave-flash" title="copy to clipboard" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_476648" menu="false" src="http://flowingdata.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter2/scripts/clipboard.swf" style="display: none !important;"></div><a href="http://flowingdata.com/2011/05/11/how-to-map-connections-with-great-circles/#printSource" title="print" class="item printSource" style="width: 16px; height: 16px;">print</a><a href="http://flowingdata.com/2011/05/11/how-to-map-connections-with-great-circles/#about" title="?" class="item about" style="width: 16px; height: 16px;">?</a></div></div><div class="lines"><div class="line alt1"><table><tbody><tr><td class="number"><code>1</code></td><td class="content"><code class="plain">lat_ca &lt;- 39.164141</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>2</code></td><td class="content"><code class="plain">lon_ca &lt;- -121.640625</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>3</code></td><td class="content"><code class="plain">lat_me &lt;- 45.213004</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>4</code></td><td class="content"><code class="plain">lon_me &lt;- -68.906250</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>5</code></td><td class="content"><code class="plain">inter &lt;- </code><code class="functions">gcIntermediate</code><code class="plain">(</code><code class="functions">c</code><code class="plain">(lon_ca, lat_ca), </code><code class="functions">c</code><code class="plain">(lon_me, lat_me), n=50, addStartEnd=</code><code class="keyword">TRUE</code><code class="plain">)</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>6</code></td><td class="content"><code class="functions">lines</code><code class="plain">(inter)</code></td></tr></tbody></table></div></div></div>
<p>This draws a great circle arc from California to Maine.</p>
<p><span class="tip">A single connection.</span><img src="./How to map connections with great circles_files/1-single-connection1.jpg" alt="1 single connection" title="1-single-connection.jpg" border="0" width="575" height="391" src-orig="http://i0.wp.com/flowingdata.com/wp-content/uploads/2011/05/1-single-connection1.jpg?resize=575%2C391" scale="2"></p>
<p>Similarly, you can add another line simply by doing the same as above with different latitude and longitude coordinates. For example, you can draw a line from California to Texas, and you can use the <code>col</code> argument to set the line color to red.</p>
<div id="highlighter_705098" class="syntaxhighlighter  "><div class="bar"><div class="toolbar"><a href="http://flowingdata.com/2011/05/11/how-to-map-connections-with-great-circles/#viewSource" title="view source" class="item viewSource" style="width: 16px; height: 16px;">view source</a><div class="item copyToClipboard"><div style="display: block; cursor: pointer; text-align: center; width: 16px; height: 16px; top: auto; left: auto; position: static;"><div style="-webkit-transition: opacity 150ms ease-out; transition: opacity 150ms ease-out; background-image: url(chrome-extension://gofhjkjmkpinhpoiabjplobcaignabnl/icon_play.png); text-align: left; opacity: 0.25; border: 1px solid rgb(0, 0, 0); width: 100%; height: 100%; background-color: rgba(193, 217, 244, 0.498039); background-repeat: no-repeat no-repeat;"></div></div><embed width="16" height="16" id="highlighter_705098_clipboard" type="application/x-shockwave-flash" title="copy to clipboard" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_705098" menu="false" src="http://flowingdata.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter2/scripts/clipboard.swf" style="display: none !important;"></div><a href="http://flowingdata.com/2011/05/11/how-to-map-connections-with-great-circles/#printSource" title="print" class="item printSource" style="width: 16px; height: 16px;">print</a><a href="http://flowingdata.com/2011/05/11/how-to-map-connections-with-great-circles/#about" title="?" class="item about" style="width: 16px; height: 16px;">?</a></div></div><div class="lines"><div class="line alt1"><table><tbody><tr><td class="number"><code>1</code></td><td class="content"><code class="plain">lat_tx &lt;- 29.954935</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>2</code></td><td class="content"><code class="plain">lon_tx &lt;- -98.701172</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>3</code></td><td class="content"><code class="plain">inter2 &lt;- </code><code class="functions">gcIntermediate</code><code class="plain">(</code><code class="functions">c</code><code class="plain">(lon_ca, lat_ca), </code><code class="functions">c</code><code class="plain">(lon_tx, lat_tx), n=50, addStartEnd=</code><code class="keyword">TRUE</code><code class="plain">) </code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>4</code></td><td class="content"><code class="functions">lines</code><code class="plain">(inter2, col=</code><code class="string">"red"</code><code class="plain">)</code></td></tr></tbody></table></div></div></div>
<p><span class="tip">Okay, now let's do two connections.</span><img src="./How to map connections with great circles_files/2-addtl-connection1.jpg" alt="2 addtl connection" title="2-addtl-connection.jpg" border="0" width="575" height="393" src-orig="http://i0.wp.com/flowingdata.com/wp-content/uploads/2011/05/2-addtl-connection1.jpg?resize=575%2C393" scale="2"></p>
<h2>Step 5. Load flight data</h2>
<p>So now you know how to do the hard part. You just have to iterate over latitude and longitude pairs to get the full map for a specific carrier. Start by loading the data with <code>read.csv()</code>, as shown below:</p>
<div id="highlighter_304291" class="syntaxhighlighter  "><div class="bar"><div class="toolbar"><a href="http://flowingdata.com/2011/05/11/how-to-map-connections-with-great-circles/#viewSource" title="view source" class="item viewSource" style="width: 16px; height: 16px;">view source</a><div class="item copyToClipboard"><div style="display: block; cursor: pointer; text-align: center; width: 16px; height: 16px; top: auto; left: auto; position: static;"><div style="-webkit-transition: opacity 150ms ease-out; transition: opacity 150ms ease-out; background-image: url(chrome-extension://gofhjkjmkpinhpoiabjplobcaignabnl/icon_play.png); text-align: left; opacity: 0.25; border: 1px solid rgb(0, 0, 0); width: 100%; height: 100%; background-color: rgba(193, 217, 244, 0.498039); background-repeat: no-repeat no-repeat;"></div></div><embed width="16" height="16" id="highlighter_304291_clipboard" type="application/x-shockwave-flash" title="copy to clipboard" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_304291" menu="false" src="http://flowingdata.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter2/scripts/clipboard.swf" style="display: none !important;"></div><a href="http://flowingdata.com/2011/05/11/how-to-map-connections-with-great-circles/#printSource" title="print" class="item printSource" style="width: 16px; height: 16px;">print</a><a href="http://flowingdata.com/2011/05/11/how-to-map-connections-with-great-circles/#about" title="?" class="item about" style="width: 16px; height: 16px;">?</a></div></div><div class="lines"><div class="line alt1"><table><tbody><tr><td class="number"><code>1</code></td><td class="content"><code class="plain">airports &lt;- </code><code class="functions">read.csv</code><code class="plain">(</code><code class="string">"<a href="http://datasets.flowingdata.com/tuts/maparcs/airports.csv">http://datasets.flowingdata.com/tuts/maparcs/airports.csv</a>"</code><code class="plain">, header=</code><code class="keyword">TRUE</code><code class="plain">) flights &lt;- </code><code class="functions">read.csv</code><code class="plain">(</code><code class="string">"<a href="http://datasets.flowingdata.com/tuts/maparcs/flights.csv">http://datasets.flowingdata.com/tuts/maparcs/flights.csv</a>"</code><code class="plain">, header=</code><code class="keyword">TRUE</code><code class="plain">, as.is=</code><code class="keyword">TRUE</code><code class="plain">)</code></td></tr></tbody></table></div></div></div>
<p><span class="tip">3. I used a five-line Python script to aggregate data that I downloaded from the <a href="http://transtats.bts.gov/Tables.asp?DB_ID=120&DB_Name=Airline%20On-Time%20Performance%20Data&DB_Short_Name=On-Time">Bureau of Transportation Statistics</a>. The original file was about 50mb. You can aggregate in R, but it's usually a better idea to not load large-ish files in R. Luckily airport latitude and longitude coordinates were available on the page for <a href="http://stat-computing.org/dataexpo/2009/">Data Expo 2009</a>. Otherwise, I would've geocoded them myself, which I started to do and then got stalled by API limits.</span>This is processed data that I cleaned up for this tutorial. It's flight counts between each airport, categorized by airline<sup>3</sup>.</p>
<h2>Step 6. Draw multiple connections</h2>
<p>Data in. To map all connections for say, American Airlines, you filter as shown in line 3. Then you loop over each row of data, which has latitude/longitude for two two airports and the number of flights between them.</p>
<div id="highlighter_501862" class="syntaxhighlighter  "><div class="bar"><div class="toolbar"><a href="http://flowingdata.com/2011/05/11/how-to-map-connections-with-great-circles/#viewSource" title="view source" class="item viewSource" style="width: 16px; height: 16px;">view source</a><div class="item copyToClipboard"><div style="display: block; cursor: pointer; text-align: center; width: 16px; height: 16px; top: auto; left: auto; position: static;"><div style="-webkit-transition: opacity 150ms ease-out; transition: opacity 150ms ease-out; background-image: url(chrome-extension://gofhjkjmkpinhpoiabjplobcaignabnl/icon_play.png); text-align: left; opacity: 0.25; border: 1px solid rgb(0, 0, 0); width: 100%; height: 100%; background-color: rgba(193, 217, 244, 0.498039); background-repeat: no-repeat no-repeat;"></div></div><embed width="16" height="16" id="highlighter_501862_clipboard" type="application/x-shockwave-flash" title="copy to clipboard" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_501862" menu="false" src="http://flowingdata.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter2/scripts/clipboard.swf" style="display: none !important;"></div><a href="http://flowingdata.com/2011/05/11/how-to-map-connections-with-great-circles/#printSource" title="print" class="item printSource" style="width: 16px; height: 16px;">print</a><a href="http://flowingdata.com/2011/05/11/how-to-map-connections-with-great-circles/#about" title="?" class="item about" style="width: 16px; height: 16px;">?</a></div></div><div class="lines"><div class="line alt1"><table><tbody><tr><td class="number"><code>1</code></td><td class="content"><code class="functions">map</code><code class="plain">(</code><code class="string">"world"</code><code class="plain">, col=</code><code class="string">"#f2f2f2"</code><code class="plain">, fill=</code><code class="keyword">TRUE</code><code class="plain">, bg=</code><code class="string">"white"</code><code class="plain">, lwd=0.05, xlim=xlim, ylim=ylim)</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>2</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>3</code></td><td class="content"><code class="plain">fsub &lt;- flights[flights$airline == </code><code class="string">"AA"</code><code class="plain">,]</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>4</code></td><td class="content"><code class="functions">for </code><code class="plain">(j </code><code class="keyword">in</code> <code class="plain">1:</code><code class="functions">length</code><code class="plain">(fsub$airline)) {</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>5</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">air1 &lt;- airports[airports$iata == fsub[j,]$airport1,]</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>6</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">air2 &lt;- airports[airports$iata == fsub[j,]$airport2,]</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>7</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>8</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">inter &lt;- </code><code class="functions">gcIntermediate</code><code class="plain">(</code><code class="functions">c</code><code class="plain">(air1[1,]$long, air1[1,]$lat), </code><code class="functions">c</code><code class="plain">(air2[1,]$long, air2[1,]$lat), n=100, addStartEnd=</code><code class="keyword">TRUE</code><code class="plain">)</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>9</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>10</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="functions">lines</code><code class="plain">(inter, col=</code><code class="string">"black"</code><code class="plain">, lwd=0.8)</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>11</code></td><td class="content"><code class="plain">}</code></td></tr></tbody></table></div></div></div>
<p>Here's the mess of black lines that you get from the above code.</p>
<p><span class="tip">Rough image of American Airlines flights.</span><img src="./How to map connections with great circles_files/3b-solid.jpg" alt="3b solid" title="3b-solid.jpg" border="0" width="575" height="390" src-orig="http://i0.wp.com/flowingdata.com/wp-content/uploads/2011/05/3b-solid.jpg?resize=575%2C390" scale="2"></p>
<p>Not bad, but you can do better than that with some rearranging and coloring appropriately. </p>
<h2>Step 7. Color for clarity</h2>
<p>You learned how to change the color of lines back in step 4. You change the <code>col</code> argument in <code>lines()</code>. You hard-coded the color though. You could instead create a vector of colors that scaled from, say, light gray to black, and then pick a shade from farther down the vector for connections with more flights. That way connections with more flights would be more prominent.</p>
<p>If only there were a way to create a color scale automagically. Oh wait, there is. It's called <code>colorRampPalette()</code>. Pass it the base colors you want to use, and it'll fill in everything in between. More specifically, it creates a function that you can pass a number two, indicating how many shades you want to use. In the code below, we use 100 (lines 1 and 2).</p>
<p>Then you do the same as you did the previous step, but instead of setting all lines to black, you calculate the color based on how many fewer flights the current connection has compared to the maximum flight count. </p>
<div id="highlighter_601349" class="syntaxhighlighter  "><div class="bar"><div class="toolbar"><a href="http://flowingdata.com/2011/05/11/how-to-map-connections-with-great-circles/#viewSource" title="view source" class="item viewSource" style="width: 16px; height: 16px;">view source</a><div class="item copyToClipboard"><div style="display: block; cursor: pointer; text-align: center; width: 16px; height: 16px; top: auto; left: auto; position: static;"><div style="-webkit-transition: opacity 150ms ease-out; transition: opacity 150ms ease-out; background-image: url(chrome-extension://gofhjkjmkpinhpoiabjplobcaignabnl/icon_play.png); text-align: left; opacity: 0.25; border: 1px solid rgb(0, 0, 0); width: 100%; height: 100%; background-color: rgba(193, 217, 244, 0.498039); background-repeat: no-repeat no-repeat;"></div></div><embed width="16" height="16" id="highlighter_601349_clipboard" type="application/x-shockwave-flash" title="copy to clipboard" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_601349" menu="false" src="http://flowingdata.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter2/scripts/clipboard.swf" style="display: none !important;"></div><a href="http://flowingdata.com/2011/05/11/how-to-map-connections-with-great-circles/#printSource" title="print" class="item printSource" style="width: 16px; height: 16px;">print</a><a href="http://flowingdata.com/2011/05/11/how-to-map-connections-with-great-circles/#about" title="?" class="item about" style="width: 16px; height: 16px;">?</a></div></div><div class="lines"><div class="line alt1"><table><tbody><tr><td class="number"><code>1</code></td><td class="content"><code class="plain">pal &lt;- </code><code class="functions">colorRampPalette</code><code class="plain">(</code><code class="functions">c</code><code class="plain">(</code><code class="string">"#f2f2f2"</code><code class="plain">, </code><code class="string">"black"</code><code class="plain">))</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>2</code></td><td class="content"><code class="plain">colors &lt;- </code><code class="functions">pal</code><code class="plain">(100)</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>3</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>4</code></td><td class="content"><code class="functions">map</code><code class="plain">(</code><code class="string">"world"</code><code class="plain">, col=</code><code class="string">"#f2f2f2"</code><code class="plain">, fill=</code><code class="keyword">TRUE</code><code class="plain">, bg=</code><code class="string">"white"</code><code class="plain">, lwd=0.05, xlim=xlim, ylim=ylim)</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>5</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>6</code></td><td class="content"><code class="plain">fsub &lt;- flights[flights$airline == </code><code class="string">"AA"</code><code class="plain">,]</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>7</code></td><td class="content"><code class="plain">maxcnt &lt;- </code><code class="functions">max</code><code class="plain">(fsub$cnt)</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>8</code></td><td class="content"><code class="functions">for </code><code class="plain">(j </code><code class="keyword">in</code> <code class="plain">1:</code><code class="functions">length</code><code class="plain">(fsub$airline)) {</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>9</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">air1 &lt;- airports[airports$iata == fsub[j,]$airport1,]</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>10</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">air2 &lt;- airports[airports$iata == fsub[j,]$airport2,]</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>11</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>12</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">inter &lt;- </code><code class="functions">gcIntermediate</code><code class="plain">(</code><code class="functions">c</code><code class="plain">(air1[1,]$long, air1[1,]$lat), </code><code class="functions">c</code><code class="plain">(air2[1,]$long, air2[1,]$lat), n=100, addStartEnd=</code><code class="keyword">TRUE</code><code class="plain">)</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>13</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">colindex &lt;- </code><code class="functions">round</code><code class="plain">( (fsub[j,]$cnt / maxcnt) * </code><code class="functions">length</code><code class="plain">(colors) )</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>14</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>15</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="functions">lines</code><code class="plain">(inter, col=colors[colindex], lwd=0.8)</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>16</code></td><td class="content"><code class="plain">}</code></td></tr></tbody></table></div></div></div>
<p>Below is the map that you get. The problem is the longer, less prominent flights are obscuring the more popular connections, because they're being drawn on top. The above code just draws lines in the order that the data comes.</p>
<p><span class="tip">Use color to emphasize more prominent flights.</span><img src="./How to map connections with great circles_files/3a-connection.jpg" alt="3a connection" title="3a-connection.jpg" border="0" width="575" height="391" src-orig="http://i2.wp.com/flowingdata.com/wp-content/uploads/2011/05/3a-connection.jpg?resize=575%2C391" scale="2"></p>
<p>To fix this we use the <a href="http://paulbutler.org/archives/visualizing-facebook-friends/">same method</a> that Paul Butler used for his Facebook map. We just order connection from least to greatest flight counts. That way less popular connections are drawn first and therefore, will be on the bottom, while the darker connections will be drawn on top.</p>
<div id="highlighter_587965" class="syntaxhighlighter  "><div class="bar"><div class="toolbar"><a href="http://flowingdata.com/2011/05/11/how-to-map-connections-with-great-circles/#viewSource" title="view source" class="item viewSource" style="width: 16px; height: 16px;">view source</a><div class="item copyToClipboard"><div style="display: block; cursor: pointer; text-align: center; width: 16px; height: 16px; top: auto; left: auto; position: static;"><div style="-webkit-transition: opacity 150ms ease-out; transition: opacity 150ms ease-out; background-image: url(chrome-extension://gofhjkjmkpinhpoiabjplobcaignabnl/icon_play.png); text-align: left; opacity: 0.25; border: 1px solid rgb(0, 0, 0); width: 100%; height: 100%; background-color: rgba(193, 217, 244, 0.498039); background-repeat: no-repeat no-repeat;"></div></div><embed width="16" height="16" id="highlighter_587965_clipboard" type="application/x-shockwave-flash" title="copy to clipboard" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_587965" menu="false" src="http://flowingdata.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter2/scripts/clipboard.swf" style="display: none !important;"></div><a href="http://flowingdata.com/2011/05/11/how-to-map-connections-with-great-circles/#printSource" title="print" class="item printSource" style="width: 16px; height: 16px;">print</a><a href="http://flowingdata.com/2011/05/11/how-to-map-connections-with-great-circles/#about" title="?" class="item about" style="width: 16px; height: 16px;">?</a></div></div><div class="lines"><div class="line alt1"><table><tbody><tr><td class="number"><code>1</code></td><td class="content"><code class="plain">pal &lt;- </code><code class="functions">colorRampPalette</code><code class="plain">(</code><code class="functions">c</code><code class="plain">(</code><code class="string">"#f2f2f2"</code><code class="plain">, </code><code class="string">"black"</code><code class="plain">))</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>2</code></td><td class="content"><code class="plain">pal &lt;- </code><code class="functions">colorRampPalette</code><code class="plain">(</code><code class="functions">c</code><code class="plain">(</code><code class="string">"#f2f2f2"</code><code class="plain">, </code><code class="string">"red"</code><code class="plain">))</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>3</code></td><td class="content"><code class="plain">colors &lt;- </code><code class="functions">pal</code><code class="plain">(100)</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>4</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>5</code></td><td class="content"><code class="functions">map</code><code class="plain">(</code><code class="string">"world"</code><code class="plain">, col=</code><code class="string">"#f2f2f2"</code><code class="plain">, fill=</code><code class="keyword">TRUE</code><code class="plain">, bg=</code><code class="string">"white"</code><code class="plain">, lwd=0.05, xlim=xlim, ylim=ylim)</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>6</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>7</code></td><td class="content"><code class="plain">fsub &lt;- flights[flights$airline == </code><code class="string">"AA"</code><code class="plain">,]</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>8</code></td><td class="content"><code class="plain">fsub &lt;- fsub[</code><code class="functions">order</code><code class="plain">(fsub$cnt),]</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>9</code></td><td class="content"><code class="plain">maxcnt &lt;- </code><code class="functions">max</code><code class="plain">(fsub$cnt)</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>10</code></td><td class="content"><code class="functions">for </code><code class="plain">(j </code><code class="keyword">in</code> <code class="plain">1:</code><code class="functions">length</code><code class="plain">(fsub$airline)) {</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>11</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">air1 &lt;- airports[airports$iata == fsub[j,]$airport1,]</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>12</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">air2 &lt;- airports[airports$iata == fsub[j,]$airport2,]</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>13</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>14</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">inter &lt;- </code><code class="functions">gcIntermediate</code><code class="plain">(</code><code class="functions">c</code><code class="plain">(air1[1,]$long, air1[1,]$lat), </code><code class="functions">c</code><code class="plain">(air2[1,]$long, air2[1,]$lat), n=100, addStartEnd=</code><code class="keyword">TRUE</code><code class="plain">)</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>15</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">colindex &lt;- </code><code class="functions">round</code><code class="plain">( (fsub[j,]$cnt / maxcnt) * </code><code class="functions">length</code><code class="plain">(colors) )</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>16</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>17</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="functions">lines</code><code class="plain">(inter, col=colors[colindex], lwd=0.8)</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>18</code></td><td class="content"><code class="plain">}</code></td></tr></tbody></table></div></div></div>
<p><span class="tip">Layer dark on top of light so that it's easier to read.</span><img src="./How to map connections with great circles_files/3-airline1.jpg" alt="3 airline" title="3-airline.jpg" border="0" width="575" height="393" src-orig="http://i1.wp.com/flowingdata.com/wp-content/uploads/2011/05/3-airline1.jpg?resize=575%2C393" scale="2"></p>
<p>That's much better. At this point, you can play around with color, by changing the shades in <code>colorRampPalette()</code>. Below uses a light gray (#f2f2f2) to red, but you can do whatever you like. You can even use more than two colors.</p>
<div id="highlighter_808353" class="syntaxhighlighter  "><div class="bar"><div class="toolbar"><a href="http://flowingdata.com/2011/05/11/how-to-map-connections-with-great-circles/#viewSource" title="view source" class="item viewSource" style="width: 16px; height: 16px;">view source</a><div class="item copyToClipboard"><div style="display: block; cursor: pointer; text-align: center; width: 16px; height: 16px; top: auto; left: auto; position: static;"><div style="-webkit-transition: opacity 150ms ease-out; transition: opacity 150ms ease-out; background-image: url(chrome-extension://gofhjkjmkpinhpoiabjplobcaignabnl/icon_play.png); text-align: left; opacity: 0.25; border: 1px solid rgb(0, 0, 0); width: 100%; height: 100%; background-color: rgba(193, 217, 244, 0.498039); background-repeat: no-repeat no-repeat;"></div></div><embed width="16" height="16" id="highlighter_808353_clipboard" type="application/x-shockwave-flash" title="copy to clipboard" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_808353" menu="false" src="http://flowingdata.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter2/scripts/clipboard.swf" style="display: none !important;"></div><a href="http://flowingdata.com/2011/05/11/how-to-map-connections-with-great-circles/#printSource" title="print" class="item printSource" style="width: 16px; height: 16px;">print</a><a href="http://flowingdata.com/2011/05/11/how-to-map-connections-with-great-circles/#about" title="?" class="item about" style="width: 16px; height: 16px;">?</a></div></div><div class="lines"><div class="line alt1"><table><tbody><tr><td class="number"><code>1</code></td><td class="content"><code class="plain">pal &lt;- </code><code class="functions">colorRampPalette</code><code class="plain">(</code><code class="functions">c</code><code class="plain">(</code><code class="string">"#f2f2f2"</code><code class="plain">, </code><code class="string">"red"</code><code class="plain">))</code></td></tr></tbody></table></div></div></div>
<p><span class="tip">Red? Sure, you can do that, too.</span><img src="./How to map connections with great circles_files/4-airline-color(1).jpg" alt="4 airline color" title="4-airline-color.jpg" border="0" width="575" height="390" src-orig="http://i1.wp.com/flowingdata.com/wp-content/uploads/2011/05/4-airline-color.jpg?resize=575%2C390" scale="2"></p>
<h2>Step 8. Map every carrier</h2>
<p>The only thing left to do is make a map for each carrier. You can do it manually by changing the airline code and the rerunning the script, but there's an easier way. Find all unique carriers with the <code>unique()</code> function, and iterate over each one. The place that you put "AA" you replace with <code>carriers[i]</code> to indicate the current carrier in the loop. The code below will create a PDF for each carrier and save to your current working directory.</p>
<div id="highlighter_136338" class="syntaxhighlighter  "><div class="bar"><div class="toolbar"><a href="http://flowingdata.com/2011/05/11/how-to-map-connections-with-great-circles/#viewSource" title="view source" class="item viewSource" style="width: 16px; height: 16px;">view source</a><div class="item copyToClipboard"><div style="display: block; cursor: pointer; text-align: center; width: 16px; height: 16px; top: auto; left: auto; position: static;"><div style="-webkit-transition: opacity 150ms ease-out; transition: opacity 150ms ease-out; background-image: url(chrome-extension://gofhjkjmkpinhpoiabjplobcaignabnl/icon_play.png); text-align: left; opacity: 0.25; border: 1px solid rgb(0, 0, 0); width: 100%; height: 100%; background-color: rgba(193, 217, 244, 0.498039); background-repeat: no-repeat no-repeat;"></div></div><embed width="16" height="16" id="highlighter_136338_clipboard" type="application/x-shockwave-flash" title="copy to clipboard" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_136338" menu="false" src="http://flowingdata.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter2/scripts/clipboard.swf" style="display: none !important;"></div><a href="http://flowingdata.com/2011/05/11/how-to-map-connections-with-great-circles/#printSource" title="print" class="item printSource" style="width: 16px; height: 16px;">print</a><a href="http://flowingdata.com/2011/05/11/how-to-map-connections-with-great-circles/#about" title="?" class="item about" style="width: 16px; height: 16px;">?</a></div></div><div class="lines"><div class="line alt1"><table><tbody><tr><td class="number"><code>1</code></td><td class="content"><code class="comments"># Unique carriers</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>2</code></td><td class="content"><code class="plain">carriers &lt;- </code><code class="functions">unique</code><code class="plain">(flights$airline)</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>3</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>4</code></td><td class="content"><code class="comments"># Color</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>5</code></td><td class="content"><code class="plain">pal &lt;- </code><code class="functions">colorRampPalette</code><code class="plain">(</code><code class="functions">c</code><code class="plain">(</code><code class="string">"#333333"</code><code class="plain">, </code><code class="string">"white"</code><code class="plain">, </code><code class="string">"#1292db"</code><code class="plain">))</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>6</code></td><td class="content"><code class="plain">colors &lt;- </code><code class="functions">pal</code><code class="plain">(100)</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>7</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>8</code></td><td class="content"><code class="functions">for </code><code class="plain">(i </code><code class="keyword">in</code> <code class="plain">1:</code><code class="functions">length</code><code class="plain">(carriers)) {</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>9</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>10</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="functions">pdf</code><code class="plain">(</code><code class="functions">paste</code><code class="plain">(</code><code class="string">"carrier"</code><code class="plain">, carriers[i], </code><code class="string">".pdf"</code><code class="plain">, sep=</code><code class="string">""</code><code class="plain">), width=11, height=7)</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>11</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="functions">map</code><code class="plain">(</code><code class="string">"world"</code><code class="plain">, col=</code><code class="string">"#191919"</code><code class="plain">, fill=</code><code class="keyword">TRUE</code><code class="plain">, bg=</code><code class="string">"#000000"</code><code class="plain">, lwd=0.05, xlim=xlim, ylim=ylim)</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>12</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">fsub &lt;- flights[flights$airline == carriers[i],]</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>13</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">fsub &lt;- fsub[</code><code class="functions">order</code><code class="plain">(fsub$cnt),]</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>14</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">maxcnt &lt;- </code><code class="functions">max</code><code class="plain">(fsub$cnt)</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>15</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="functions">for </code><code class="plain">(j </code><code class="keyword">in</code> <code class="plain">1:</code><code class="functions">length</code><code class="plain">(fsub$airline)) {</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>16</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">air1 &lt;- airports[airports$iata == fsub[j,]$airport1,]</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>17</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">air2 &lt;- airports[airports$iata == fsub[j,]$airport2,]</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>18</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>19</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">inter &lt;- </code><code class="functions">gcIntermediate</code><code class="plain">(</code><code class="functions">c</code><code class="plain">(air1[1,]$long, air1[1,]$lat), </code><code class="functions">c</code><code class="plain">(air2[1,]$long, air2[1,]$lat), n=100, addStartEnd=</code><code class="keyword">TRUE</code><code class="plain">)</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>20</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">colindex &lt;- </code><code class="functions">round</code><code class="plain">( (fsub[j,]$cnt / maxcnt) * </code><code class="functions">length</code><code class="plain">(colors) )</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>21</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>22</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="functions">lines</code><code class="plain">(inter, col=colors[colindex], lwd=0.6)</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>23</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>24</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>25</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="functions">dev.off</code><code class="plain">()</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>26</code></td><td class="content"><code class="plain">}</code></td></tr></tbody></table></div></div></div>
<p>Here is the map for American Airlines again, produced by the code above. I fiddled with color some to match the maps I created for the <a href="http://flowingdata.com/2011/05/05/where-do-major-airlines-fly-in-the-united-states/">original flight post</a>.</p>
<p><span class="tip">A dark map background with gray to white to blue paths.</span><img src="./How to map connections with great circles_files/5-black-theme1.jpg" alt="5 black theme" title="5-black-theme.jpg" border="0" width="575" height="389" src-orig="http://i0.wp.com/flowingdata.com/wp-content/uploads/2011/05/5-black-theme1.jpg?resize=575%2C389" scale="2"></p>
<p>That's all there is to it. Can you think of other datasets this method could be applied to? Give this tutorial a whirl and post your results in the comments. </p>
<p>For more examples, guidance, and all-around data goodness like this, <a href="http://flowingdata.com/membership/">sign up for FlowingData membership</a>.</p>
<div class="clear-line"></div>
</div> 
</div> 
<div class="clear-line"></div>
<div id="end"></div>
 
<span id="comments"></span>
<div style="width:625px">
<div id="comments-block">
<h2>48 Comments</h2>
<ul class="commentlist">
<li class="comment even thread-even depth-1" id="li-comment-73414">
<div id="comment-73414" class="">
<div class="avatar">
<img alt="" src="./How to map connections with great circles_files/d4907dbd58e4f53c687903f045b3afe3" class="avatar avatar-50 photo" height="50" width="50" originals="50" src-orig="http://1.gravatar.com/avatar/d4907dbd58e4f53c687903f045b3afe3?s=50&amp;d=http%3A%2F%2Fflowingdata.com%2Fwp-content%2Fthemes%2Fflowingdata-4-8%2Fimages%2Fblank-square.png%3Fs%3D50&amp;r=PG" scale="2"> </div> 
<div class="comment-content">
<div class="comment-author vcard">
<cite class="fn"><a href="http://spatialanalysis.co.uk/" rel="external nofollow" class="url">James Cheshire</a></cite> <span class="comment-meta">â <a href="http://flowingdata.com/2011/05/11/how-to-map-connections-with-great-circles/#comment-73414">May 11, 2011 at 2:32 am</a>
</span>
</div>
<div class="comment-text"><p>Great tutorial! I used the same methods a while back to produce these migration maps:</p>
<p><a href="http://spatial.ly/dF9RWR" rel="nofollow">http://spatial.ly/dF9RWR</a></p>
</div>
<div class="reply">
</div>
</div> 
<div class="clear-line"></div>
</div>
</li> 
<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-73420">
<div id="comment-73420" class="">
<div class="avatar">
<img alt="" src="./How to map connections with great circles_files/7345df4ec65976a6bab8650791cf5247" class="avatar avatar-50 photo" height="50" width="50" originals="50" src-orig="http://1.gravatar.com/avatar/7345df4ec65976a6bab8650791cf5247?s=50&amp;d=http%3A%2F%2Fflowingdata.com%2Fwp-content%2Fthemes%2Fflowingdata-4-8%2Fimages%2Fblank-square.png%3Fs%3D50&amp;r=PG" scale="2"> </div> 
<div class="comment-content">
<div class="comment-author vcard">
<cite class="fn">Chanchal</cite> <span class="comment-meta">â <a href="http://flowingdata.com/2011/05/11/how-to-map-connections-with-great-circles/#comment-73420">May 11, 2011 at 3:45 am</a>
</span>
</div>
<div class="comment-text"><p>Thanks Nathan! Great tutorial!</p>
</div>
<div class="reply">
</div>
</div> 
<div class="clear-line"></div>
</div>
</li> 
<li class="comment even thread-even depth-1" id="li-comment-73423">
<div id="comment-73423" class="">
<div class="avatar">
<img alt="" src="./How to map connections with great circles_files/6362b62f5e00c37155ce5ebbc954ae1f" class="avatar avatar-50 photo" height="50" width="50" originals="50" src-orig="http://0.gravatar.com/avatar/6362b62f5e00c37155ce5ebbc954ae1f?s=50&amp;d=http%3A%2F%2Fflowingdata.com%2Fwp-content%2Fthemes%2Fflowingdata-4-8%2Fimages%2Fblank-square.png%3Fs%3D50&amp;r=PG" scale="2"> </div> 
<div class="comment-content">
<div class="comment-author vcard">
<cite class="fn"><a href="http://lookingatdata.blogspot.com/" rel="external nofollow" class="url">MÃ¥ns</a></cite> <span class="comment-meta">â <a href="http://flowingdata.com/2011/05/11/how-to-map-connections-with-great-circles/#comment-73423">May 11, 2011 at 4:36 am</a>
</span>
</div>
<div class="comment-text"><p>Great stuff! This will definitely come in handy in my teaching. Thereâs a html-misprint in the code in step 3: it says âxlim &lt;-â instead of âxlim &lt;-" (and the same for ylim).</p>
</div>
<div class="reply">
</div>
</div> 
<div class="clear-line"></div>
</div>
<ul class="children">
<li class="comment byuser comment-author-nathany bypostauthor odd alt depth-2" id="li-comment-73443">
<div id="comment-73443" class="flowingdata-author">
<div class="avatar">
<img alt="" src="./How to map connections with great circles_files/2c4874805030568a3b6714cd79d46c73" class="avatar avatar-50 photo" height="50" width="50" originals="50" src-orig="http://0.gravatar.com/avatar/2c4874805030568a3b6714cd79d46c73?s=50&amp;d=http%3A%2F%2Fflowingdata.com%2Fwp-content%2Fthemes%2Fflowingdata-4-8%2Fimages%2Fblank-square.png%3Fs%3D50&amp;r=PG" scale="2"> </div> 
<div class="comment-content">
<div class="comment-author vcard">
<cite class="fn"><a href="http://flowingdata.com/about-nathan" rel="external nofollow" class="url">Nathan Yau</a></cite> <span class="comment-meta">â <a href="http://flowingdata.com/2011/05/11/how-to-map-connections-with-great-circles/#comment-73443">May 11, 2011 at 8:31 am</a>
</span>
</div>
<div class="comment-text"><p>@MÃ¥ns â Thanks, fixed.</p>
</div>
<div class="reply">
</div>
</div> 
<div class="clear-line"></div>
</div>
</li> 
</ul> 
</li> 
<li class="comment even thread-odd thread-alt depth-1" id="li-comment-73427">
<div id="comment-73427" class="">
<div class="avatar">
<img alt="" src="./How to map connections with great circles_files/074dc5972971458a5a6fe6649599a896" class="avatar avatar-50 photo" height="50" width="50" originals="50" src-orig="http://0.gravatar.com/avatar/074dc5972971458a5a6fe6649599a896?s=50&amp;d=http%3A%2F%2Fflowingdata.com%2Fwp-content%2Fthemes%2Fflowingdata-4-8%2Fimages%2Fblank-square.png%3Fs%3D50&amp;r=PG" scale="2"> </div> 
<div class="comment-content">
<div class="comment-author vcard">
<cite class="fn"><a href="http://www.bgoncalves.com/" rel="external nofollow" class="url">Bruno GonÃ§alves</a></cite> <span class="comment-meta">â <a href="http://flowingdata.com/2011/05/11/how-to-map-connections-with-great-circles/#comment-73427">May 11, 2011 at 4:53 am</a>
</span>
</div>
<div class="comment-text"><p>Great job on the tutorial. It would have saved me a lot of time when I was playing around with similar plots sometime ago. </p>
<p>You might also want to mention that gcIntermediate() works pretty well in this case, but you can run into problems with longer paths. For example, if you use it to plot an edge from Australia to the US it will follow the shortest path, which means it will go East from Australia until the date line, break the line and come back heading East from Hawaii to the mainland US. The best way I found of making the line go West (across Africa and Europe) was to use greatCircle() and choose which path to plot, (the longest or the shortest).</p>
<p>I came across this problem when trying to plot a global citation network a couple of months ago. With gcIntermediate() you would have a lot of âwhiskersâ sticking out of the image on the left and right edges.<br>
You can see the resulting animation here: <a href="http://mobs.soic.indiana.edu/uncategorized/visualizing-embryology-science-the-last-20-years" rel="nofollow">http://mobs.soic.indiana.edu/u.....t-20-years</a></p>
<p>Completely done in R, except for the intro/outro done in iMovie and background image.<br>
Each edge is plotted with a green to red gradient to indicate direction and i used rasterImage() to load a photoshop for the background.</p>
</div>
<div class="reply">
</div>
</div> 
<div class="clear-line"></div>
</div>
<ul class="children">
<li class="comment byuser comment-author-nathany bypostauthor odd alt depth-2" id="li-comment-73444">
<div id="comment-73444" class="flowingdata-author">
<div class="avatar">
<img alt="" src="./How to map connections with great circles_files/2c4874805030568a3b6714cd79d46c73" class="avatar avatar-50 photo" height="50" width="50" originals="50" src-orig="http://0.gravatar.com/avatar/2c4874805030568a3b6714cd79d46c73?s=50&amp;d=http%3A%2F%2Fflowingdata.com%2Fwp-content%2Fthemes%2Fflowingdata-4-8%2Fimages%2Fblank-square.png%3Fs%3D50&amp;r=PG" scale="2"> </div> 
<div class="comment-content">
<div class="comment-author vcard">
<cite class="fn"><a href="http://flowingdata.com/about-nathan" rel="external nofollow" class="url">Nathan Yau</a></cite> <span class="comment-meta">â <a href="http://flowingdata.com/2011/05/11/how-to-map-connections-with-great-circles/#comment-73444">May 11, 2011 at 8:34 am</a>
</span>
</div>
<div class="comment-text"><p>@Bruno â Thanks for the tip. That will probably come in handy one day :)</p>
</div>
<div class="reply">
</div>
</div> 
<div class="clear-line"></div>
</div>
</li> 
<li class="comment even depth-2" id="li-comment-79155">
<div id="comment-79155" class="">
<div class="avatar">
<img alt="" src="./How to map connections with great circles_files/ff5bcaf5c5247413628527fc3e12dc56" class="avatar avatar-50 photo" height="50" width="50" originals="50" src-orig="http://1.gravatar.com/avatar/ff5bcaf5c5247413628527fc3e12dc56?s=50&amp;d=http%3A%2F%2Fflowingdata.com%2Fwp-content%2Fthemes%2Fflowingdata-4-8%2Fimages%2Fblank-square.png%3Fs%3D50&amp;r=PG" scale="2"> </div> 
<div class="comment-content">
<div class="comment-author vcard">
<cite class="fn">Robin</cite> <span class="comment-meta">â <a href="http://flowingdata.com/2011/05/11/how-to-map-connections-with-great-circles/#comment-79155">July 6, 2011 at 12:40 pm</a>
</span>
</div>
<div class="comment-text"><p>Hi Bruno â I ran into the same problem â the gcIntermediate() function has an optional argument breakAtDateLine which, if true, will return a list with two matrices if the path crosses over the international date line. Video looks great though, very interesting</p>
</div>
<div class="reply">
</div>
</div> 
<div class="clear-line"></div>
</div>
<ul class="children">
<li class="comment odd alt depth-3" id="li-comment-79160">
<div id="comment-79160" class="">
<div class="avatar">
<img alt="" src="./How to map connections with great circles_files/074dc5972971458a5a6fe6649599a896" class="avatar avatar-50 photo" height="50" width="50" originals="50" src-orig="http://0.gravatar.com/avatar/074dc5972971458a5a6fe6649599a896?s=50&amp;d=http%3A%2F%2Fflowingdata.com%2Fwp-content%2Fthemes%2Fflowingdata-4-8%2Fimages%2Fblank-square.png%3Fs%3D50&amp;r=PG" scale="2"> </div> 
<div class="comment-content">
<div class="comment-author vcard">
<cite class="fn"><a href="http://www.bgoncalves.com/" rel="external nofollow" class="url">Bruno GonÃ§alves</a></cite> <span class="comment-meta">â <a href="http://flowingdata.com/2011/05/11/how-to-map-connections-with-great-circles/#comment-79160">July 6, 2011 at 1:17 pm</a>
</span>
</div>
<div class="comment-text"><p>Robin, Yes, I know. But it only breaks the line in two. One going from, say, Australia towards 180 and another one coming from -180 to the US. This is the behavior I (tried) to describe in my original post and very different (and ugly) from my intent that I show in the movie.</p>
<p>The best way I found of doing it was going the âlongestâ way using the greatCircle() function.</p>
</div>
<div class="reply">
</div>
</div> 
<div class="clear-line"></div>
</div>
</li> 
</ul> 
</li> 
</ul> 
</li> 
<li class="comment even thread-even depth-1" id="li-comment-73432">
<div id="comment-73432" class="">
<div class="avatar">
<img alt="" src="./How to map connections with great circles_files/c950241a67c4de0d8dc0b21139cb654f" class="avatar avatar-50 photo" height="50" width="50" originals="50" src-orig="http://0.gravatar.com/avatar/c950241a67c4de0d8dc0b21139cb654f?s=50&amp;d=http%3A%2F%2Fflowingdata.com%2Fwp-content%2Fthemes%2Fflowingdata-4-8%2Fimages%2Fblank-square.png%3Fs%3D50&amp;r=PG" scale="2"> </div> 
<div class="comment-content">
<div class="comment-author vcard">
<cite class="fn"><a href="http://soulliberty.com/blog/" rel="external nofollow" class="url">Robert</a></cite> <span class="comment-meta">â <a href="http://flowingdata.com/2011/05/11/how-to-map-connections-with-great-circles/#comment-73432">May 11, 2011 at 5:46 am</a>
</span>
</div>
<div class="comment-text"><p>This actually a life-saver for me. Iâve been thinking about replicating Butlerâs Facebook map for a project Iâm working on to show social/geographic connections in the Bible. But, Iâve never used R and have been worried Iâd be stuck with Gephi, which currently canât do great-circle routes (only staight lines). Now I think I can manage a better way thanks to the example code you gave.</p>
</div>
<div class="reply">
</div>
</div> 
<div class="clear-line"></div>
</div>
<ul class="children">
<li class="comment byuser comment-author-nathany bypostauthor odd alt depth-2" id="li-comment-73455">
<div id="comment-73455" class="flowingdata-author">
<div class="avatar">
<img alt="" src="./How to map connections with great circles_files/2c4874805030568a3b6714cd79d46c73" class="avatar avatar-50 photo" height="50" width="50" originals="50" src-orig="http://0.gravatar.com/avatar/2c4874805030568a3b6714cd79d46c73?s=50&amp;d=http%3A%2F%2Fflowingdata.com%2Fwp-content%2Fthemes%2Fflowingdata-4-8%2Fimages%2Fblank-square.png%3Fs%3D50&amp;r=PG" scale="2"> </div> 
<div class="comment-content">
<div class="comment-author vcard">
<cite class="fn"><a href="http://flowingdata.com/about-nathan" rel="external nofollow" class="url">Nathan Yau</a></cite> <span class="comment-meta">â <a href="http://flowingdata.com/2011/05/11/how-to-map-connections-with-great-circles/#comment-73455">May 11, 2011 at 12:47 pm</a>
</span>
</div>
<div class="comment-text"><p>@Robert â Glad you found it helpful.</p>
</div>
<div class="reply">
</div>
</div> 
<div class="clear-line"></div>
</div>
</li> 
</ul> 
</li> 
<li class="comment even thread-odd thread-alt depth-1" id="li-comment-73434">
<div id="comment-73434" class="">
<div class="avatar">
<img alt="" src="./How to map connections with great circles_files/e8db4d43c1ef303f4454632e209f8aa1" class="avatar avatar-50 photo" height="50" width="50" originals="50" src-orig="http://0.gravatar.com/avatar/e8db4d43c1ef303f4454632e209f8aa1?s=50&amp;d=http%3A%2F%2Fflowingdata.com%2Fwp-content%2Fthemes%2Fflowingdata-4-8%2Fimages%2Fblank-square.png%3Fs%3D50&amp;r=PG" scale="2"> </div> 
<div class="comment-content">
<div class="comment-author vcard">
<cite class="fn">Sebastian H.</cite> <span class="comment-meta">â <a href="http://flowingdata.com/2011/05/11/how-to-map-connections-with-great-circles/#comment-73434">May 11, 2011 at 6:43 am</a>
</span>
</div>
<div class="comment-text"><p>I love your blog. I leave cranky remarks about statistical issues most of the time but really â youâre really pushing the visualization community forward. Thanks for the great tutorial.</p>
</div>
<div class="reply">
</div>
</div> 
<div class="clear-line"></div>
</div>
</li> 
<li class="comment odd alt thread-even depth-1" id="li-comment-73437">
<div id="comment-73437" class="">
<div class="avatar">
<img alt="" src="./How to map connections with great circles_files/7399ce4acdf5e9be2729eba16d95a86e" class="avatar avatar-50 photo" height="50" width="50" originals="50" src-orig="http://1.gravatar.com/avatar/7399ce4acdf5e9be2729eba16d95a86e?s=50&amp;d=http%3A%2F%2Fflowingdata.com%2Fwp-content%2Fthemes%2Fflowingdata-4-8%2Fimages%2Fblank-square.png%3Fs%3D50&amp;r=PG" scale="2"> </div> 
<div class="comment-content">
<div class="comment-author vcard">
<cite class="fn">Misa</cite> <span class="comment-meta">â <a href="http://flowingdata.com/2011/05/11/how-to-map-connections-with-great-circles/#comment-73437">May 11, 2011 at 7:12 am</a>
</span>
</div>
<div class="comment-text"><p>Thank you very much Nathan!</p>
</div>
<div class="reply">
</div>
</div> 
<div class="clear-line"></div>
</div>
</li> 
<li class="comment even thread-odd thread-alt depth-1" id="li-comment-73446">
<div id="comment-73446" class="">
<div class="avatar">
<img alt="" src="./How to map connections with great circles_files/95cf613ae6bce1a214d693b9fbe3e8be" class="avatar avatar-50 photo" height="50" width="50" originals="50" src-orig="http://1.gravatar.com/avatar/95cf613ae6bce1a214d693b9fbe3e8be?s=50&amp;d=http%3A%2F%2Fflowingdata.com%2Fwp-content%2Fthemes%2Fflowingdata-4-8%2Fimages%2Fblank-square.png%3Fs%3D50&amp;r=PG" scale="2"> </div> 
<div class="comment-content">
<div class="comment-author vcard">
<cite class="fn">Shreyas</cite> <span class="comment-meta">â <a href="http://flowingdata.com/2011/05/11/how-to-map-connections-with-great-circles/#comment-73446">May 11, 2011 at 8:58 am</a>
</span>
</div>
<div class="comment-text"><p>Great Tutorial!!!</p>
</div>
<div class="reply">
</div>
</div> 
<div class="clear-line"></div>
</div>
</li> 
<li class="comment odd alt thread-even depth-1" id="li-comment-73447">
<div id="comment-73447" class="">
<div class="avatar">
<img alt="" src="./How to map connections with great circles_files/3ebc71ba6f9ce43869f95d41d852b883" class="avatar avatar-50 photo" height="50" width="50" originals="50" src-orig="http://1.gravatar.com/avatar/3ebc71ba6f9ce43869f95d41d852b883?s=50&amp;d=http%3A%2F%2Fflowingdata.com%2Fwp-content%2Fthemes%2Fflowingdata-4-8%2Fimages%2Fblank-square.png%3Fs%3D50&amp;r=PG" scale="2"> </div> 
<div class="comment-content">
<div class="comment-author vcard">
<cite class="fn">Rob</cite> <span class="comment-meta">â <a href="http://flowingdata.com/2011/05/11/how-to-map-connections-with-great-circles/#comment-73447">May 11, 2011 at 9:05 am</a>
</span>
</div>
<div class="comment-text"><p>I had concerns in one of your footnotes about R not aggregating and handling large data files. We are looking at R to replace some JMP and SAS solutions, but those solutions perform statistical analysis on large datasets and then graph the results. Will R be able to handle it or is the limitation strictly related to Map visualizations?</p>
</div>
<div class="reply">
</div>
</div> 
<div class="clear-line"></div>
</div>
<ul class="children">
<li class="comment byuser comment-author-nathany bypostauthor even depth-2" id="li-comment-73448">
<div id="comment-73448" class="flowingdata-author">
<div class="avatar">
<img alt="" src="./How to map connections with great circles_files/2c4874805030568a3b6714cd79d46c73" class="avatar avatar-50 photo" height="50" width="50" originals="50" src-orig="http://0.gravatar.com/avatar/2c4874805030568a3b6714cd79d46c73?s=50&amp;d=http%3A%2F%2Fflowingdata.com%2Fwp-content%2Fthemes%2Fflowingdata-4-8%2Fimages%2Fblank-square.png%3Fs%3D50&amp;r=PG" scale="2"> </div> 
<div class="comment-content">
<div class="comment-author vcard">
<cite class="fn"><a href="http://flowingdata.com/about-nathan" rel="external nofollow" class="url">Nathan Yau</a></cite> <span class="comment-meta">â <a href="http://flowingdata.com/2011/05/11/how-to-map-connections-with-great-circles/#comment-73448">May 11, 2011 at 9:13 am</a>
</span>
</div>
<div class="comment-text"><p>@Rob â It depends on the data, what youâre doing with the data, and your system. Also, there are a growing number of solutions in R for handling big data (that I havenât had to get into yet), so itâs much less of a challenge that it was a couple of years ago.</p>
</div>
<div class="reply">
</div>
</div> 
<div class="clear-line"></div>
</div>
</li> 
<li class="comment odd alt depth-2" id="li-comment-73453">
<div id="comment-73453" class="">
<div class="avatar">
<img alt="" src="./How to map connections with great circles_files/8b7fca92e2bf8b900eb5e7d1b548930a" class="avatar avatar-50 photo" height="50" width="50" originals="50" src-orig="http://0.gravatar.com/avatar/8b7fca92e2bf8b900eb5e7d1b548930a?s=50&amp;d=http%3A%2F%2Fflowingdata.com%2Fwp-content%2Fthemes%2Fflowingdata-4-8%2Fimages%2Fblank-square.png%3Fs%3D50&amp;r=PG" scale="2"> </div> 
<div class="comment-content">
<div class="comment-author vcard">
<cite class="fn"><a href="https://heuristically.wordpress.com/" rel="external nofollow" class="url">Andrew</a></cite> <span class="comment-meta">â <a href="http://flowingdata.com/2011/05/11/how-to-map-connections-with-great-circles/#comment-73453">May 11, 2011 at 11:36 am</a>
</span>
</div>
<div class="comment-text"><p>@Rob: I use SAS every day and R several times a month. I often use SAS for ETL (aggregate from many sources and export a .csv), and then import .csv into R for machine learning. Some machine learning operations require a huge amount of memory relative to the original data set size (say, 2-64GB from a 100MB csv file). Other operations fit easily in memory. I have more experience with SAS for ETL, itâs already paid for, and itâs what my team knows, so I will continue this way.</p>
</div>
<div class="reply">
</div>
</div> 
<div class="clear-line"></div>
</div>
</li> 
<li class="comment even depth-2" id="li-comment-73488">
<div id="comment-73488" class="">
<div class="avatar">
<img alt="" src="./How to map connections with great circles_files/3ebc71ba6f9ce43869f95d41d852b883" class="avatar avatar-50 photo" height="50" width="50" originals="50" src-orig="http://1.gravatar.com/avatar/3ebc71ba6f9ce43869f95d41d852b883?s=50&amp;d=http%3A%2F%2Fflowingdata.com%2Fwp-content%2Fthemes%2Fflowingdata-4-8%2Fimages%2Fblank-square.png%3Fs%3D50&amp;r=PG" scale="2"> </div> 
<div class="comment-content">
<div class="comment-author vcard">
<cite class="fn">Rob</cite> <span class="comment-meta">â <a href="http://flowingdata.com/2011/05/11/how-to-map-connections-with-great-circles/#comment-73488">May 12, 2011 at 8:23 am</a>
</span>
</div>
<div class="comment-text"><p>Thanks for the replies!</p>
</div>
<div class="reply">
</div>
</div> 
<div class="clear-line"></div>
</div>
</li> 
</ul> 
</li> 
<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-73449">
<div id="comment-73449" class="">
<div class="avatar">
<img alt="" src="./How to map connections with great circles_files/867fe0d1d53e62f484c4c1172b5964ec" class="avatar avatar-50 photo" height="50" width="50" originals="50" src-orig="http://0.gravatar.com/avatar/867fe0d1d53e62f484c4c1172b5964ec?s=50&amp;d=http%3A%2F%2Fflowingdata.com%2Fwp-content%2Fthemes%2Fflowingdata-4-8%2Fimages%2Fblank-square.png%3Fs%3D50&amp;r=PG" scale="2"> </div> 
<div class="comment-content">
<div class="comment-author vcard">
<cite class="fn"><a href="http://themantics.wordpress.com/" rel="external nofollow" class="url">Ryan</a></cite> <span class="comment-meta">â <a href="http://flowingdata.com/2011/05/11/how-to-map-connections-with-great-circles/#comment-73449">May 11, 2011 at 9:51 am</a>
</span>
</div>
<div class="comment-text"><p>Great tutorial â canât wait to try this out on my own datasets.</p>
</div>
<div class="reply">
</div>
</div> 
<div class="clear-line"></div>
</div>
</li> 
<li class="comment even thread-even depth-1" id="li-comment-73469">
<div id="comment-73469" class="">
<div class="avatar">
<img alt="" src="./How to map connections with great circles_files/e16ce2f76693bbb42cf608b69fa5deb8" class="avatar avatar-50 photo" height="50" width="50" originals="50" src-orig="http://0.gravatar.com/avatar/e16ce2f76693bbb42cf608b69fa5deb8?s=50&amp;d=http%3A%2F%2Fflowingdata.com%2Fwp-content%2Fthemes%2Fflowingdata-4-8%2Fimages%2Fblank-square.png%3Fs%3D50&amp;r=PG" scale="2"> </div> 
<div class="comment-content">
<div class="comment-author vcard">
<cite class="fn">MK</cite> <span class="comment-meta">â <a href="http://flowingdata.com/2011/05/11/how-to-map-connections-with-great-circles/#comment-73469">May 11, 2011 at 10:22 pm</a>
</span>
</div>
<div class="comment-text"><p>This is AWESOME!</p>
</div>
<div class="reply">
</div>
</div> 
<div class="clear-line"></div>
</div>
</li> 
<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-73479">
<div id="comment-73479" class="">
<div class="avatar">
<img alt="" src="./How to map connections with great circles_files/52afd8a25dc5ae6cf390031b61953552" class="avatar avatar-50 photo" height="50" width="50" originals="50" src-orig="http://1.gravatar.com/avatar/52afd8a25dc5ae6cf390031b61953552?s=50&amp;d=http%3A%2F%2Fflowingdata.com%2Fwp-content%2Fthemes%2Fflowingdata-4-8%2Fimages%2Fblank-square.png%3Fs%3D50&amp;r=PG" scale="2"> </div> 
<div class="comment-content">
<div class="comment-author vcard">
<cite class="fn"><a href="http://toreopsahl.com/" rel="external nofollow" class="url">Tore Opsahl</a></cite> <span class="comment-meta">â <a href="http://flowingdata.com/2011/05/11/how-to-map-connections-with-great-circles/#comment-73479">May 12, 2011 at 6:13 am</a>
</span>
</div>
<div class="comment-text"><p>Thanks! Just needed this for a project! Tore</p>
</div>
<div class="reply">
</div>
</div> 
<div class="clear-line"></div>
</div>
</li> 
<li class="comment even thread-even depth-1" id="li-comment-73486">
<div id="comment-73486" class="">
<div class="avatar">
<img alt="" src="./How to map connections with great circles_files/7f82897f6fa8dfbb8973ad096d882b9c" class="avatar avatar-50 photo" height="50" width="50" originals="50" src-orig="http://1.gravatar.com/avatar/7f82897f6fa8dfbb8973ad096d882b9c?s=50&amp;d=http%3A%2F%2Fflowingdata.com%2Fwp-content%2Fthemes%2Fflowingdata-4-8%2Fimages%2Fblank-square.png%3Fs%3D50&amp;r=PG" scale="2"> </div> 
<div class="comment-content">
<div class="comment-author vcard">
<cite class="fn">schubert malbas</cite> <span class="comment-meta">â <a href="http://flowingdata.com/2011/05/11/how-to-map-connections-with-great-circles/#comment-73486">May 12, 2011 at 7:22 am</a>
</span>
</div>
<div class="comment-text"><p>awesome.. thank you nathan.. was still searching for methods in R or Processing, until this.</p>
</div>
<div class="reply">
</div>
</div> 
<div class="clear-line"></div>
</div>
</li> 
<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-73527">
<div id="comment-73527" class="">
<div class="avatar">
<img alt="" src="./How to map connections with great circles_files/0e697a8cc0383d3cd09701c7874aa984" class="avatar avatar-50 photo" height="50" width="50" originals="50" src-orig="http://0.gravatar.com/avatar/0e697a8cc0383d3cd09701c7874aa984?s=50&amp;d=http%3A%2F%2Fflowingdata.com%2Fwp-content%2Fthemes%2Fflowingdata-4-8%2Fimages%2Fblank-square.png%3Fs%3D50&amp;r=PG" scale="2"> </div> 
<div class="comment-content">
<div class="comment-author vcard">
<cite class="fn">Andy</cite> <span class="comment-meta">â <a href="http://flowingdata.com/2011/05/11/how-to-map-connections-with-great-circles/#comment-73527">May 13, 2011 at 8:43 am</a>
</span>
</div>
<div class="comment-text"><p>Great!</p>
<p>How did you collect the longitude / latitude for the airports? </p>
<p>Iâve got a bunch of international flights that Iâd rather not add in the long / lat by hand.</p>
</div>
<div class="reply">
</div>
</div> 
<div class="clear-line"></div>
</div>
<ul class="children">
<li class="comment even depth-2" id="li-comment-73533">
<div id="comment-73533" class="">
<div class="avatar">
<img alt="" src="./How to map connections with great circles_files/0e697a8cc0383d3cd09701c7874aa984" class="avatar avatar-50 photo" height="50" width="50" originals="50" src-orig="http://0.gravatar.com/avatar/0e697a8cc0383d3cd09701c7874aa984?s=50&amp;d=http%3A%2F%2Fflowingdata.com%2Fwp-content%2Fthemes%2Fflowingdata-4-8%2Fimages%2Fblank-square.png%3Fs%3D50&amp;r=PG" scale="2"> </div> 
<div class="comment-content">
<div class="comment-author vcard">
<cite class="fn">Andy</cite> <span class="comment-meta">â <a href="http://flowingdata.com/2011/05/11/how-to-map-connections-with-great-circles/#comment-73533">May 13, 2011 at 10:09 am</a>
</span>
</div>
<div class="comment-text"><p>Never mind..</p>
<p>I found this and was able to clean and convert it in SAS within a few minutesâ¦ </p>
<p><a href="http://www.partow.net/miscellaneous/airportdatabase/#Download" rel="nofollow">http://www.partow.net/miscella...../#Download</a></p>
</div>
<div class="reply">
</div>
</div> 
<div class="clear-line"></div>
</div>
</li> 
</ul> 
</li> 
<li class="comment odd alt thread-even depth-1" id="li-comment-73531">
<div id="comment-73531" class="">
<div class="avatar">
<img alt="" src="./How to map connections with great circles_files/325802907f1feaa797cc123c5149e066" class="avatar avatar-50 photo" height="50" width="50" originals="50" src-orig="http://1.gravatar.com/avatar/325802907f1feaa797cc123c5149e066?s=50&amp;d=http%3A%2F%2Fflowingdata.com%2Fwp-content%2Fthemes%2Fflowingdata-4-8%2Fimages%2Fblank-square.png%3Fs%3D50&amp;r=PG" scale="2"> </div> 
<div class="comment-content">
<div class="comment-author vcard">
<cite class="fn"><a href="http://blogs.sas.com/iml" rel="external nofollow" class="url">Rick Wicklin</a></cite> <span class="comment-meta">â <a href="http://flowingdata.com/2011/05/11/how-to-map-connections-with-great-circles/#comment-73531">May 13, 2011 at 9:54 am</a>
</span>
</div>
<div class="comment-text"><p>Thanks for posting this. I used your technique to replace the straight lines on my previous plots. SAS and R make a great combination: <a href="http://bit.ly/l6vnr4" rel="nofollow">http://bit.ly/l6vnr4</a></p>
</div>
<div class="reply">
</div>
</div> 
<div class="clear-line"></div>
</div>
</li> 
<li class="comment even thread-odd thread-alt depth-1" id="li-comment-73591">
<div id="comment-73591" class="">
<div class="avatar">
<img alt="" src="./How to map connections with great circles_files/468adda10cd596a6548c022084f404e9" class="avatar avatar-50 photo" height="50" width="50" originals="50" src-orig="http://0.gravatar.com/avatar/468adda10cd596a6548c022084f404e9?s=50&amp;d=http%3A%2F%2Fflowingdata.com%2Fwp-content%2Fthemes%2Fflowingdata-4-8%2Fimages%2Fblank-square.png%3Fs%3D50&amp;r=PG" scale="2"> </div> 
<div class="comment-content">
<div class="comment-author vcard">
<cite class="fn">Max</cite> <span class="comment-meta">â <a href="http://flowingdata.com/2011/05/11/how-to-map-connections-with-great-circles/#comment-73591">May 15, 2011 at 2:42 am</a>
</span>
</div>
<div class="comment-text"><p>Nice tutorial, but it seems to have a small flow that I found out when trying it with my own data â if in the flights data we donât have all the airports in either âairport1â³ or âairport2â³, weâll get an error when using comparison âairports$iata == fsub[j,]$airport1,]â saying that âlevel sets of factors are differentâ.<br>
May be it isnât a big problem, but I couldnât find a better way to solve it than to manually add missing airports in flights (with count=0) which was a bit lame :(</p>
</div>
<div class="reply">
</div>
</div> 
<div class="clear-line"></div>
</div>
<ul class="children">
<li class="comment odd alt depth-2" id="li-comment-73602">
<div id="comment-73602" class="">
<div class="avatar">
<img alt="" src="./How to map connections with great circles_files/0e697a8cc0383d3cd09701c7874aa984" class="avatar avatar-50 photo" height="50" width="50" originals="50" src-orig="http://0.gravatar.com/avatar/0e697a8cc0383d3cd09701c7874aa984?s=50&amp;d=http%3A%2F%2Fflowingdata.com%2Fwp-content%2Fthemes%2Fflowingdata-4-8%2Fimages%2Fblank-square.png%3Fs%3D50&amp;r=PG" scale="2"> </div> 
<div class="comment-content">
<div class="comment-author vcard">
<cite class="fn">Andy</cite> <span class="comment-meta">â <a href="http://flowingdata.com/2011/05/11/how-to-map-connections-with-great-circles/#comment-73602">May 15, 2011 at 7:47 am</a>
</span>
</div>
<div class="comment-text"><p>Try using the as.character() function in R to eliminate that error.</p>
<p>Youâll still have to account for the missing airports as gcIntermediate will throw an error with a null object.</p>
</div>
<div class="reply">
</div>
</div> 
<div class="clear-line"></div>
</div>
</li> 
<li class="comment byuser comment-author-nathany bypostauthor even depth-2" id="li-comment-73707">
<div id="comment-73707" class="flowingdata-author">
<div class="avatar">
<img alt="" src="./How to map connections with great circles_files/2c4874805030568a3b6714cd79d46c73" class="avatar avatar-50 photo" height="50" width="50" originals="50" src-orig="http://0.gravatar.com/avatar/2c4874805030568a3b6714cd79d46c73?s=50&amp;d=http%3A%2F%2Fflowingdata.com%2Fwp-content%2Fthemes%2Fflowingdata-4-8%2Fimages%2Fblank-square.png%3Fs%3D50&amp;r=PG" scale="2"> </div> 
<div class="comment-content">
<div class="comment-author vcard">
<cite class="fn"><a href="http://flowingdata.com/about-nathan" rel="external nofollow" class="url">Nathan Yau</a></cite> <span class="comment-meta">â <a href="http://flowingdata.com/2011/05/11/how-to-map-connections-with-great-circles/#comment-73707">May 16, 2011 at 11:12 pm</a>
</span>
</div>
<div class="comment-text"><p>Or when you load your data with read.csv(), set the as.is argument to TRUE.</p>
</div>
<div class="reply">
</div>
</div> 
<div class="clear-line"></div>
</div>
</li> 
</ul> 
</li> 
<li class="comment odd alt thread-even depth-1" id="li-comment-73691">
<div id="comment-73691" class="">
<div class="avatar">
<img alt="" src="./How to map connections with great circles_files/2bd3d1dc285b3b35719745843666b9d9" class="avatar avatar-50 photo" height="50" width="50" originals="50" src-orig="http://0.gravatar.com/avatar/2bd3d1dc285b3b35719745843666b9d9?s=50&amp;d=http%3A%2F%2Fflowingdata.com%2Fwp-content%2Fthemes%2Fflowingdata-4-8%2Fimages%2Fblank-square.png%3Fs%3D50&amp;r=PG" scale="2"> </div> 
<div class="comment-content">
<div class="comment-author vcard">
<cite class="fn"><a href="http://epiphron.tumblr.com/" rel="external nofollow" class="url">BCC</a></cite> <span class="comment-meta">â <a href="http://flowingdata.com/2011/05/11/how-to-map-connections-with-great-circles/#comment-73691">May 16, 2011 at 1:37 pm</a>
</span>
</div>
<div class="comment-text"><p>Well done! Thank you.</p>
</div>
<div class="reply">
</div>
</div> 
<div class="clear-line"></div>
</div>
</li> 
<li class="comment even thread-odd thread-alt depth-1" id="li-comment-73880">
<div id="comment-73880" class="">
<div class="avatar">
<img alt="" src="./How to map connections with great circles_files/23600dc878bf55bd484732bcb0ecd2e0" class="avatar avatar-50 photo" height="50" width="50" originals="50" src-orig="http://0.gravatar.com/avatar/23600dc878bf55bd484732bcb0ecd2e0?s=50&amp;d=http%3A%2F%2Fflowingdata.com%2Fwp-content%2Fthemes%2Fflowingdata-4-8%2Fimages%2Fblank-square.png%3Fs%3D50&amp;r=PG" scale="2"> </div> 
<div class="comment-content">
<div class="comment-author vcard">
<cite class="fn"><a href="http://rezultatiuzivofudbal.com/" rel="external nofollow" class="url">rezultati uzivo fudbal</a></cite> <span class="comment-meta">â <a href="http://flowingdata.com/2011/05/11/how-to-map-connections-with-great-circles/#comment-73880">May 18, 2011 at 5:21 am</a>
</span>
</div>
<div class="comment-text"><p>Thank you Nathan. Great tut.</p>
</div>
<div class="reply">
</div>
</div> 
<div class="clear-line"></div>
</div>
</li> 
<li class="comment odd alt thread-even depth-1" id="li-comment-74435">
<div id="comment-74435" class="">
<div class="avatar">
<img alt="" src="./How to map connections with great circles_files/337fa6560830029095ebf83c28308c27" class="avatar avatar-50 photo" height="50" width="50" originals="50" src-orig="http://1.gravatar.com/avatar/337fa6560830029095ebf83c28308c27?s=50&amp;d=http%3A%2F%2Fflowingdata.com%2Fwp-content%2Fthemes%2Fflowingdata-4-8%2Fimages%2Fblank-square.png%3Fs%3D50&amp;r=PG" scale="2"> </div> 
<div class="comment-content">
<div class="comment-author vcard">
<cite class="fn"><a href="http://procomun.wordpress.com/" rel="external nofollow" class="url">Oscar PerpiÃ±Ã¡n Lamigueiro</a></cite> <span class="comment-meta">â <a href="http://flowingdata.com/2011/05/11/how-to-map-connections-with-great-circles/#comment-74435">May 20, 2011 at 6:58 am</a>
</span>
</div>
<div class="comment-text"><p>Thank you very much for your useful tutorial. I have made some modifications to your code in order to use the sp, raster, lattice and latticeExtra packages (<a href="http://procomun.wordpress.com/2011/05/20/great-circles/" rel="nofollow">http://procomun.wordpress.com/.....t-circles/</a>).</p>
</div>
<div class="reply">
</div>
</div> 
<div class="clear-line"></div>
</div>
</li> 
<li class="comment even thread-odd thread-alt depth-1" id="li-comment-76029">
<div id="comment-76029" class="">
<div class="avatar">
<img alt="" src="./How to map connections with great circles_files/07596b82105949afe3ca5ddedc659946" class="avatar avatar-50 photo" height="50" width="50" originals="50" src-orig="http://0.gravatar.com/avatar/07596b82105949afe3ca5ddedc659946?s=50&amp;d=http%3A%2F%2Fflowingdata.com%2Fwp-content%2Fthemes%2Fflowingdata-4-8%2Fimages%2Fblank-square.png%3Fs%3D50&amp;r=PG" scale="2"> </div> 
<div class="comment-content">
<div class="comment-author vcard">
<cite class="fn">Simon</cite> <span class="comment-meta">â <a href="http://flowingdata.com/2011/05/11/how-to-map-connections-with-great-circles/#comment-76029">June 4, 2011 at 3:17 am</a>
</span>
</div>
<div class="comment-text"><p>Hi Nathan, excellent tutorial and map display. Flowingdata.com is great.<br>
I have a question as a Southern Hemisphere user:<br>
When using the âWorldâ map, when R prompts:<br>
âError in if (antipodal(p1, p2)) { : missing value where TRUE/FALSE neededâ</p>
<p>Following your code example, I changed the decimal lat/long to go from New Zealand to Europe with the Americas in the middle:<br>
xlim &lt;- c(170.0, 30.0)<br>
ylim &lt;- c(-70.0, 70.0)</p>
<p>My subsequent code (using an airports and flights dataset I created following your example) is:<br>
fsub &lt;- flights[flights$airline == "AR",]<br>
for (j in 1:length(fsub$airline)) {<br>
air1 &lt;- airports[airports$iata == fsub[j,]$airport1,]<br>
air2 &lt;- airports[airports$iata == fsub[j,]$airport2,]</p>
<p> inter &lt;- gcIntermediate(c(air1[1,]$long, air1[1,]$lat), c(air2[1,]$long, air2[1,]$lat), n=100, addStartEnd=TRUE)</p>
<p> lines(inter, col="black", lwd=0.8)<br>
}<br>
But is missing the "if (antipodal(p1, p2)) â { : missing value where TRUE/FALSE needed"<br>
Can you help please?</p>
<p>Many thanks<br>
Simon</p>
</div>
<div class="reply">
</div>
</div> 
<div class="clear-line"></div>
</div>
<ul class="children">
<li class="comment odd alt depth-2" id="li-comment-77884">
<div id="comment-77884" class="">
<div class="avatar">
<img alt="" src="./How to map connections with great circles_files/f342a1f56802cb2d6a458d4244fb786c" class="avatar avatar-50 photo" height="50" width="50" originals="50" src-orig="http://1.gravatar.com/avatar/f342a1f56802cb2d6a458d4244fb786c?s=50&amp;d=http%3A%2F%2Fflowingdata.com%2Fwp-content%2Fthemes%2Fflowingdata-4-8%2Fimages%2Fblank-square.png%3Fs%3D50&amp;r=PG" scale="2"> </div> 
<div class="comment-content">
<div class="comment-author vcard">
<cite class="fn"><a href="http://dataviz.com.au/" rel="external nofollow" class="url">Ben Reardon</a></cite> <span class="comment-meta">â <a href="http://flowingdata.com/2011/05/11/how-to-map-connections-with-great-circles/#comment-77884">June 22, 2011 at 12:35 am</a>
</span>
</div>
<div class="comment-text"><p>Hi Simon. As a fellow antipodean, Iâve struck this one as well as Iâve been playing with this. Fantastic tutorial BTW Nathan â thank you!</p>
<p>Try this â¦.. addStartEnd=TRUE, breakAtDateLine=TRUE)<br>
The other issue youâll strike, is that gcIntermediate will produce 2 separate matrices (one for each side of the date line). In this case, when you run the âlinesâ to draw the great circle, it doesnât care about this date line business (for me at least) and draws a horizontal line straight across the page where the date line was crossed. Therefore you need to get line to draw each side separately.<br>
This all results in the need to do some special handling to either draw normally, or as 2 lines depending on the date line being crossed.<br>
Iâve got a project Iâm just finishing now and will post code soon.</p>
<p>cheers<br>
ben</p>
</div>
<div class="reply">
</div>
</div> 
<div class="clear-line"></div>
</div>
<ul class="children">
<li class="comment even depth-3" id="li-comment-77987">
<div id="comment-77987" class="">
<div class="avatar">
<img alt="" src="./How to map connections with great circles_files/07596b82105949afe3ca5ddedc659946" class="avatar avatar-50 photo" height="50" width="50" originals="50" src-orig="http://0.gravatar.com/avatar/07596b82105949afe3ca5ddedc659946?s=50&amp;d=http%3A%2F%2Fflowingdata.com%2Fwp-content%2Fthemes%2Fflowingdata-4-8%2Fimages%2Fblank-square.png%3Fs%3D50&amp;r=PG" scale="2"> </div> 
<div class="comment-content">
<div class="comment-author vcard">
<cite class="fn">Simon</cite> <span class="comment-meta">â <a href="http://flowingdata.com/2011/05/11/how-to-map-connections-with-great-circles/#comment-77987">June 24, 2011 at 4:28 am</a>
</span>
</div>
<div class="comment-text"><p>Hi Ben,<br>
Many thanks! appreciate your tips, and look forward to hearing more about your project.<br>
Cheers<br>
Simon</p>
</div>
<div class="reply">
</div>
</div> 
<div class="clear-line"></div>
</div>
</li> 
</ul> 
</li> 
<li class="comment odd alt depth-2" id="li-comment-79857">
<div id="comment-79857" class="">
<div class="avatar">
<img alt="" src="./How to map connections with great circles_files/f342a1f56802cb2d6a458d4244fb786c" class="avatar avatar-50 photo" height="50" width="50" originals="50" src-orig="http://1.gravatar.com/avatar/f342a1f56802cb2d6a458d4244fb786c?s=50&amp;d=http%3A%2F%2Fflowingdata.com%2Fwp-content%2Fthemes%2Fflowingdata-4-8%2Fimages%2Fblank-square.png%3Fs%3D50&amp;r=PG" scale="2"> </div> 
<div class="comment-content">
<div class="comment-author vcard">
<cite class="fn"><a href="http://dataviz.com.au/" rel="external nofollow" class="url">Ben Reardon</a></cite> <span class="comment-meta">â <a href="http://flowingdata.com/2011/05/11/how-to-map-connections-with-great-circles/#comment-79857">July 19, 2011 at 4:27 am</a>
</span>
</div>
<div class="comment-text"><p>Hi Simon, here is some code that I used to get around some dateline issues. Youâll obviously need to tweak it to suit your work, but hopefully the idea of drawing the Two GCâs split by the dateline comes across.<br>
ben</p>
<p>library(maps)<br>
library(geosphere)</p>
<p>map(âworldâ, col=âgrey22â³, fill=TRUE, bg=ânavyblueâ, lwd=.2)</p>
<p>traces &lt;- read.csv("your_data_file_here", sep = "," , header=FALSE)<br>
lines &lt;- nrow(traces)<br>
this_width=.5</p>
<p> for (this_one in 1:lines) {<br>
long1 &lt;- traces$V3[this_one]<br>
lat1 &lt;- traces$V2[this_one]<br>
long2 &lt;- traces$V5[this_one]<br>
lat2 &lt;- traces$V4[this_one] </p>
<p> inter 6 ) {<br>
#this will draw any Great Circles that did not cross the dateline in green<br>
lines(inter, col=âgreenâ, lwd=this_width)<br>
}<br>
# However, if length(inter) = 2, it means there are 2 submatrices, which were created<br>
# by gcIntermediate because the GC crossed the dateline.<br>
else {<br>
#Draw the GC on one side of the dateline in red<br>
lines(inter[[1]], col=âredâ, lwd=this_width)<br>
#And the other side of the dateline in green<br>
lines(inter[[2]], col=âwhiteâ, lwd=this_width)<br>
}<br>
}</p>
</div>
<div class="reply">
</div>
</div> 
<div class="clear-line"></div>
</div>
</li> 
</ul> 
</li> 
<li class="comment even thread-even depth-1" id="li-comment-76111">
<div id="comment-76111" class="">
<div class="avatar">
<img alt="" src="./How to map connections with great circles_files/37a47b59239074844129be7279664472" class="avatar avatar-50 photo" height="50" width="50" originals="50" src-orig="http://1.gravatar.com/avatar/37a47b59239074844129be7279664472?s=50&amp;d=http%3A%2F%2Fflowingdata.com%2Fwp-content%2Fthemes%2Fflowingdata-4-8%2Fimages%2Fblank-square.png%3Fs%3D50&amp;r=PG" scale="2"> </div> 
<div class="comment-content">
<div class="comment-author vcard">
<cite class="fn"><a href="http://www.aaronhardin.com/" rel="external nofollow" class="url">Aaron</a></cite> <span class="comment-meta">â <a href="http://flowingdata.com/2011/05/11/how-to-map-connections-with-great-circles/#comment-76111">June 4, 2011 at 9:26 pm</a>
</span>
</div>
<div class="comment-text"><p>This was really useful!! I used your code to make a map of where graduate students in my department got their undergraduate degrees. Here are the pics: <a href="http://www.aaronhardin.com/#f17/flickr" rel="nofollow">http://www.aaronhardin.com/#f17/flickr</a> and here is the code: <a href="https://github.com/aihardin/Academic_Migrations" rel="nofollow">https://github.com/aihardin/Academic_Migrations</a> I added some code to take care of the whisker issue that @Bruno mentioned.</p>
</div>
<div class="reply">
</div>
</div> 
<div class="clear-line"></div>
</div>
</li> 
<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-76141">
<div id="comment-76141" class="">
<div class="avatar">
<img alt="" src="./How to map connections with great circles_files/26f8d61d4b82593b323c438da5a92e7e" class="avatar avatar-50 photo" height="50" width="50" originals="50" src-orig="http://0.gravatar.com/avatar/26f8d61d4b82593b323c438da5a92e7e?s=50&amp;d=http%3A%2F%2Fflowingdata.com%2Fwp-content%2Fthemes%2Fflowingdata-4-8%2Fimages%2Fblank-square.png%3Fs%3D50&amp;r=PG" scale="2"> </div> 
<div class="comment-content">
<div class="comment-author vcard">
<cite class="fn"><a href="http://www.cambridge.aero/" rel="external nofollow" class="url">Jeffrey Breen</a></cite> <span class="comment-meta">â <a href="http://flowingdata.com/2011/05/11/how-to-map-connections-with-great-circles/#comment-76141">June 5, 2011 at 6:46 am</a>
</span>
</div>
<div class="comment-text"><p>Hi Nathan:</p>
<p>Great tutorial! Thanks for the pointer to gcIntermediate() â I had missed it and wrote my own last year when I first started making route maps in R.</p>
<p>Perhaps I can return the favor: BTS does publish airport locations themselves. The table is called âMaster Coordinateâ in their âAviation Support Tablesâ database: <a href="http://www.transtats.bts.gov/Fields.asp?Table_ID=288" rel="nofollow">http://www.transtats.bts.gov/F.....ble_ID=288</a> No need for geocoding!</p>
<p>Thanks,<br>
Jeffrey</p>
</div>
<div class="reply">
</div>
</div> 
<div class="clear-line"></div>
</div>
</li> 
<li class="comment even thread-even depth-1" id="li-comment-76534">
<div id="comment-76534" class="">
<div class="avatar">
<img alt="" src="./How to map connections with great circles_files/9112dea062a0286ddbcae4f2bd73fe30" class="avatar avatar-50 photo" height="50" width="50" originals="50" src-orig="http://1.gravatar.com/avatar/9112dea062a0286ddbcae4f2bd73fe30?s=50&amp;d=http%3A%2F%2Fflowingdata.com%2Fwp-content%2Fthemes%2Fflowingdata-4-8%2Fimages%2Fblank-square.png%3Fs%3D50&amp;r=PG" scale="2"> </div> 
<div class="comment-content">
<div class="comment-author vcard">
<cite class="fn">olor</cite> <span class="comment-meta">â <a href="http://flowingdata.com/2011/05/11/how-to-map-connections-with-great-circles/#comment-76534">June 9, 2011 at 9:04 am</a>
</span>
</div>
<div class="comment-text"><p>Hi Nathan<br>
I have database of exchange with country<br>
I do like this tutorial . but have ?<br>
I donât have level like airlines with AA<br>
and when lines are drawn<br>
I dont know if we see the return exchange ?it disapear?</p>
</div>
<div class="reply">
</div>
</div> 
<div class="clear-line"></div>
</div>
</li> 
<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-77986">
<div id="comment-77986" class="">
<div class="avatar">
<img alt="" src="./How to map connections with great circles_files/6f7282e8659f3568b84cedb6dc689cd6" class="avatar avatar-50 photo" height="50" width="50" originals="50" src-orig="http://0.gravatar.com/avatar/6f7282e8659f3568b84cedb6dc689cd6?s=50&amp;d=http%3A%2F%2Fflowingdata.com%2Fwp-content%2Fthemes%2Fflowingdata-4-8%2Fimages%2Fblank-square.png%3Fs%3D50&amp;r=PG" scale="2"> </div> 
<div class="comment-content">
<div class="comment-author vcard">
<cite class="fn">David Springate</cite> <span class="comment-meta">â <a href="http://flowingdata.com/2011/05/11/how-to-map-connections-with-great-circles/#comment-77986">June 24, 2011 at 4:10 am</a>
</span>
</div>
<div class="comment-text"><p>Really great tutorial! I used it to create a map of global academic collaborations in my subject, evolutionary biology: <a href="http://www.datajujitsu.co.uk/2011/06/mapping-academic-collaborations-in.html" rel="nofollow">http://www.datajujitsu.co.uk/2.....ns-in.html</a> .<br>
I got arounf the whiskers problem mentioned here by splitting the great circles into two if they go from the maximum positive to the maximum negative values.</p>
</div>
<div class="reply">
</div>
</div> 
<div class="clear-line"></div>
</div>
</li> 
<li class="comment even thread-even depth-1" id="li-comment-79156">
<div id="comment-79156" class="">
<div class="avatar">
<img alt="" src="./How to map connections with great circles_files/ff5bcaf5c5247413628527fc3e12dc56" class="avatar avatar-50 photo" height="50" width="50" originals="50" src-orig="http://1.gravatar.com/avatar/ff5bcaf5c5247413628527fc3e12dc56?s=50&amp;d=http%3A%2F%2Fflowingdata.com%2Fwp-content%2Fthemes%2Fflowingdata-4-8%2Fimages%2Fblank-square.png%3Fs%3D50&amp;r=PG" scale="2"> </div> 
<div class="comment-content">
<div class="comment-author vcard">
<cite class="fn">Robin</cite> <span class="comment-meta">â <a href="http://flowingdata.com/2011/05/11/how-to-map-connections-with-great-circles/#comment-79156">July 6, 2011 at 12:42 pm</a>
</span>
</div>
<div class="comment-text"><p>Like everyone else, I have to say this is a great tutorial. Thank you!<br>
Is it possible to color code countries using the maps library? That would be a great addition. Conversely, if one uses maptools, will most of the code transfer?</p>
</div>
<div class="reply">
</div>
</div> 
<div class="clear-line"></div>
</div>
</li> 
<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-79801">
<div id="comment-79801" class="">
<div class="avatar">
<img alt="" src="./How to map connections with great circles_files/381d46f6388ed05ec56a919edc1e8c3c" class="avatar avatar-50 photo" height="50" width="50" originals="50" src-orig="http://1.gravatar.com/avatar/381d46f6388ed05ec56a919edc1e8c3c?s=50&amp;d=http%3A%2F%2Fflowingdata.com%2Fwp-content%2Fthemes%2Fflowingdata-4-8%2Fimages%2Fblank-square.png%3Fs%3D50&amp;r=PG" scale="2"> </div> 
<div class="comment-content">
<div class="comment-author vcard">
<cite class="fn">Nick Dawe</cite> <span class="comment-meta">â <a href="http://flowingdata.com/2011/05/11/how-to-map-connections-with-great-circles/#comment-79801">July 18, 2011 at 6:28 am</a>
</span>
</div>
<div class="comment-text"><p>Hi â thanks for a fascinating and inspiring tutorial. Iâm afraid Iâve tried this a few times, but always get stuck at step 4, when I enter âlines(inter)â. R then gives the following error:</p>
<p> âError in plot.xy(xy.coords(x, y), type = type, â¦) :<br>
plot.new has not been called yetâ</p>
<p>Is there something fairly obvious I may have missed? Thanks for any help!</p>
</div>
<div class="reply">
</div>
</div> 
<div class="clear-line"></div>
</div>
<ul class="children">
<li class="comment even depth-2" id="li-comment-80263">
<div id="comment-80263" class="">
<div class="avatar">
<img alt="" src="./How to map connections with great circles_files/381d46f6388ed05ec56a919edc1e8c3c" class="avatar avatar-50 photo" height="50" width="50" originals="50" src-orig="http://1.gravatar.com/avatar/381d46f6388ed05ec56a919edc1e8c3c?s=50&amp;d=http%3A%2F%2Fflowingdata.com%2Fwp-content%2Fthemes%2Fflowingdata-4-8%2Fimages%2Fblank-square.png%3Fs%3D50&amp;r=PG" scale="2"> </div> 
<div class="comment-content">
<div class="comment-author vcard">
<cite class="fn">Nick Dawe</cite> <span class="comment-meta">â <a href="http://flowingdata.com/2011/05/11/how-to-map-connections-with-great-circles/#comment-80263">July 25, 2011 at 2:49 am</a>
</span>
</div>
<div class="comment-text"><p>Hi â just in case anyone else comes across the same issue, I found that simply adding âplot.new()â at the beginning of the coding fixed it.</p>
</div>
<div class="reply">
</div>
</div> 
<div class="clear-line"></div>
</div>
</li> 
</ul> 
</li> 
<li class="comment odd alt thread-even depth-1" id="li-comment-80828">
<div id="comment-80828" class="">
<div class="avatar">
<img alt="" src="./How to map connections with great circles_files/2c3305d541babe6625868594f6dd67d4" class="avatar avatar-50 photo" height="50" width="50" originals="50" src-orig="http://0.gravatar.com/avatar/2c3305d541babe6625868594f6dd67d4?s=50&amp;d=http%3A%2F%2Fflowingdata.com%2Fwp-content%2Fthemes%2Fflowingdata-4-8%2Fimages%2Fblank-square.png%3Fs%3D50&amp;r=PG" scale="2"> </div> 
<div class="comment-content">
<div class="comment-author vcard">
<cite class="fn">Dana</cite> <span class="comment-meta">â <a href="http://flowingdata.com/2011/05/11/how-to-map-connections-with-great-circles/#comment-80828">August 1, 2011 at 11:47 pm</a>
</span>
</div>
<div class="comment-text"><p>Great tutorial! Iâve been able to use the aiports.csv with information from our local Govât travel data for 2010, numbering the amount of flights from each of the mainland states to all of our islandâs major airports (Hawaii) . I tweaked the local Gov data so that each state name was replaced by their major airportâs abbreviation and changed the Island airport columns to be in rows, next to each state repeated 8 times consecutively. I think there must be a better way to create a For loop to read through each state row and leave the islands as columns, instead of reformatting Iâm still sorting it out. The first image has all the data from Alaska to Connecticut and already shaping up to be pretty interesting. Hawaii is already obscured by all the instances of flights by those first few states alone. I donât know if this is a distortion of the map proportions, or if we really are just a series of tiny volcanic rocks in the center of the Pacific. I hope to refine it enough to post.</p>
</div>
<div class="reply">
</div>
</div> 
<div class="clear-line"></div>
</div>
</li> 
<li class="comment even thread-odd thread-alt depth-1" id="li-comment-81799">
<div id="comment-81799" class="">
<div class="avatar">
<img alt="" src="./How to map connections with great circles_files/fce49d5fb7d9c92167e5938330482656" class="avatar avatar-50 photo" height="50" width="50" originals="50" src-orig="http://1.gravatar.com/avatar/fce49d5fb7d9c92167e5938330482656?s=50&amp;d=http%3A%2F%2Fflowingdata.com%2Fwp-content%2Fthemes%2Fflowingdata-4-8%2Fimages%2Fblank-square.png%3Fs%3D50&amp;r=PG" scale="2"> </div> 
<div class="comment-content">
<div class="comment-author vcard">
<cite class="fn">DArctur</cite> <span class="comment-meta">â <a href="http://flowingdata.com/2011/05/11/how-to-map-connections-with-great-circles/#comment-81799">August 6, 2011 at 2:08 pm</a>
</span>
</div>
<div class="comment-text"><p>Great tutorial. But Iâve tried viewing this tutorial in firefox v5 and chrome v13 browsers with all scripts enabled, and do not see any maps from step 3 on, only the arcs. Is that whatâs intended?</p>
</div>
<div class="reply">
</div>
</div> 
<div class="clear-line"></div>
</div>
</li> 
<li class="comment odd alt thread-even depth-1" id="li-comment-85363">
<div id="comment-85363" class="">
<div class="avatar">
<img alt="" src="./How to map connections with great circles_files/f115afff9095ecbb15ae06634bbdb1d8" class="avatar avatar-50 photo" height="50" width="50" originals="50" src-orig="http://1.gravatar.com/avatar/f115afff9095ecbb15ae06634bbdb1d8?s=50&amp;d=http%3A%2F%2Fflowingdata.com%2Fwp-content%2Fthemes%2Fflowingdata-4-8%2Fimages%2Fblank-square.png%3Fs%3D50&amp;r=PG" scale="2"> </div> 
<div class="comment-content">
<div class="comment-author vcard">
<cite class="fn"><a href="http://twitter.com/#!/gpe" rel="external nofollow" class="url">Geoff</a></cite> <span class="comment-meta">â <a href="http://flowingdata.com/2011/05/11/how-to-map-connections-with-great-circles/#comment-85363">August 22, 2011 at 2:13 pm</a>
</span>
</div>
<div class="comment-text"><p>Does anybody know how I might change the map projection as well as the great circle projections? Iâve loaded the mapproj library and, using the relevant arguments/code, I can change the projection of the basemap but not the great circle lines.</p>
<p>In case it matters, to change the basemap projection I used:</p>
<p>map(âworldâ, proj=âmollweideâ, col=â#1F1F1Fâ, fill=TRUE, bg=âblackâ, lwd=0.05)</p>
</div>
<div class="reply">
</div>
</div> 
<div class="clear-line"></div>
</div>
<ul class="children">
<li class="comment even depth-2" id="li-comment-89742">
<div id="comment-89742" class="">
<div class="avatar">
<img alt="" src="./How to map connections with great circles_files/ba29cf124fb97aa1516fe06bc6a40bbb" class="avatar avatar-50 photo" height="50" width="50" originals="50" src-orig="http://1.gravatar.com/avatar/ba29cf124fb97aa1516fe06bc6a40bbb?s=50&amp;d=http%3A%2F%2Fflowingdata.com%2Fwp-content%2Fthemes%2Fflowingdata-4-8%2Fimages%2Fblank-square.png%3Fs%3D50&amp;r=PG" scale="2"> </div> 
<div class="comment-content">
<div class="comment-author vcard">
<cite class="fn">BLaw</cite> <span class="comment-meta">â <a href="http://flowingdata.com/2011/05/11/how-to-map-connections-with-great-circles/#comment-89742">October 18, 2011 at 11:15 pm</a>
</span>
</div>
<div class="comment-text"><p>If I could second Geoffâs question. I would like to increase the âbendâ in the great circle lines, does anyone know of a way to do this. My map is just the east coast of the United States and so the lines are nearly straight through this region. Increasing the bend in the lines would make them more visible, almost jittering with lines in a way.</p>
<p>Thanks!</p>
</div>
<div class="reply">
</div>
</div> 
<div class="clear-line"></div>
</div>
</li> 
</ul> 
</li> 
<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-89218">
<div id="comment-89218" class="">
<div class="avatar">
<img alt="" src="./How to map connections with great circles_files/50debafd7d0a461f5f38136e5b5220f7" class="avatar avatar-50 photo" height="50" width="50" originals="50" src-orig="http://1.gravatar.com/avatar/50debafd7d0a461f5f38136e5b5220f7?s=50&amp;d=http%3A%2F%2Fflowingdata.com%2Fwp-content%2Fthemes%2Fflowingdata-4-8%2Fimages%2Fblank-square.png%3Fs%3D50&amp;r=PG" scale="2"> </div> 
<div class="comment-content">
<div class="comment-author vcard">
<cite class="fn">Jakub</cite> <span class="comment-meta">â <a href="http://flowingdata.com/2011/05/11/how-to-map-connections-with-great-circles/#comment-89218">October 12, 2011 at 2:31 pm</a>
</span>
</div>
<div class="comment-text"><p>Great tutorial!</p>
<p>By the way, does anyone know how to change dimensions of the plotted map (final picture height and width in pixels)?</p>
</div>
<div class="reply">
</div>
</div> 
<div class="clear-line"></div>
</div>
</li> 
<li class="comment even thread-even depth-1" id="li-comment-90337">
<div id="comment-90337" class="">
<div class="avatar">
<img alt="" src="./How to map connections with great circles_files/f3e9ea6cedf54d8fbcd145dcf947baf8" class="avatar avatar-50 photo" height="50" width="50" originals="50" src-orig="http://1.gravatar.com/avatar/f3e9ea6cedf54d8fbcd145dcf947baf8?s=50&amp;d=http%3A%2F%2Fflowingdata.com%2Fwp-content%2Fthemes%2Fflowingdata-4-8%2Fimages%2Fblank-square.png%3Fs%3D50&amp;r=PG" scale="2"> </div> 
<div class="comment-content">
<div class="comment-author vcard">
<cite class="fn"><a href="http://cem.re/" rel="external nofollow" class="url">Cemre GÃ¼ngÃ¶r</a></cite> <span class="comment-meta">â <a href="http://flowingdata.com/2011/05/11/how-to-map-connections-with-great-circles/#comment-90337">October 23, 2011 at 8:20 am</a>
</span>
</div>
<div class="comment-text"><p>Hereâs how to draw great circle arcs in Processing!</p>
<p><a href="https://gist.github.com/1306578" rel="nofollow">https://gist.github.com/1306578</a></p>
</div>
<div class="reply">
</div>
</div> 
<div class="clear-line"></div>
</div>
</li> 
<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-93044">
<div id="comment-93044" class="">
<div class="avatar">
<img alt="" src="./How to map connections with great circles_files/f386e2ceed4793b25f4663287e7ef3ed" class="avatar avatar-50 photo" height="50" width="50" originals="50" src-orig="http://1.gravatar.com/avatar/f386e2ceed4793b25f4663287e7ef3ed?s=50&amp;d=http%3A%2F%2Fflowingdata.com%2Fwp-content%2Fthemes%2Fflowingdata-4-8%2Fimages%2Fblank-square.png%3Fs%3D50&amp;r=PG" scale="2"> </div> 
<div class="comment-content">
<div class="comment-author vcard">
<cite class="fn">Pam</cite> <span class="comment-meta">â <a href="http://flowingdata.com/2011/05/11/how-to-map-connections-with-great-circles/#comment-93044">November 2, 2011 at 12:11 pm</a>
</span>
</div>
<div class="comment-text"><p>Iâd also love to know how to change the dimensions. Thanks!</p>
</div>
<div class="reply">
</div>
</div> 
<div class="clear-line"></div>
</div>
</li> 
</ul>
</div> 
</div>
</div>
</div> 
</div> 
</div> 
<div id="footer">
<div id="footer-container" class="content">
<div class="float-left" style="width:32%;margin-right:5%;">
<div id="about" class="sec">
<h3>About</h3>
<p>FlowingData explores how designers, statisticians, and computer scientists are using data to understand ourselves better â mainly through data visualization.</p>
<p>As for me, I'm Nathan Yau, and I have a PhD in statistics, with a background in eating.</p>
<p><a href="http://flowingdata.com/about/">More...</a></p>
</div>
</div>
<div class="float-left" style="width:36%;margin-right:5%;">
<div id="book-single" class="sec">
<h3>Books</h3>
<ul id="books" style="margin-bottom:0">
<li>
<a href="http://flowingdata.com/data-points/"><img src="./How to map connections with great circles_files/DataPoints60x75.png" title="Data Points" class="img-left" style="margin-bottom:0" scale="0"><strong>Data Points</strong><br>Visualization that Means Something</a><br>
<div class="clear-line"></div>
</li>
<li><a href="http://flowingdata.com/visualize-this/"><img src="./How to map connections with great circles_files/flowingdata60x79.jpg" title="Visualize This" class="img-left" style="margin-bottom:0" scale="0"><strong>Visualize This</strong><br>The FlowingData Guide to Design, Visualization, and Statistics</a><br>
<div class="clear-line"></div>
</li>
</ul>
</div> 
</div>
<div class="float-left" style="width:22%">
<div id="follow" class="sec">
<h3>Follow</h3>
<p>
<a href="http://twitter.com/flowingdata">Twitter</a> &nbsp;â¢&nbsp;
<a href="http://facebook.com/flowingdata">Facebook</a> &nbsp;â¢&nbsp;
<a href="http://eepurl.com/icL0o">Email</a> &nbsp;â¢&nbsp;
<a href="http://flowingdata.com/feed">RSS</a>
</p>
</div>
<div id="misc" class="sec">
<h3>Miscellaneous</h3>
<a href="http://flowingdata.com/contact">Contact</a> &nbsp;â¢&nbsp;
<a href="http://flowingdata.com/advertise">Sponsorship</a> &nbsp;â¢&nbsp;
<a href="http://flowingdata.bigcartel.com/">Shop</a><a>
</a></div><a>
</a></div><a>
<div class="clear-line"></div>
</a></div><a> 
</a></div><a> 
</a><div id="bottom"><a>
Unless otherwise noted, graphics and words by me are licensed under </a><a href="http://creativecommons.org/licenses/by-nc/3.0/us/">Creative Commons BY-NC</a>. Contact original authors for everything else.
</div>
 
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script><script src="./How to map connections with great circles_files/ga.js" type="text/javascript"></script>
<script type="text/javascript">
var pageTracker = _gat._getTracker("UA-865100-4");
pageTracker._initData();
pageTracker._trackPageview();
</script>
<script type="text/javascript" src="./How to map connections with great circles_files/shCore.js"></script>
<script type="text/javascript" src="./How to map connections with great circles_files/shBrushR.js"></script>
<script type="text/javascript">
	(function(){
		var corecss = document.createElement('link');
		var themecss = document.createElement('link');
		var corecssurl = "http://flowingdata.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter2/styles/shCore.css?ver=2.1.364";
		if ( corecss.setAttribute ) {
				corecss.setAttribute( "rel", "stylesheet" );
				corecss.setAttribute( "type", "text/css" );
				corecss.setAttribute( "href", corecssurl );
		} else {
				corecss.rel = "stylesheet";
				corecss.href = corecssurl;
		}
		document.getElementsByTagName("head")[0].insertBefore( corecss, document.getElementById("syntaxhighlighteranchor") );
		var themecssurl = "http://flowingdata.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter2/styles/shThemeDefault.css?ver=2.1.364";
		if ( themecss.setAttribute ) {
				themecss.setAttribute( "rel", "stylesheet" );
				themecss.setAttribute( "type", "text/css" );
				themecss.setAttribute( "href", themecssurl );
		} else {
				themecss.rel = "stylesheet";
				themecss.href = themecssurl;
		}
		//document.getElementById("syntaxhighlighteranchor").appendChild(themecss);
		document.getElementsByTagName("head")[0].insertBefore( themecss, document.getElementById("syntaxhighlighteranchor") );
	})();
	SyntaxHighlighter.config.clipboardSwf = 'http://flowingdata.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter2/scripts/clipboard.swf';
	SyntaxHighlighter.config.strings.expandSource = 'show source';
	SyntaxHighlighter.config.strings.viewSource = 'view source';
	SyntaxHighlighter.config.strings.copyToClipboard = 'copy to clipboard';
	SyntaxHighlighter.config.strings.copyToClipboardConfirmation = 'The code is in your clipboard now';
	SyntaxHighlighter.config.strings.print = 'print';
	SyntaxHighlighter.config.strings.help = '?';
	SyntaxHighlighter.config.strings.alert = 'SyntaxHighlighter\n\n';
	SyntaxHighlighter.config.strings.noBrush = 'Can\'t find brush for: ';
	SyntaxHighlighter.config.strings.brushNotHtmlScript = 'Brush wasn\'t configured for html-script option: ';
	SyntaxHighlighter.defaults['pad-line-numbers'] = false;
	SyntaxHighlighter.all();
</script>
<script type="text/javascript" src="./How to map connections with great circles_files/photon.js"></script>
<script type="text/javascript" src="./How to map connections with great circles_files/devicepx-jetpack.js"></script>
<script src="./How to map connections with great circles_files/e-201350.js" type="text/javascript"></script>
<script type="text/javascript">
	st_go({v:'ext',j:'1:2.7',blog:'1938889',post:'16555',tz:'-8'});
	var load_cmc = function(){linktracker_init(1938889,16555,2);};
	if ( typeof addLoadEvent != 'undefined' ) addLoadEvent(load_cmc);
	else load_cmc();
	</script><img id="wpstats" src="./How to map connections with great circles_files/g.gif" alt="" scale="0">
</body></html>