<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- saved from url=(0074)http://flowingdata.com/2012/09/05/mapping-with-diffusion-based-cartograms/ -->
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US"><head profile="http://gmpg.org/xfn/11"><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<title> Mapping with Diffusion-based Cartograms</title>
<meta name="generator" content="WordPress 3.8">  
<link rel="stylesheet" href="./Mapping with Diffusion-based Cartograms_files/style.css" type="text/css" media="screen">
<link rel="alternate" type="application/rss+xml" title="RSS 2.0" href="http://flowingdata.com/feed">
<link rel="pingback" href="http://flowingdata.com/xmlrpc.php">
<link rel="shortcut icon" href="http://flowingdata.com/wp-content/themes/flowingdata-4-8/images/favicon.ico">
<script src="./Mapping with Diffusion-based Cartograms_files/quant.js" async="" type="text/javascript"></script><script async="" type="text/javascript" src="http://www.googletagservices.com/tag/js/gpt.js"></script><script type="text/javascript" src="./Mapping with Diffusion-based Cartograms_files/jquery-1.4.4.min.js"></script>
<script type="text/javascript">
    var googletag = googletag || {};
    googletag.cmd = googletag.cmd || [];
    (function() {
    var gads = document.createElement('script');
    gads.async = true;
    gads.type = 'text/javascript';
    var useSSL = 'https:' == document.location.protocol;
    gads.src = (useSSL ? 'https:' : 'http:') + 
    '//www.googletagservices.com/tag/js/gpt.js';
    var node = document.getElementsByTagName('script')[0];
    node.parentNode.insertBefore(gads, node);
    })();
    </script>
<script type="text/javascript">
    googletag.cmd.push(function() {
    googletag.defineSlot('/2462688/Sidebar_rectangle', [300, 250], 'div-gpt-ad-1332011316310-2').addService(googletag.pubads());
    googletag.defineSlot('/2462688/Square1', [125, 125], 'div-gpt-ad-1332011316310-3').addService(googletag.pubads());
    googletag.defineSlot('/2462688/Square2', [125, 125], 'div-gpt-ad-1332011316310-4').addService(googletag.pubads());
    googletag.defineSlot('/2462688/Square3', [125, 125], 'div-gpt-ad-1332011316310-5').addService(googletag.pubads());
    googletag.defineSlot('/2462688/Square4', [125, 125], 'div-gpt-ad-1358209090048-5').addService(googletag.pubads());
googletag.defineSlot('/2462688/Bottom_Post', [300, 250], 'div-gpt-ad-1332011316310-0').addService(googletag.pubads());    googletag.pubads().enableSingleRequest();
    googletag.pubads().collapseEmptyDivs();
    googletag.enableServices();
    });
    </script>
<link rel="alternate" type="application/rss+xml" title="FlowingData » Mapping with Diffusion-based Cartograms Comments Feed" href="http://flowingdata.com/2012/09/05/mapping-with-diffusion-based-cartograms/feed/">
<script type="text/javascript" src="./Mapping with Diffusion-based Cartograms_files/comment-reply.min.js"></script>
<script type="text/javascript" src="./Mapping with Diffusion-based Cartograms_files/jquery.js"></script>
<script type="text/javascript" src="./Mapping with Diffusion-based Cartograms_files/jquery-migrate.min.js"></script>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://flowingdata.com/xmlrpc.php?rsd">
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://flowingdata.com/wp-includes/wlwmanifest.xml">
<link rel="prev" title="Analyzing text messages to save lives" href="http://flowingdata.com/2012/09/05/analyzing-text-messages-to-save-lives/">
<link rel="next" title="Man takes picture of himself every day for 12 years" href="http://flowingdata.com/2012/09/05/man-takes-picture-of-himself-every-day-for-12-5-years/">
<meta name="generator" content="WordPress 3.8">
<link rel="canonical" href="./Mapping with Diffusion-based Cartograms_files/Mapping with Diffusion-based Cartograms.html">
<link rel="shortlink" href="http://flowingdata.com/?p=26660">
 <script type="text/javascript" src="./Mapping with Diffusion-based Cartograms_files/democracy.js"></script><link rel="stylesheet" href="./Mapping with Diffusion-based Cartograms_files/basic.css" type="text/css"><link rel="stylesheet" href="./Mapping with Diffusion-based Cartograms_files/style(1).css" type="text/css"><link rel="stylesheet" href="./Mapping with Diffusion-based Cartograms_files/wp-page-numbers.css" type="text/css" media="screen"><style type="text/css">img#wpstats{display:none}</style><link rel="stylesheet" type="text/css" href="./Mapping with Diffusion-based Cartograms_files/shCore.css"><link rel="stylesheet" type="text/css" href="./Mapping with Diffusion-based Cartograms_files/shThemeDefault.css"><style type="text/css" id="syntaxhighlighteranchor"></style>
<style>#jakemwxsoryetzkbmtieobfvrcqhkpbhgvtsurrrizfr{border:solid 2px #fff !important;box-sizing:content-box !important;color:#fff !important;display:block !important;height:auto !important;margin:0 !important;opacity:0.9 !important;padding:7px 10px !important;position:fixed !important;visibility:visible !important;width:auto !important;z-index:2147483647 !important;-webkit-border-radius:5px !important;-webkit-box-shadow:0px 0px 20px #000 !important;-webkit-box-sizing:content-box !important;}.jakemwxsoryetzkbmtieobfvrcqhkpbhgvtsurrrizfr-blocked{color:#777 !important;display:inline !important;text-decoration:line-through !important;}#jakemwxsoryetzkbmtieobfvrcqhkpbhgvtsurrrizfr br{display:block !important;}#jakemwxsoryetzkbmtieobfvrcqhkpbhgvtsurrrizfr span{background:transparent !important;}#jakemwxsoryetzkbmtieobfvrcqhkpbhgvtsurrrizfr div{border:0 !important;margin:0 !important;padding:0 !important;width:auto !important;letter-spacing:normal !important;font:13px Arial,Helvetica !important;text-align:left !important;text-shadow:none !important;text-transform:none !important;word-spacing:normal !important;}#jakemwxsoryetzkbmtieobfvrcqhkpbhgvtsurrrizfr a{font-weight:normal !important;background:none !important;text-decoration:underline !important;color:#fff !important;}@media print{#jakemwxsoryetzkbmtieobfvrcqhkpbhgvtsurrrizfr{display:none !important;}}</style></head>
<body style="">
<a name="top"></a>
<div id="topnav">
<div id="topnav-content" class="content">
<div id="login" class="float-right">
<span id="username-meta">Logged in as <a href="http://flowingdata.com/profile/">abresler</a> &nbsp;&nbsp;</span>
<a href="http://flowingdata.com/wp-login.php?action=logout&_wpnonce=d018091d15">Log out</a> </div>
</div>
<div class="clear-line"></div>
</div> 
<div id="header">
<div id="header-content" class="content">
<div id="nav">
<a href="http://flowingdata.com/">
<img src="./Mapping with Diffusion-based Cartograms_files/logo.png" class="float-left" scale="0">
</a>
<div id="pages" class="float-right">
<ul>
<li><a href="http://flowingdata.com/membership/">Membership</a></li>
<li><a href="http://flowingdata.com/learning/">Learning</a></li>
<li><a href="https://jobs.flowingdata.com/">Job Board</a></li>
<li><a href="http://flowingdata.com/category/projects/">Projects</a></li>
<li><a href="http://flowingdata.com/about/">About</a></li>
</ul>
</div> 
<div class="clear-line"></div>
</div> 
</div> 
</div> 
<div class="clear-line"></div>
<div id="main-wrapper">
<div id="content-wrapper" class="content">
<div class="post" id="post-26660">
<div id="content" class="single-long">
<div class="entry">
<div class="category">
<a href="http://flowingdata.com/category/tutorials/" title="View all posts in Tutorials" rel="category tag">Tutorials</a> &nbsp;/&nbsp; <a href="http://flowingdata.com/tag/cartogram/" rel="tag">cartogram</a>, <a href="http://flowingdata.com/tag/python/" rel="tag">Python</a>, <a href="http://flowingdata.com/tag/r/" rel="tag">R</a> <span class="members-note"><a href="http://flowingdata.com/members-only">Members Only</a></span> </div>
<h1>Mapping with Diffusion-based Cartograms</h1>
<div class="clear-line"></div>
<div class="author">
By <strong>Nathan Yau</strong>
</div> 
<div id="lead-in">
<p class="img-right"><img src="./Mapping with Diffusion-based Cartograms_files/ufo-cartogram-revised.png" class="attachment-long-form-thumb wp-post-image" alt="Diffusion-based Cartogram" width="425" height="320" src-orig="http://i1.wp.com/flowingdata.com/wp-content/uploads/2012/08/ufo-cartogram-revised.png?fit=425%2C9999" scale="2"></p>
<div class="entry-excerpt">
Sometimes these cartograms can distort areas beyond recognition, but they can also provide a better visual representation for a region with a wide range of subregions. At the least, they're fun to look at. </div>
<div id="tut-meta">
<div class="button-link"><a href="http://flowingdata.com/?s2member_file_download=2012/cartogram-tutorial.zip">Download Source</a></div>
<div class="clear-line"></div>
</div> 
<div class="clear-line"></div>
</div> 
<div class="entry-content">
<p>A challenge with choropleth maps — those colored maps often referred to as heat maps — is that larger regions always get more visual attention than smaller ones, no matter what metric is visualized. California always takes up more space than Rhode Island. Cartograms are one solution for this: Regions are sized by a variable rather than using color as the main visual cue. Although the rescaling comes at the sacrifice of geographic accuracy, so which one you use is still up to you and based on what works best for your data.</p>
<p>Some cartograms <a href="http://flowingdata.com/2008/08/06/map-of-olympic-medals-in-bubble-geographic-form/">use</a> <a href="http://elections.nytimes.com/2012/electoral-map">shapes</a> in place of the regions, some <a href="http://mbostock.github.com/d3/ex/cartogram.html">use the regions</a> but don't keep them connected, and others <a href="http://www.nytimes.com/imagepages/2007/03/17/nyregion/nyregionspecial2/20070318_TRAIN_GRAPHIC.html">modify the distance</a> in maps to represent something like commute time.</p>
<p><a href="http://www.pnas.org/content/101/20/7499.abstract">Diffusion-based cartograms</a>, created by Michael Gastner and Mark Newman in 2004, maintain geographic boundaries such that all regions stay continuous. This type of cartogram is the subject of this tutorial.</p>
<p>The <a href="http://flowingdata.com/2008/11/10/maps-and-cartograms-of-2008-presidential-election/">political cartograms</a> by Gastner and Newman, along with Cosma Shalizi, are perhaps the most popular in recent years. The ones that show <a href="http://www.ccs.neu.edu/home/amislove/twittermood/">mood on Twitter</a> were also shared quite a bit. You'll notice that the results of both look a lot like inkblots, so again, usability is up for debate, but hey, they're fun to make, so let's do it.</p>
<h2>Setup</h2>
<p>Before you get into how to make diffusion-based cartograms programatically, you might want to check out <a href="http://scapetoad.choros.ch/">ScapeToad</a>, which provides a click interface to make things relatively easy. All you need is a shapefile, select what you want to shape areas by, and the software does the rest for you. I tried it out with a few files from <a href="http://geocommons.com/">GeoCommons</a> and got results in a few minutes.</p>
<p><span class="tip"><a href="http://www.omegahat.org/Rcartogram/">Rcartogram</a> is an R interface into Cart, but it doesn't work with newer versions of R.</span>That said, if you can do it programmatically, it makes it easy to incorporate other charts or customizations later. In this tutorial you will use mainly two things: <a href="http://www-personal.umich.edu/~mejn/cart/">Cart</a> and <a href="http://www-personal.umich.edu/~mejn/cart/">R</a>. The former, by Newman, calculates the cartogram and the latter plots it. </p>
<p><span class="tip">This could be confusing for newbies but once you have a compiler installed, you won't have to do it again. And once the software is setup, the process is relatively straightforward.</span>R is a one-click install, but Cart is written in C (and was last updated in 2008) and you have to compile it before you can use it. In case you're unfamiliar with compiling it's basically the process of converting human-written and -readable code into software that a computer can understand. So you need to download and install a compiler if you haven't already. For OS X, this <a href="https://github.com/kennethreitz/osx-gcc-installer">one-click installer for gcc</a> did the trick. On Windows, you can get something from <a href="http://gcc.gnu.org/install/binaries.html">this resource list</a>. Cart also has a dependency on <a href="http://www.fftw.org/download.html">FFTW</a>, so you'll need to install that, too.</p>
<p>To sum up, you need:</p>
<ul>
<li>C compiler for Newman code (<a href="https://github.com/kennethreitz/osx-gcc-installer">OS X</a>, <a href="http://gcc.gnu.org/install/binaries.html">Windows</a>)</li>
<li><a href="http://www-personal.umich.edu/~mejn/cart/download/">Cart source code</a></li>
<li><a href="http://www.fftw.org/download.html">FFTW</a></li>
<li><a href="http://www.r-project.org/">R</a></li>
</ul>
<h3>Installing FFTW</h3>
<p>Once you have a C compiler installed, go to your terminal and to the directory FFTW is in. Enter the following, one line at a time:</p>
<div id="highlighter_43851" class="syntaxhighlighter  "><div class="bar"><div class="toolbar"><a href="http://flowingdata.com/2012/09/05/mapping-with-diffusion-based-cartograms/#viewSource" title="view source" class="item viewSource" style="width: 16px; height: 16px;">view source</a><div class="item copyToClipboard"><div style="display: block; cursor: pointer; text-align: center; width: 16px; height: 16px; top: auto; left: auto; position: static;"><div style="-webkit-transition: opacity 150ms ease-out; transition: opacity 150ms ease-out; background-image: url(chrome-extension://gofhjkjmkpinhpoiabjplobcaignabnl/icon_play.png); text-align: left; opacity: 0.25; border: 1px solid rgb(0, 0, 0); width: 100%; height: 100%; background-color: rgba(193, 217, 244, 0.498039); background-repeat: no-repeat no-repeat;"></div></div><embed width="16" height="16" id="highlighter_43851_clipboard" type="application/x-shockwave-flash" title="copy to clipboard" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_43851" menu="false" src="http://flowingdata.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter2/scripts/clipboard.swf" style="display: none !important;"></div><a href="http://flowingdata.com/2012/09/05/mapping-with-diffusion-based-cartograms/#printSource" title="print" class="item printSource" style="width: 16px; height: 16px;">print</a><a href="http://flowingdata.com/2012/09/05/mapping-with-diffusion-based-cartograms/#about" title="?" class="item about" style="width: 16px; height: 16px;">?</a></div></div><div class="lines"><div class="line alt1"><table><tbody><tr><td class="number"><code>1</code></td><td class="content"><code class="plain">./configure --</code><code class="functions">enable</code><code class="plain">-shared</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>2</code></td><td class="content"><code class="functions">make</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>3</code></td><td class="content"><code class="functions">make</code> <code class="functions">install</code></td></tr></tbody></table></div></div></div>
<p></p>
<h3>Compiling Cart</h3>
<p>To compile Cart, you can find instructions here, but browse where you downloaded Cart too, and enter the following:</p>
<div id="highlighter_271193" class="syntaxhighlighter  "><div class="bar"><div class="toolbar"><a href="http://flowingdata.com/2012/09/05/mapping-with-diffusion-based-cartograms/#viewSource" title="view source" class="item viewSource" style="width: 16px; height: 16px;">view source</a><div class="item copyToClipboard"><div style="display: block; cursor: pointer; text-align: center; width: 16px; height: 16px; top: auto; left: auto; position: static;"><div style="-webkit-transition: opacity 150ms ease-out; transition: opacity 150ms ease-out; background-image: url(chrome-extension://gofhjkjmkpinhpoiabjplobcaignabnl/icon_play.png); text-align: left; opacity: 0.25; border: 1px solid rgb(0, 0, 0); width: 100%; height: 100%; background-color: rgba(193, 217, 244, 0.498039); background-repeat: no-repeat no-repeat;"></div></div><embed width="16" height="16" id="highlighter_271193_clipboard" type="application/x-shockwave-flash" title="copy to clipboard" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_271193" menu="false" src="http://flowingdata.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter2/scripts/clipboard.swf" style="display: none !important;"></div><a href="http://flowingdata.com/2012/09/05/mapping-with-diffusion-based-cartograms/#printSource" title="print" class="item printSource" style="width: 16px; height: 16px;">print</a><a href="http://flowingdata.com/2012/09/05/mapping-with-diffusion-based-cartograms/#about" title="?" class="item about" style="width: 16px; height: 16px;">?</a></div></div><div class="lines"><div class="line alt1"><table><tbody><tr><td class="number"><code>1</code></td><td class="content"><code class="plain">gcc -O -o cart cart.c main.c -lfftw3 -lm</code></td></tr></tbody></table></div></div></div>
<p></p>
<h2>Process</h2>
<p>Setup is the hard part. Once you've got everything installed, the process of creating the cartogram is more straightforward, because the software does most of the work for you. The general process is:</p>
<ol>
<li>Get the formatted data</li>
<li>Create modified grid with Cart</li>
<li>Interpolate new map with Cart's sample script</li>
<li>Map new coordinates in R</li>
</ol>
<h2>Prepare Data</h2>
<p>First things first. You need the data and you need it in the right format. No data means no visualization. </p>
<p>Cart requires that the data be in a grid format such that each cell in the grid represent the corresponding region. Luckily, we already have that from our <a href="http://flowingdata.com/2012/02/07/how-to-make-a-contour-map/">contour map tutorial</a>. The data file, cnt_matrix.txt, is included in the the source of this tutorial.</p>
<p><span class="tip"><a href="http://www.pnas.org/content/101/20/7499.full.pdf+html">The paper</a> explains why you need to plug in averages.</span>If you take a quick look at the data matrix, you'll notice that it's sparse, filled with a lot of zeros. However, the Gastner and Newman algorithm requires that those zeros be replaced by the average of all the counts in the matrix. </p>
<p>This is easy to do in R. Replace the numbers in the matrix, and then save the result as a new text file, ufo-sea.txt. Take note of what your working directory is since you need to access the file in the next step. The directory that you compiled Cart is the simplest place to put it.</p>
<div id="highlighter_269737" class="syntaxhighlighter  "><div class="bar"><div class="toolbar"><a href="http://flowingdata.com/2012/09/05/mapping-with-diffusion-based-cartograms/#viewSource" title="view source" class="item viewSource" style="width: 16px; height: 16px;">view source</a><div class="item copyToClipboard"><div style="display: block; cursor: pointer; text-align: center; width: 16px; height: 16px; top: auto; left: auto; position: static;"><div style="-webkit-transition: opacity 150ms ease-out; transition: opacity 150ms ease-out; background-image: url(chrome-extension://gofhjkjmkpinhpoiabjplobcaignabnl/icon_play.png); text-align: left; opacity: 0.25; border: 1px solid rgb(0, 0, 0); width: 100%; height: 100%; background-color: rgba(193, 217, 244, 0.498039); background-repeat: no-repeat no-repeat;"></div></div><embed width="16" height="16" id="highlighter_269737_clipboard" type="application/x-shockwave-flash" title="copy to clipboard" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_269737" menu="false" src="http://flowingdata.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter2/scripts/clipboard.swf" style="display: none !important;"></div><a href="http://flowingdata.com/2012/09/05/mapping-with-diffusion-based-cartograms/#printSource" title="print" class="item printSource" style="width: 16px; height: 16px;">print</a><a href="http://flowingdata.com/2012/09/05/mapping-with-diffusion-based-cartograms/#about" title="?" class="item about" style="width: 16px; height: 16px;">?</a></div></div><div class="lines"><div class="line alt1"><table><tbody><tr><td class="number"><code>1</code></td><td class="content"><code class="comments"># Load data.</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>2</code></td><td class="content"><code class="plain">themat &lt;- </code><code class="functions">read.csv</code><code class="plain">(</code><code class="string">"cnt_matrix.txt"</code><code class="plain">)</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>3</code></td><td class="content"><code class="plain">numcols &lt;- </code><code class="functions">length</code><code class="plain">(themat[1,])</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>4</code></td><td class="content"><code class="plain">numrows &lt;- </code><code class="functions">length</code><code class="plain">(themat[,1])</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>5</code></td><td class="content"><code class="plain">meandensity &lt;- </code><code class="functions">sum</code><code class="plain">(themat) / (numcols*numrows)</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>6</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>7</code></td><td class="content"><code class="comments"># Replace zeros with mean density.</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>8</code></td><td class="content"><code class="plain">nonzero &lt;- </code><code class="functions">function</code><code class="plain">(x) { </code><code class="functions">if </code><code class="plain">(x == 0) { </code><code class="functions">return</code><code class="plain">(meandensity); } </code><code class="keyword">else</code> <code class="plain">{ </code><code class="functions">return</code><code class="plain">(x); } }</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>9</code></td><td class="content"><code class="plain">themat2 &lt;- </code><code class="functions">apply</code><code class="plain">(themat, FUN=</code><code class="string">"nonzero"</code><code class="plain">, MARGIN=</code><code class="functions">c</code><code class="plain">(1,2))</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>10</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>11</code></td><td class="content"><code class="comments"># Save new matrix.</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>12</code></td><td class="content"><code class="functions">write.table</code><code class="plain">(themat2, file=</code><code class="string">"ufo-sea.txt"</code><code class="plain">, quote=</code><code class="keyword">FALSE</code><code class="plain">, sep=</code><code class="string">" "</code><code class="plain">, row.names=</code><code class="keyword">FALSE</code><code class="plain">, col.names=</code><code class="keyword">FALSE</code><code class="plain">)</code></td></tr></tbody></table></div></div></div>
<p></p>
<h2>Find Translated Coordinates</h2>
<p><span class="tip">The new file you just created, ufo-seat.txt, needs to be in the same directory as cart. If not, you have to use the full file path.</span>Then go back to the terminal and run Cart to find the translate coordinates. The first argument is the width of the matrix, the second argument is the height, the third is the source data, and the last argument is where the resulting data is saved.</p>
<div id="highlighter_844862" class="syntaxhighlighter  "><div class="bar"><div class="toolbar"><a href="http://flowingdata.com/2012/09/05/mapping-with-diffusion-based-cartograms/#viewSource" title="view source" class="item viewSource" style="width: 16px; height: 16px;">view source</a><div class="item copyToClipboard"><div style="display: block; cursor: pointer; text-align: center; width: 16px; height: 16px; top: auto; left: auto; position: static;"><div style="-webkit-transition: opacity 150ms ease-out; transition: opacity 150ms ease-out; background-image: url(chrome-extension://gofhjkjmkpinhpoiabjplobcaignabnl/icon_play.png); text-align: left; opacity: 0.25; border: 1px solid rgb(0, 0, 0); width: 100%; height: 100%; background-color: rgba(193, 217, 244, 0.498039); background-repeat: no-repeat no-repeat;"></div></div><embed width="16" height="16" id="highlighter_844862_clipboard" type="application/x-shockwave-flash" title="copy to clipboard" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_844862" menu="false" src="http://flowingdata.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter2/scripts/clipboard.swf" style="display: none !important;"></div><a href="http://flowingdata.com/2012/09/05/mapping-with-diffusion-based-cartograms/#printSource" title="print" class="item printSource" style="width: 16px; height: 16px;">print</a><a href="http://flowingdata.com/2012/09/05/mapping-with-diffusion-based-cartograms/#about" title="?" class="item about" style="width: 16px; height: 16px;">?</a></div></div><div class="lines"><div class="line alt1"><table><tbody><tr><td class="number"><code>1</code></td><td class="content"><code class="plain">./cart 256 104 ufo-sea.txt ufo_out.dat</code></td></tr></tbody></table></div></div></div>
<p></p>
<p>This provides matrix that's been pulled in the direction where there are high counts. For kicks and giggles (and to see if everything worked correctly), you can plot the points in R.</p>
<div id="highlighter_994272" class="syntaxhighlighter  "><div class="bar"><div class="toolbar"><a href="http://flowingdata.com/2012/09/05/mapping-with-diffusion-based-cartograms/#viewSource" title="view source" class="item viewSource" style="width: 16px; height: 16px;">view source</a><div class="item copyToClipboard"><div style="display: block; cursor: pointer; text-align: center; width: 16px; height: 16px; top: auto; left: auto; position: static;"><div style="-webkit-transition: opacity 150ms ease-out; transition: opacity 150ms ease-out; background-image: url(chrome-extension://gofhjkjmkpinhpoiabjplobcaignabnl/icon_play.png); text-align: left; opacity: 0.25; border: 1px solid rgb(0, 0, 0); width: 100%; height: 100%; background-color: rgba(193, 217, 244, 0.498039); background-repeat: no-repeat no-repeat;"></div></div><embed width="16" height="16" id="highlighter_994272_clipboard" type="application/x-shockwave-flash" title="copy to clipboard" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_994272" menu="false" src="http://flowingdata.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter2/scripts/clipboard.swf" style="display: none !important;"></div><a href="http://flowingdata.com/2012/09/05/mapping-with-diffusion-based-cartograms/#printSource" title="print" class="item printSource" style="width: 16px; height: 16px;">print</a><a href="http://flowingdata.com/2012/09/05/mapping-with-diffusion-based-cartograms/#about" title="?" class="item about" style="width: 16px; height: 16px;">?</a></div></div><div class="lines"><div class="line alt1"><table><tbody><tr><td class="number"><code>1</code></td><td class="content"><code class="plain">ufo.cart &lt;- </code><code class="functions">read.table</code><code class="plain">(</code><code class="string">"./cart/ufo_out.dat"</code><code class="plain">, sep=</code><code class="string">" "</code><code class="plain">, header=</code><code class="keyword">FALSE</code><code class="plain">)</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>2</code></td><td class="content"><code class="functions">plot</code><code class="plain">(0, 0, xlim=</code><code class="functions">c</code><code class="plain">(0,256), ylim=</code><code class="functions">c</code><code class="plain">(0, 104), type=</code><code class="string">"n"</code><code class="plain">)</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>3</code></td><td class="content"><code class="functions">points</code><code class="plain">(ufo.cart$V1, 104-ufo.cart$V2, col=</code><code class="string">"gray"</code><code class="plain">, cex=0.2, pch=20)</code></td></tr></tbody></table></div></div></div>
<p></p>
<p>Here's what it looks like:</p>
<p><span class="tip">Translated coordinates computed by Cart.</span><img src="./Mapping with Diffusion-based Cartograms_files/Cartogram-dots.png" alt="" title="Cartogram dots" class="alignnone size-medium wp-image-26673" width="625" height="417" src-orig="http://i2.wp.com/flowingdata.com/wp-content/uploads/2012/09/Cartogram-dots.png?resize=625%2C417" scale="2"></p>
<p>This grid of points will be used later to compute the final cartogram.</p>
<h2>Get State Boundary Lines</h2>
<p><span class="tip">Download and install the maps package in R via the package installer in the menu.</span>Before you make a cartogram though, you need some actual coordinates to turn into a cartogram. You can get latitude and longitude coordinates for state boundaries from the maps package in R.</p>
<div id="highlighter_397788" class="syntaxhighlighter  "><div class="bar"><div class="toolbar"><a href="http://flowingdata.com/2012/09/05/mapping-with-diffusion-based-cartograms/#viewSource" title="view source" class="item viewSource" style="width: 16px; height: 16px;">view source</a><div class="item copyToClipboard"><div style="display: block; cursor: pointer; text-align: center; width: 16px; height: 16px; top: auto; left: auto; position: static;"><div style="-webkit-transition: opacity 150ms ease-out; transition: opacity 150ms ease-out; background-image: url(chrome-extension://gofhjkjmkpinhpoiabjplobcaignabnl/icon_play.png); text-align: left; opacity: 0.25; border: 1px solid rgb(0, 0, 0); width: 100%; height: 100%; background-color: rgba(193, 217, 244, 0.498039); background-repeat: no-repeat no-repeat;"></div></div><embed width="16" height="16" id="highlighter_397788_clipboard" type="application/x-shockwave-flash" title="copy to clipboard" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_397788" menu="false" src="http://flowingdata.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter2/scripts/clipboard.swf" style="display: none !important;"></div><a href="http://flowingdata.com/2012/09/05/mapping-with-diffusion-based-cartograms/#printSource" title="print" class="item printSource" style="width: 16px; height: 16px;">print</a><a href="http://flowingdata.com/2012/09/05/mapping-with-diffusion-based-cartograms/#about" title="?" class="item about" style="width: 16px; height: 16px;">?</a></div></div><div class="lines"><div class="line alt1"><table><tbody><tr><td class="number"><code>1</code></td><td class="content"><code class="functions">library</code><code class="plain">(maps)</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>2</code></td><td class="content"><code class="plain">m &lt;- </code><code class="functions">map</code><code class="plain">(</code><code class="string">"state"</code><code class="plain">)</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>3</code></td><td class="content"><code class="plain">x &lt;- (m$x - lng_NW) / (lng_SE - lng_NW) * numcols</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>4</code></td><td class="content"><code class="plain">y &lt;- (m$y - lat_NW) / (lat_SE - lat_NW) * numrows</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>5</code></td><td class="content"><code class="plain">xy.df &lt;- </code><code class="functions">data.frame</code><code class="plain">(x, y)</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>6</code></td><td class="content"><code class="functions">write.table</code><code class="plain">(xy.df, </code><code class="string">"boundaries.dat"</code><code class="plain">, quote=</code><code class="keyword">FALSE</code><code class="plain">, sep=</code><code class="string">" "</code><code class="plain">, row.names=</code><code class="keyword">FALSE</code><code class="plain">, col.names=</code><code class="keyword">FALSE</code><code class="plain">)</code></td></tr></tbody></table></div></div></div>
<p></p>
<p>The code above stores the coordinates in the <code>xy.df</code> dataframe, and then writes the data to boundaries.data.</p>
<p>In case you want to map the coordinates to see what it looks like:</p>
<div id="highlighter_936246" class="syntaxhighlighter  "><div class="bar"><div class="toolbar"><a href="http://flowingdata.com/2012/09/05/mapping-with-diffusion-based-cartograms/#viewSource" title="view source" class="item viewSource" style="width: 16px; height: 16px;">view source</a><div class="item copyToClipboard"><div style="display: block; cursor: pointer; text-align: center; width: 16px; height: 16px; top: auto; left: auto; position: static;"><div style="-webkit-transition: opacity 150ms ease-out; transition: opacity 150ms ease-out; background-image: url(chrome-extension://gofhjkjmkpinhpoiabjplobcaignabnl/icon_play.png); text-align: left; opacity: 0.25; border: 1px solid rgb(0, 0, 0); width: 100%; height: 100%; background-color: rgba(193, 217, 244, 0.498039); background-repeat: no-repeat no-repeat;"></div></div><embed width="16" height="16" id="highlighter_936246_clipboard" type="application/x-shockwave-flash" title="copy to clipboard" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_936246" menu="false" src="http://flowingdata.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter2/scripts/clipboard.swf" style="display: none !important;"></div><a href="http://flowingdata.com/2012/09/05/mapping-with-diffusion-based-cartograms/#printSource" title="print" class="item printSource" style="width: 16px; height: 16px;">print</a><a href="http://flowingdata.com/2012/09/05/mapping-with-diffusion-based-cartograms/#about" title="?" class="item about" style="width: 16px; height: 16px;">?</a></div></div><div class="lines"><div class="line alt1"><table><tbody><tr><td class="number"><code>1</code></td><td class="content"><code class="comments"># Map regular boundary lines.</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>2</code></td><td class="content"><code class="functions">plot</code><code class="plain">(x, numrows-y, type=</code><code class="string">"n"</code><code class="plain">, xlim=</code><code class="functions">c</code><code class="plain">(0,256), ylim=</code><code class="functions">c</code><code class="plain">(0, 104))</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>3</code></td><td class="content"><code class="functions">lines</code><code class="plain">(x, numrows-y, lwd=0.2)</code></td></tr></tbody></table></div></div></div>
<p></p>
<p>You get a standard-looking map. The projection is ugly, but you get the idea.</p>
<p><span class="tip">State boundaries plotted as x- and y- coordinates.</span><img src="./Mapping with Diffusion-based Cartograms_files/state-boundaries.png" alt="" title="state boundaries" class="alignnone size-medium wp-image-26675" width="625" height="425" src-orig="http://i0.wp.com/flowingdata.com/wp-content/uploads/2012/09/state-boundaries.png?resize=625%2C425" scale="2"></p>
<h2>Interpolate New Boundary Lines</h2>
<p>Now go back to the terminal. Newman provides a small script called interp to figure out the new coordinates based on the new grid computed by Cart. First though, like Cart, you have to compile interp.</p>
<div id="highlighter_906021" class="syntaxhighlighter  "><div class="bar"><div class="toolbar"><a href="http://flowingdata.com/2012/09/05/mapping-with-diffusion-based-cartograms/#viewSource" title="view source" class="item viewSource" style="width: 16px; height: 16px;">view source</a><div class="item copyToClipboard"><div style="display: block; cursor: pointer; text-align: center; width: 16px; height: 16px; top: auto; left: auto; position: static;"><div style="-webkit-transition: opacity 150ms ease-out; transition: opacity 150ms ease-out; background-image: url(chrome-extension://gofhjkjmkpinhpoiabjplobcaignabnl/icon_play.png); text-align: left; opacity: 0.25; border: 1px solid rgb(0, 0, 0); width: 100%; height: 100%; background-color: rgba(193, 217, 244, 0.498039); background-repeat: no-repeat no-repeat;"></div></div><embed width="16" height="16" id="highlighter_906021_clipboard" type="application/x-shockwave-flash" title="copy to clipboard" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_906021" menu="false" src="http://flowingdata.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter2/scripts/clipboard.swf" style="display: none !important;"></div><a href="http://flowingdata.com/2012/09/05/mapping-with-diffusion-based-cartograms/#printSource" title="print" class="item printSource" style="width: 16px; height: 16px;">print</a><a href="http://flowingdata.com/2012/09/05/mapping-with-diffusion-based-cartograms/#about" title="?" class="item about" style="width: 16px; height: 16px;">?</a></div></div><div class="lines"><div class="line alt1"><table><tbody><tr><td class="number"><code>1</code></td><td class="content"><code class="plain">gcc -O -o interp interp.c</code></td></tr></tbody></table></div></div></div>
<p></p>
<p>Then you can run interp similarly to how you ran cart. The command below passes the boundary coordinates to interp, using the skewed coordinates stored in ufo_out.dat, and then spits out the results into boundaries_cart.dat.</p>
<div id="highlighter_984926" class="syntaxhighlighter  "><div class="bar"><div class="toolbar"><a href="http://flowingdata.com/2012/09/05/mapping-with-diffusion-based-cartograms/#viewSource" title="view source" class="item viewSource" style="width: 16px; height: 16px;">view source</a><div class="item copyToClipboard"><div style="display: block; cursor: pointer; text-align: center; width: 16px; height: 16px; top: auto; left: auto; position: static;"><div style="-webkit-transition: opacity 150ms ease-out; transition: opacity 150ms ease-out; background-image: url(chrome-extension://gofhjkjmkpinhpoiabjplobcaignabnl/icon_play.png); text-align: left; opacity: 0.25; border: 1px solid rgb(0, 0, 0); width: 100%; height: 100%; background-color: rgba(193, 217, 244, 0.498039); background-repeat: no-repeat no-repeat;"></div></div><embed width="16" height="16" id="highlighter_984926_clipboard" type="application/x-shockwave-flash" title="copy to clipboard" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_984926" menu="false" src="http://flowingdata.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter2/scripts/clipboard.swf" style="display: none !important;"></div><a href="http://flowingdata.com/2012/09/05/mapping-with-diffusion-based-cartograms/#printSource" title="print" class="item printSource" style="width: 16px; height: 16px;">print</a><a href="http://flowingdata.com/2012/09/05/mapping-with-diffusion-based-cartograms/#about" title="?" class="item about" style="width: 16px; height: 16px;">?</a></div></div><div class="lines"><div class="line alt1"><table><tbody><tr><td class="number"><code>1</code></td><td class="content"><code class="functions">cat</code> <code class="plain">boundaries.dat | ./interp 256 104 ufo_out.dat &gt; boundaries_cart.dat</code></td></tr></tbody></table></div></div></div>
<p></p>
<p>Now you can load the new boundaries into R and plot them. Again, make sure you have the right working directory. Otherwise, you have to adjust the file path in <code>read.csv()</code>.</p>
<div id="highlighter_774656" class="syntaxhighlighter  "><div class="bar"><div class="toolbar"><a href="http://flowingdata.com/2012/09/05/mapping-with-diffusion-based-cartograms/#viewSource" title="view source" class="item viewSource" style="width: 16px; height: 16px;">view source</a><div class="item copyToClipboard"><div style="display: block; cursor: pointer; text-align: center; width: 16px; height: 16px; top: auto; left: auto; position: static;"><div style="-webkit-transition: opacity 150ms ease-out; transition: opacity 150ms ease-out; background-image: url(chrome-extension://gofhjkjmkpinhpoiabjplobcaignabnl/icon_play.png); text-align: left; opacity: 0.25; border: 1px solid rgb(0, 0, 0); width: 100%; height: 100%; background-color: rgba(193, 217, 244, 0.498039); background-repeat: no-repeat no-repeat;"></div></div><embed width="16" height="16" id="highlighter_774656_clipboard" type="application/x-shockwave-flash" title="copy to clipboard" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_774656" menu="false" src="http://flowingdata.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter2/scripts/clipboard.swf" style="display: none !important;"></div><a href="http://flowingdata.com/2012/09/05/mapping-with-diffusion-based-cartograms/#printSource" title="print" class="item printSource" style="width: 16px; height: 16px;">print</a><a href="http://flowingdata.com/2012/09/05/mapping-with-diffusion-based-cartograms/#about" title="?" class="item about" style="width: 16px; height: 16px;">?</a></div></div><div class="lines"><div class="line alt1"><table><tbody><tr><td class="number"><code>1</code></td><td class="content"><code class="comments"># Map cartogrammed boundary lines.</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>2</code></td><td class="content"><code class="plain">xy.cart &lt;- </code><code class="functions">read.csv</code><code class="plain">(</code><code class="string">"cart/boundaries_cart.dat"</code><code class="plain">, header=</code><code class="keyword">FALSE</code><code class="plain">, sep=</code><code class="string">" "</code><code class="plain">)</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>3</code></td><td class="content"><code class="functions">plot</code><code class="plain">(0, 0, xlim=</code><code class="functions">c</code><code class="plain">(0,256), ylim=</code><code class="functions">c</code><code class="plain">(0, 104), type=</code><code class="string">"n"</code><code class="plain">)</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>4</code></td><td class="content"><code class="functions">lines</code><code class="plain">(xy.cart$V1, numrows-xy.cart$V2)</code></td></tr></tbody></table></div></div></div>
<p></p>
<p>The result: a cartogram that represents the number of UFO sightings across the United States.</p>
<p><img src="./Mapping with Diffusion-based Cartograms_files/Cartogram-plot.png" alt="" title="Cartogram plot" class="alignnone size-medium wp-image-26674" width="625" height="415" src-orig="http://i1.wp.com/flowingdata.com/wp-content/uploads/2012/09/Cartogram-plot.png?resize=625%2C415" scale="2"></p>
<h2>Customize Colors</h2>
<p><span class="tip">Check out the tutorial on <a href="http://flowingdata.com/2012/01/19/using-color-scales-and-palettes-in-r/">colors in R</a> for further customizations.</span>Just for good measure, you can add color and customize the cartogram if you like. If, say, you wanted to add a gray background, make the boundaries purple, and thicken the lines, you could do the following:</p>
<div id="highlighter_325145" class="syntaxhighlighter  "><div class="bar"><div class="toolbar"><a href="http://flowingdata.com/2012/09/05/mapping-with-diffusion-based-cartograms/#viewSource" title="view source" class="item viewSource" style="width: 16px; height: 16px;">view source</a><div class="item copyToClipboard"><div style="display: block; cursor: pointer; text-align: center; width: 16px; height: 16px; top: auto; left: auto; position: static;"><div style="-webkit-transition: opacity 150ms ease-out; transition: opacity 150ms ease-out; background-image: url(chrome-extension://gofhjkjmkpinhpoiabjplobcaignabnl/icon_play.png); text-align: left; opacity: 0.25; border: 1px solid rgb(0, 0, 0); width: 100%; height: 100%; background-color: rgba(193, 217, 244, 0.498039); background-repeat: no-repeat no-repeat;"></div></div><embed width="16" height="16" id="highlighter_325145_clipboard" type="application/x-shockwave-flash" title="copy to clipboard" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_325145" menu="false" src="http://flowingdata.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter2/scripts/clipboard.swf" style="display: none !important;"></div><a href="http://flowingdata.com/2012/09/05/mapping-with-diffusion-based-cartograms/#printSource" title="print" class="item printSource" style="width: 16px; height: 16px;">print</a><a href="http://flowingdata.com/2012/09/05/mapping-with-diffusion-based-cartograms/#about" title="?" class="item about" style="width: 16px; height: 16px;">?</a></div></div><div class="lines"><div class="line alt1"><table><tbody><tr><td class="number"><code>1</code></td><td class="content"><code class="comments"># Add some color</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>2</code></td><td class="content"><code class="functions">plot</code><code class="plain">(0, 0, xlim=</code><code class="functions">c</code><code class="plain">(0,256), ylim=</code><code class="functions">c</code><code class="plain">(0, 104), type=</code><code class="string">"n"</code><code class="plain">, xaxt=</code><code class="string">"n"</code><code class="plain">, yaxt=</code><code class="string">"n"</code><code class="plain">, xlab=</code><code class="keyword">NA</code><code class="plain">, ylab=</code><code class="keyword">NA</code><code class="plain">)</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>3</code></td><td class="content"><code class="functions">rect</code><code class="plain">(-20, -20, 300, 130, col=</code><code class="string">"#cccccc"</code><code class="plain">)</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>4</code></td><td class="content"><code class="functions">lines</code><code class="plain">(xy.cart$V1, numrows-xy.cart$V2, col=</code><code class="string">"purple"</code><code class="plain">, lwd=2)</code></td></tr></tbody></table></div></div></div>
<p></p>
<p><img src="./Mapping with Diffusion-based Cartograms_files/Cartogram-with-color.png" alt="" title="Cartogram with color" class="alignnone size-medium wp-image-26676" width="625" height="328" src-orig="http://i0.wp.com/flowingdata.com/wp-content/uploads/2012/09/Cartogram-with-color.png?resize=625%2C328" scale="2"></p>
<h2>Wrapping Up</h2>
<p>The diffusion-based cartogram might not always be the best representation, because it can often look like a big blob, but it can work in some cases. Plus, once you have your computer setup, it's not too hard to make one. Finally, because existing code does most of the work, you don't have to write that much, which after installation, makes process the hardest part. Now you're covered in that department.</p>
<div class="clear-line"></div>
</div> 
</div> 
<div class="clear-line"></div>
<div id="end"></div>
 
<span id="comments"></span>
<div style="width:625px">
<div id="comments-block">
<h2>6 Comments</h2>
<ul class="commentlist">
<li class="comment byuser comment-author-paldhous even thread-even depth-1" id="li-comment-156996">
<div id="comment-156996" class="">
<div class="avatar">
<img alt="" src="./Mapping with Diffusion-based Cartograms_files/d0eb673ff346fd34a73c868d0f628f09" class="avatar avatar-50 photo" height="50" width="50" originals="50" src-orig="http://1.gravatar.com/avatar/d0eb673ff346fd34a73c868d0f628f09?s=50&amp;d=http%3A%2F%2Fflowingdata.com%2Fwp-content%2Fthemes%2Fflowingdata-4-8%2Fimages%2Fblank-square.png%3Fs%3D50&amp;r=PG" scale="2"> </div> 
<div class="comment-content">
<div class="comment-author vcard">
<cite class="fn">Peter Aldhous</cite> <span class="comment-meta">— <a href="http://flowingdata.com/2012/09/05/mapping-with-diffusion-based-cartograms/#comment-156996">September 6, 2012 at 7:47 am</a>
</span>
</div>
<div class="comment-text"><p>Hi Nathan,</p>
<p>I’m really pleased with results using ScapeToad. Here’s an example looking at different measures of national “wealth”: <a href="http://www.peteraldhous.com/fourways.html" rel="nofollow">http://www.peteraldhous.com/fourways.html</a></p>
<p>I imported the cartogram shapefiles into QGIS, where I colored the maps by quintiles on the per capita/index measures. I added the legend in Illustrator, then made the slideshow using SlidesJS.</p>
<p>Best wishes,</p>
<p>Peter</p>
</div>
<div class="reply">
</div>
</div> 
<div class="clear-line"></div>
</div>
<ul class="children">
<li class="comment byuser comment-author-swhi2233 odd alt depth-2" id="li-comment-210668">
<div id="comment-210668" class="">
<div class="avatar">
<img alt="" src="./Mapping with Diffusion-based Cartograms_files/a3ffdd84845b112b1aca205ee293f6c1" class="avatar avatar-50 photo" height="50" width="50" originals="50" src-orig="http://0.gravatar.com/avatar/a3ffdd84845b112b1aca205ee293f6c1?s=50&amp;d=http%3A%2F%2Fflowingdata.com%2Fwp-content%2Fthemes%2Fflowingdata-4-8%2Fimages%2Fblank-square.png%3Fs%3D50&amp;r=PG" scale="2"> </div> 
<div class="comment-content">
<div class="comment-author vcard">
<cite class="fn">Sarah White</cite> <span class="comment-meta">— <a href="http://flowingdata.com/2012/09/05/mapping-with-diffusion-based-cartograms/#comment-210668">May 5, 2013 at 11:03 am</a>
</span>
</div>
<div class="comment-text"><p>Hi Peter,</p>
<p>Really like the charts you produced using ScapeToad. I want to construct something similar to the maps that you have produced from my own international dataset. I have my shp file from Natural Earth, but I am stuck on how to merge my statistical variable (in csv format) with the shp file. Any suggestions for how to do this? I have QGIS 1.3 – seems like it should be simple but I am new to the program.</p>
<p>Thanks,</p>
<p>Sarah</p>
</div>
<div class="reply">
</div>
</div> 
<div class="clear-line"></div>
</div>
<ul class="children">
<li class="comment byuser comment-author-paldhous even depth-3" id="li-comment-210700">
<div id="comment-210700" class="">
<div class="avatar">
<img alt="" src="./Mapping with Diffusion-based Cartograms_files/d0eb673ff346fd34a73c868d0f628f09" class="avatar avatar-50 photo" height="50" width="50" originals="50" src-orig="http://1.gravatar.com/avatar/d0eb673ff346fd34a73c868d0f628f09?s=50&amp;d=http%3A%2F%2Fflowingdata.com%2Fwp-content%2Fthemes%2Fflowingdata-4-8%2Fimages%2Fblank-square.png%3Fs%3D50&amp;r=PG" scale="2"> </div> 
<div class="comment-content">
<div class="comment-author vcard">
<cite class="fn">Peter Aldhous</cite> <span class="comment-meta">— <a href="http://flowingdata.com/2012/09/05/mapping-with-diffusion-based-cartograms/#comment-210700">May 6, 2013 at 7:25 am</a>
</span>
</div>
<div class="comment-text"><p>Hi Sarah,</p>
<p>There are a couple of ways to do this. First, you can try installing the mmqgis plugin for QGIS (Plugins&gt;Fetch Python Plugins). Once that is installed, select (Plugins&gt;mmqgis&gt;Transfer&gt;Attributes Join from CSV file). That should allow you to select you CSV and shapefile, and the field to join on, and create a new shapefile.</p>
<p>In practice, I’ve found this a little buggy, so for the “Four Ways To View The World’s Wellbeing” I performed the join in Access, making sure to use a LEFT JOIN on the shapefile, so I got all the records from that, and returned empty fields if the CSV has no data. If you use an INNER JOIN, you’ll lose the countries for which there is no data.</p>
<p>Then I exported the query as a DBF flle. I think I used dBASE IV format – you may need to experiment. You can then use that DBF file a copy of the original shapefile; just make sure all the component files within the shapefile the same root name.</p>
<p>You might want to upgrade to a newer version of QGIS, too.</p>
<p>Best wishes,</p>
<p>Peter</p>
</div>
<div class="reply">
</div>
</div> 
<div class="clear-line"></div>
</div>
</li> 
</ul> 
</li> 
</ul> 
</li> 
<li class="comment byuser comment-author-joonomics odd alt thread-odd thread-alt depth-1" id="li-comment-159627">
<div id="comment-159627" class="">
<div class="avatar">
<img alt="" src="./Mapping with Diffusion-based Cartograms_files/b9f05f89bbbd0fdeb14c989ed0f82bf1" class="avatar avatar-50 photo" height="50" width="50" originals="50" src-orig="http://1.gravatar.com/avatar/b9f05f89bbbd0fdeb14c989ed0f82bf1?s=50&amp;d=http%3A%2F%2Fflowingdata.com%2Fwp-content%2Fthemes%2Fflowingdata-4-8%2Fimages%2Fblank-square.png%3Fs%3D50&amp;r=PG" scale="2"> </div> 
<div class="comment-content">
<div class="comment-author vcard">
<cite class="fn">Joon Yong An</cite> <span class="comment-meta">— <a href="http://flowingdata.com/2012/09/05/mapping-with-diffusion-based-cartograms/#comment-159627">September 9, 2012 at 11:02 pm</a>
</span>
</div>
<div class="comment-text"><p>Hi guys</p>
<p>How can I find other countries or cities? I’d like to find Australia? I couldn’t find the function in the package manual as you expect…</p>
</div>
<div class="reply">
</div>
</div> 
<div class="clear-line"></div>
</div>
<ul class="children">
<li class="comment byuser comment-author-nathany bypostauthor even depth-2" id="li-comment-159901">
<div id="comment-159901" class="flowingdata-author">
<div class="avatar">
<img alt="" src="./Mapping with Diffusion-based Cartograms_files/a61decc5c78c05770cb107e4c5cbbb33" class="avatar avatar-50 photo" height="50" width="50" originals="50" src-orig="http://0.gravatar.com/avatar/a61decc5c78c05770cb107e4c5cbbb33?s=50&amp;d=http%3A%2F%2Fflowingdata.com%2Fwp-content%2Fthemes%2Fflowingdata-4-8%2Fimages%2Fblank-square.png%3Fs%3D50&amp;r=PG" scale="2"> </div> 
<div class="comment-content">
<div class="comment-author vcard">
<cite class="fn"><a href="http://flowingdata.com/about-nathan" rel="external nofollow" class="url">Nathan Yau</a></cite> <span class="comment-meta">— <a href="http://flowingdata.com/2012/09/05/mapping-with-diffusion-based-cartograms/#comment-159901">September 10, 2012 at 10:57 am</a>
</span>
</div>
<div class="comment-text"><p>@Joon – Try this:</p>
<p><code>library(maps)<br>
australia &lt; - map(database="world", regions="australia")<br>
</code></p>
<p>Also, you might want to check out the docs for the <code>map()</code> function for more examples.</p>
</div>

      		<div class="reply">
         		      		</div>
     	</div><!-- @end comment-content -->
		<div class="clear-line"></div>
		</div>

</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
	
   	<li class="comment byuser comment-author-xuer-chen odd alt thread-even depth-1" id="li-comment-189142">
		<div id="comment-189142" class="">
	  	<div class="avatar">
			<img alt="" src="./Mapping with Diffusion-based Cartograms_files/dc3f579faf4e20288a1fd40d94c48b72" class="avatar avatar-50 photo" height="50" width="50" originals="50" src-orig="http://1.gravatar.com/avatar/dc3f579faf4e20288a1fd40d94c48b72?s=50&amp;d=http%3A%2F%2Fflowingdata.com%2Fwp-content%2Fthemes%2Fflowingdata-4-8%2Fimages%2Fblank-square.png%3Fs%3D50&amp;r=PG" scale="2">	  	</div><!-- @end gravatar -->
		
		<div class="comment-content">
      		<div class="comment-author vcard"> 
				<cite class="fn">xuer chen</cite>				<span class="comment-meta">— <a href="http://flowingdata.com/2012/09/05/mapping-with-diffusion-based-cartograms/#comment-189142">November 10, 2012 at 7:24 am</a>
					</span>
      		</div>
      		
			<div class="comment-text"><p>Hi, Nathan, thanks for your great work. But I have one problem(may be stupid…) when trying run cart (./cart 256 104 ufo-sea.txt ufo_out.dat<br>
), terminal told me No such file or directory…i’M SURE cart is in the present directory also the ufo-sea.txt…Is it possible my cart is not installed successfully? how can i test it? Thanks!</p>
</div>

      		<div class="reply">
         		      		</div>
     	</div><!-- @end comment-content -->
		<div class="clear-line"></div>
		</div>

</li><!-- #comment-## -->
		</ul>
		
	</div><!-- @end comments-block -->
	

</div>				
	
				
	
	</div>
</div><!-- end content -->
		

</div><!-- end content-wrapper -->

</div><!-- end main-wrapper -->


<div id="footer">
    <div id="footer-container" class="content">
        
        <div class="float-left" style="width:32%;margin-right:5%;">
            <div id="about" class="sec">
                <h3>About</h3>
    	        <p>FlowingData explores how designers, statisticians, and computer scientists are using data to understand ourselves better — mainly through data visualization.</p> 
    	        <p>As for me, I'm Nathan Yau, and I have a PhD in statistics, with a background in eating.</p>
    	        <p><a href="http://flowingdata.com/about/">More...</a></p>
    	    </div>
    	</div>
    	
    	<div class="float-left" style="width:36%;margin-right:5%;">
            <div id="book-single" class="sec">
                <h3>Books</h3>
    			<ul id="books" style="margin-bottom:0">
    			    <li>
    			        <a href="http://flowingdata.com/data-points/"><img src="./Mapping with Diffusion-based Cartograms_files/DataPoints60x75.png" title="Data Points" class="img-left" style="margin-bottom:0" scale="0"><strong>Data Points</strong><br>Visualization that Means Something</a><br>
    					    <div class="clear-line"></div>
    			    </li>
    				<li><a href="http://flowingdata.com/visualize-this/"><img src="./Mapping with Diffusion-based Cartograms_files/flowingdata60x79.jpg" title="Visualize This" class="img-left" style="margin-bottom:0" scale="0"><strong>Visualize This</strong><br>The FlowingData Guide to Design, Visualization, and Statistics</a><br>
    					<div class="clear-line"></div>
    				</li>
    			</ul>
    		</div><!-- @end books -->
    		
        </div>
        
        <div class="float-left" style="width:22%">
            <div id="follow" class="sec">
                <h3>Follow</h3>
                <p>
                    <a href="http://twitter.com/flowingdata">Twitter</a> &nbsp;•&nbsp; 
                    <a href="http://facebook.com/flowingdata">Facebook</a> &nbsp;•&nbsp;
                    <a href="http://eepurl.com/icL0o">Email</a> &nbsp;•&nbsp;
                    <a href="http://flowingdata.com/feed">RSS</a>
                </p>
            </div>
            <div id="misc" class="sec">
                <h3>Miscellaneous</h3>
                <a href="http://flowingdata.com/contact">Contact</a> &nbsp;•&nbsp; 
    			<a href="http://flowingdata.com/advertise">Sponsorship</a>  &nbsp;•&nbsp; 
    			<a href="http://flowingdata.bigcartel.com/">Shop</a><a>
            </a></div><a>
            
        </a></div><a>
        <div class="clear-line"></div>
		
    </a></div><!-- @end #footer-container --><a>
</a></div><!-- @end #footer --><a>
</a><div id="bottom"><a>
    Unless otherwise noted, graphics and words by me are licensed under </a><a href="http://creativecommons.org/licenses/by-nc/3.0/us/">Creative Commons BY-NC</a>. Contact original authors for everything else.
</div>


<!-- tracker added by Ultimate Google Analytics plugin v1.6.0: http://www.oratransplant.nl/uga -->
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script><script src="./Mapping with Diffusion-based Cartograms_files/ga.js" type="text/javascript"></script>
<script type="text/javascript">
var pageTracker = _gat._getTracker("UA-865100-4");
pageTracker._initData();
pageTracker._trackPageview();
</script>
<script type="text/javascript" src="./Mapping with Diffusion-based Cartograms_files/shCore.js"></script>
<script type="text/javascript" src="./Mapping with Diffusion-based Cartograms_files/shBrushBash.js"></script>
<script type="text/javascript" src="./Mapping with Diffusion-based Cartograms_files/shBrushR.js"></script>
<script type="text/javascript">
	(function(){
		var corecss = document.createElement('link');
		var themecss = document.createElement('link');
		var corecssurl = "http://flowingdata.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter2/styles/shCore.css?ver=2.1.364";
		if ( corecss.setAttribute ) {
				corecss.setAttribute( "rel", "stylesheet" );
				corecss.setAttribute( "type", "text/css" );
				corecss.setAttribute( "href", corecssurl );
		} else {
				corecss.rel = "stylesheet";
				corecss.href = corecssurl;
		}
		document.getElementsByTagName("head")[0].insertBefore( corecss, document.getElementById("syntaxhighlighteranchor") );
		var themecssurl = "http://flowingdata.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter2/styles/shThemeDefault.css?ver=2.1.364";
		if ( themecss.setAttribute ) {
				themecss.setAttribute( "rel", "stylesheet" );
				themecss.setAttribute( "type", "text/css" );
				themecss.setAttribute( "href", themecssurl );
		} else {
				themecss.rel = "stylesheet";
				themecss.href = themecssurl;
		}
		//document.getElementById("syntaxhighlighteranchor").appendChild(themecss);
		document.getElementsByTagName("head")[0].insertBefore( themecss, document.getElementById("syntaxhighlighteranchor") );
	})();
	SyntaxHighlighter.config.clipboardSwf = 'http://flowingdata.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter2/scripts/clipboard.swf';
	SyntaxHighlighter.config.strings.expandSource = 'show source';
	SyntaxHighlighter.config.strings.viewSource = 'view source';
	SyntaxHighlighter.config.strings.copyToClipboard = 'copy to clipboard';
	SyntaxHighlighter.config.strings.copyToClipboardConfirmation = 'The code is in your clipboard now';
	SyntaxHighlighter.config.strings.print = 'print';
	SyntaxHighlighter.config.strings.help = '?';
	SyntaxHighlighter.config.strings.alert = 'SyntaxHighlighter\n\n';
	SyntaxHighlighter.config.strings.noBrush = 'Can\'t find brush for: ';
	SyntaxHighlighter.config.strings.brushNotHtmlScript = 'Brush wasn\'t configured for html-script option: ';
	SyntaxHighlighter.defaults['pad-line-numbers'] = false;
	SyntaxHighlighter.all();
</script>
<script type="text/javascript" src="./Mapping with Diffusion-based Cartograms_files/photon.js"></script>
<script type="text/javascript" src="./Mapping with Diffusion-based Cartograms_files/devicepx-jetpack.js"></script>

	<script src="./Mapping with Diffusion-based Cartograms_files/e-201350.js" type="text/javascript"></script>
	<script type="text/javascript">
	st_go({v:'ext',j:'1:2.7',blog:'1938889',post:'26660',tz:'-8'});
	var load_cmc = function(){linktracker_init(1938889,26660,2);};
	if ( typeof addLoadEvent != 'undefined' ) addLoadEvent(load_cmc);
	else load_cmc();
	</script><img id="wpstats" src="./Mapping with Diffusion-based Cartograms_files/g.gif" alt="" scale="0">
</body><style type="text/css">embed[type*="application/x-shockwave-flash"],embed[src*=".swf"],object[type*="application/x-shockwave-flash"],object[codetype*="application/x-shockwave-flash"],object[src*=".swf"],object[codebase*="swflash.cab"],object[classid*="D27CDB6E-AE6D-11cf-96B8-444553540000"],object[classid*="d27cdb6e-ae6d-11cf-96b8-444553540000"],object[classid*="D27CDB6E-AE6D-11cf-96B8-444553540000"]{	display: none !important;}</style></html>